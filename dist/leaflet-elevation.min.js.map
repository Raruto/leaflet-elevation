{"version":3,"file":"leaflet-elevation.min.js","sources":["../src/utils.js","../node_modules/leaflet-i18n/Leaflet.i18n.js","../src/components.js","../src/chart.js","../src/marker.js","../src/summary.js","../src/options.js","../src/control.js","../src/altitude.js","../src/slope.js","../src/index.js"],"sourcesContent":["/**\n * Recursive deep merge objects.\n * Alternative to L.Util.setOptions(this, options).\n */\nexport function deepMerge(target, ...sources) {\n\tif (!sources.length) return target;\n\tconst source = sources.shift();\n\tif (isObject(target) && isObject(source)) {\n\t\tfor (const key in source) {\n\t\t\tif (isObject(source[key])) {\n\t\t\t\tif (!target[key]) Object.assign(target, {\n\t\t\t\t\t[key]: {}\n\t\t\t\t});\n\t\t\t\tdeepMerge(target[key], source[key]);\n\t\t\t} else {\n\t\t\t\tObject.assign(target, {\n\t\t\t\t\t[key]: source[key]\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\treturn deepMerge(target, ...sources);\n}\n\n/**\n * Wait for document load before execute function.\n */\nexport function deferFunc(f) {\n\tif (document.readyState !== 'complete') window.addEventListener(\"load\", f, { once: true });\n\telse f();\n}\n\n/*\n * Formatting funciton using the given decimals and seperator.\n */\nexport function formatter(num, dec, sep) {\n\tlet res = L.Util.formatNum(num, dec).toString();\n\tlet numbers = res.split(\".\");\n\tif (numbers[1]) {\n\t\tfor (let d = dec - numbers[1].length; d > 0; d--) {\n\t\t\tnumbers[1] += \"0\";\n\t\t}\n\t\tres = numbers.join(sep || \".\");\n\t}\n\treturn res;\n}\n\n/**\n * Simple GeoJSON data loader.\n */\nexport function GeoJSONLoader(data, control) {\n\tif (typeof data === \"string\") {\n\t\tdata = JSON.parse(data);\n\t}\n\tcontrol = control || this;\n\n\tlet layer = L.geoJson(data, {\n\t\tstyle: (feature) => {\n\t\t\tlet style = L.extend({}, control.options.polyline);\n\t\t\tif (control.options.theme) {\n\t\t\t\tstyle.className += ' ' + control.options.theme;\n\t\t\t}\n\t\t\treturn style;\n\t\t},\n\t\tpointToLayer: (feature, latlng) => {\n\t\t\tlet marker = L.marker(latlng, { icon: control.options.gpxOptions.marker_options.wptIcons[''] });\n\t\t\tlet desc = feature.properties.desc ? feature.properties.desc : '';\n\t\t\tlet name = feature.properties.name ? feature.properties.name : '';\n\t\t\tif (name || desc) {\n\t\t\t\tmarker.bindPopup(\"<b>\" + name + \"</b>\" + (desc.length > 0 ? '<br>' + desc : '')).openPopup();\n\t\t\t}\n\t\t\tcontrol.fire('waypoint_added', { point: marker, point_type: 'waypoint', element: latlng });\n\t\t\treturn marker;\n\t\t},\n\t\tonEachFeature: (feature, layer) => {\n\t\t\tif (feature.geometry.type == 'Point') return;\n\n\t\t\tcontrol.addData(feature, layer);\n\n\t\t\tcontrol.track_info = L.extend({}, control.track_info, { type: \"geojson\", name: data.name });\n\t\t},\n\t});\n\n\tL.Control.Elevation._d3LazyLoader.then(() => {\n\t\tcontrol._fireEvt(\"eledata_loaded\", { data: data, layer: layer, name: control.track_info.name, track_info: control.track_info })\n\t});\n\n\treturn layer;\n}\n\n/**\n * Simple GPX data loader.\n */\nexport function GPXLoader(data, control) {\n\tcontrol = control || this;\n\n\tcontrol.options.gpxOptions.polyline_options = L.extend({}, control.options.polyline, control.options.gpxOptions.polyline_options);\n\n\tif (control.options.theme) {\n\t\tcontrol.options.gpxOptions.polyline_options.className += ' ' + control.options.theme;\n\t}\n\n\tlet layer = new L.GPX(data, control.options.gpxOptions);\n\n\t// similar to L.GeoJSON.pointToLayer\n\tlayer.on('addpoint', (e) => {\n\t\tcontrol.fire(\"waypoint_added\", e);\n\t});\n\n\t// similar to L.GeoJSON.onEachFeature\n\tlayer.on(\"addline\", (e) => {\n\t\tcontrol.addData(e.line /*, layer*/ );\n\t\tcontrol.track_info = L.extend({}, control.track_info, { type: \"gpx\", name: layer.get_name() });\n\t});\n\n\t// unlike the L.GeoJSON, L.GPX parsing is async\n\tlayer.once('loaded', (e) => {\n\t\tL.Control.Elevation._d3LazyLoader.then(() => {\n\t\t\tcontrol._fireEvt(\"eledata_loaded\", { data: data, layer: layer, name: control.track_info.name, track_info: control.track_info });\n\t\t});\n\t});\n\n\treturn layer;\n}\n\n/**\n * Check DOM element visibility.\n */\nexport function isDomVisible(elem) {\n\treturn !!(elem.offsetWidth || elem.offsetHeight || elem.getClientRects().length);\n}\n\n/**\n * Check object type.\n */\nexport function isObject(item) {\n\treturn (item && typeof item === 'object' && !Array.isArray(item));\n}\n\n/**\n * Check DOM element viewport visibility.\n */\nexport function isVisible(elem) {\n\tif (!elem) return false;\n\n\tlet styles = window.getComputedStyle(elem);\n\n\tfunction isVisibleByStyles(elem, styles) {\n\t\treturn styles.visibility !== 'hidden' && styles.display !== 'none';\n\t}\n\n\tfunction isAboveOtherElements(elem, styles) {\n\t\tlet boundingRect = elem.getBoundingClientRect();\n\t\tlet left = boundingRect.left + 1;\n\t\tlet right = boundingRect.right - 1;\n\t\tlet top = boundingRect.top + 1;\n\t\tlet bottom = boundingRect.bottom - 1;\n\t\tlet above = true;\n\n\t\tlet pointerEvents = elem.style.pointerEvents;\n\n\t\tif (styles['pointer-events'] == 'none') elem.style.pointerEvents = 'auto';\n\n\t\tif (document.elementFromPoint(left, top) !== elem) above = false;\n\t\tif (document.elementFromPoint(right, top) !== elem) above = false;\n\n\t\t// Only for completely visible elements\n\t\t// if (document.elementFromPoint(left, bottom) !== elem) above = false;\n\t\t// if (document.elementFromPoint(right, bottom) !== elem) above = false;\n\n\t\telem.style.pointerEvents = pointerEvents;\n\n\t\treturn above;\n\t}\n\n\tif (!isVisibleByStyles(elem, styles)) return false;\n\tif (!isAboveOtherElements(elem, styles)) return false;\n\treturn true;\n}\n\n/**\n * Check JSON object type.\n */\nexport function isJSONDoc(doc, lazy) {\n\tlazy = typeof lazy === \"undefined\" ? true : lazy;\n\tif (typeof doc === \"string\" && lazy) {\n\t\tdoc = doc.trim();\n\t\treturn doc.indexOf(\"{\") == 0 || doc.indexOf(\"[\") == 0;\n\t} else {\n\t\ttry {\n\t\t\tJSON.parse(doc.toString());\n\t\t} catch (e) {\n\t\t\tif (typeof doc === \"object\" && lazy) return true;\n\t\t\tconsole.warn(e);\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n}\n\n/**\n * Check XML object type.\n */\nexport function isXMLDoc(doc, lazy) {\n\tlazy = typeof lazy === \"undefined\" ? true : lazy;\n\tif (typeof doc === \"string\" && lazy) {\n\t\tdoc = doc.trim();\n\t\treturn doc.indexOf(\"<\") == 0;\n\t} else {\n\t\tlet documentElement = (doc ? doc.ownerDocument || doc : 0).documentElement;\n\t\treturn documentElement ? documentElement.nodeName !== \"HTML\" : false;\n\t}\n}\n\n/**\n * Async JS script download.\n */\nexport function lazyLoader(url, skip, loader) {\n\tif (skip === false) {\n\t\treturn Promise.resolve();\n\t}\n\tif (loader instanceof Promise) {\n\t\treturn loader;\n\t}\n\treturn new Promise((resolve, reject) => {\n\t\tlet tag = document.createElement(\"script\");\n\t\ttag.addEventListener('load', resolve, { once: true });\n\t\ttag.src = url;\n\t\tdocument.head.appendChild(tag);\n\t});\n}\n\n/**\n * Download data from a remote url.\n */\nexport function loadFile(url, success) {\n\treturn new Promise((resolve, reject) => {\n\t\tlet xhr = new XMLHttpRequest();\n\t\txhr.responseType = \"text\";\n\t\txhr.open('GET', url);\n\t\txhr.onload = () => resolve(xhr.response);\n\t\txhr.onerror = () => reject(\"Error \" + xhr.status + \" while fetching remote file: \" + url);\n\t\txhr.send();\n\t});\n}\n\n/**\n * Generate download data event.\n */\nexport function saveFile(dataURI, fileName) {\n\tlet a = create('a', '', { href: dataURI, target: '_new', download: fileName || \"\", style: \"display:none;\" });\n\tlet b = document.body;\n\tb.appendChild(a);\n\ta.click();\n\tb.removeChild(a);\n}\n\n/**\n * Wait for element visible before execute function.\n */\nexport function waitHolder(elem) {\n\treturn new Promise((resolve, reject) => {\n\t\tlet ticking = false;\n\t\tlet scrollFn = () => {\n\t\t\tif (!ticking) {\n\t\t\t\tL.Util.requestAnimFrame(() => {\n\t\t\t\t\tif (isVisible(elem)) {\n\t\t\t\t\t\twindow.removeEventListener('scroll', scrollFn);\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}\n\t\t\t\t\tticking = false;\n\t\t\t\t});\n\t\t\t\tticking = true;\n\t\t\t}\n\t\t};\n\t\twindow.addEventListener('scroll', scrollFn);\n\t\tif (elem) elem.addEventListener('mouseenter', scrollFn, { once: true });\n\t\tscrollFn();\n\t});\n}\n\n/**\n * A little bit safier than L.DomUtil.addClass\n */\nexport function addClass(targetNode, className) {\n\teach(className.split(\" \"), s => { if (targetNode && className) L.DomUtil.addClass(targetNode, s); });\n}\n\n/**\n * A little bit safier than L.DomUtil.removeClass()\n */\nexport function removeClass(targetNode, className) {\n\teach(className.split(\" \"), s => { if (targetNode && className) L.DomUtil.removeClass(targetNode, s); });\n}\n\nexport function style(targetNode, name, value) {\n\tif (typeof value === \"undefined\") return L.DomUtil.getStyle(targetNode, name);\n\telse return targetNode.style.setProperty(name, value);\n}\n\n/**\n * A little bit shorter than L.DomUtil.create()\n */\nexport function create(tagName, className, attributes, parent) {\n\tlet elem = L.DomUtil.create(tagName, className || \"\");\n\tif (attributes) setAttributes(elem, attributes);\n\tif (parent) append(parent, elem);\n\treturn elem;\n}\n\n/**\n * Same as node.appendChild()\n */\nexport function append(parent, child) {\n\treturn parent.appendChild(child);\n}\n\n/**\n * Same as node.insertAdjacentElement()\n */\nexport function insert(parent, child, position) {\n\treturn parent.insertAdjacentElement(position, child);\n}\n\n/**\n * Loop for node.setAttribute()\n */\nexport function setAttributes(elem, attrs) {\n\tfor (let k in attrs) { elem.setAttribute(k, attrs[k]); }\n}\n\n/**\n * Same as node.querySelector().\n */\nexport function select(selector, context) {\n\treturn (context || document).querySelector(selector);\n}\n\n/**\n * Alias for L.DomEvent.on.\n */\nexport const on = L.DomEvent.on;\n\n/**\n * Alias for L.DomEvent.off.\n */\nexport const off = L.DomEvent.off;\n\n/**\n * Alias for L.DomUtil.hasClass.\n */\nexport const hasClass = L.DomUtil.hasClass;\n\n\nexport function randomId() {\n\treturn Math.random().toString(36).substr(2, 9);\n}\n\nexport function each(obj, fn) {\n\tfor (let i in obj) fn(obj[i], i);\n}\n","// Following https://github.com/Leaflet/Leaflet/blob/master/PLUGIN-GUIDE.md\n(function (factory, window) {\n\n    // define an AMD module that relies on 'leaflet'\n    if (typeof define === 'function' && define.amd) {\n        define(['leaflet'], factory);\n\n        // define a Common JS module that relies on 'leaflet'\n    } else if (typeof exports === 'object') {\n        module.exports = factory(require('leaflet'));\n    }\n\n    // attach your plugin to the global 'L' variable\n    if (typeof window !== 'undefined' && window.L) {\n        factory(window.L);\n\n    }\n}(function (L) {\n    L.locales = {};\n    L.locale = null;\n    L.registerLocale = function registerLocale(code, locale) {\n        L.locales[code] = L.Util.extend({}, L.locales[code], locale);\n    };\n    L.setLocale = function setLocale(code) {\n        L.locale = code;\n    };\n    return L.i18n = L._ = function translate(string, data) {\n        if (L.locale && L.locales[L.locale] && L.locales[L.locale][string]) {\n            string = L.locales[L.locale][string];\n        }\n        try {\n            // Do not fail if some data is missing\n            // a bad translation should not break the app\n            string = L.Util.template(string, data);\n        }\n        catch (err) {/*pass*/\n        }\n\n        return string;\n    };\n}, window));\n","export const Area = ({\n\tdata,\n\tname,\n\txAttr,\n\tyAttr,\n\tscaleX,\n\tscaleY,\n\theight,\n\tinterpolation = \"curveLinear\",\n}) => {\n\treturn path => {\n\t\tif (typeof interpolation === 'string') interpolation = d3[interpolation];\n\n\t\tlet area = d3.area().curve(interpolation)\n\t\t\t.x(d => (d.xDiagCoord = scaleX(d[xAttr])))\n\t\t\t.y0(height)\n\t\t\t.y1(d => scaleY(d[yAttr]));\n\n\t\tif (data) path.datum(data).attr(\"d\", area);\n\t\tif (name) path.attr('data-name', name);\n\n\t\treturn area;\n\t};\n};\n\nexport const AreaPath = (props) => {\n\treturn d3.create('svg:path')\n\t\t.attr(\"class\", \"area\")\n\t\t.call(Area(props));\n};\n\nexport const Axis = ({\n\ttype = \"axis\",\n\ttickSize = 6,\n\ttickPadding = 3,\n\tposition,\n\theight,\n\twidth,\n\taxis,\n\tscale,\n\tticks,\n\ttickFormat,\n\tlabel,\n\tlabelX,\n\tlabelY\n}) => {\n\treturn g => {\n\t\tlet [w, h] = [0, 0];\n\t\tif (position == \"bottom\") h = height;\n\t\tif (position == \"right\") w = width;\n\n\t\tif (axis == \"x\" && type == \"grid\") {\n\t\t\ttickSize = -height;\n\t\t} else if (axis == \"y\" && type == \"grid\") {\n\t\t\ttickSize = -width;\n\t\t}\n\n\t\tlet axisScale = d3[\"axis\" + position.replace(/\\b\\w/g, l => l.toUpperCase())]()\n\t\t\t.scale(scale)\n\t\t\t.ticks(ticks)\n\t\t\t.tickPadding(tickPadding)\n\t\t\t.tickSize(tickSize)\n\t\t\t.tickFormat(tickFormat);\n\n\t\tlet axisGroup = g.append(\"g\")\n\t\t\t.attr(\"class\", [axis, type, position].join(\" \"))\n\t\t\t.attr(\"transform\", \"translate(\" + w + \",\" + h + \")\")\n\t\t\t.call(axisScale);\n\n\t\tif (label) {\n\t\t\taxisGroup.append(\"text\")\n\t\t\t\t.attr(\"x\", labelX)\n\t\t\t\t.attr(\"y\", labelY)\n\t\t\t\t.text(label);\n\t\t}\n\n\t\treturn axisGroup;\n\t};\n};\n\nexport const DragRectangle = ({\n\tdragStartCoords,\n\tdragEndCoords,\n\theight,\n}) => {\n\treturn rect => {\n\t\tlet x1 = Math.min(dragStartCoords[0], dragEndCoords[0]);\n\t\tlet x2 = Math.max(dragStartCoords[0], dragEndCoords[0]);\n\n\t\treturn rect\n\t\t\t.attr(\"width\", x2 - x1)\n\t\t\t.attr(\"height\", height)\n\t\t\t.attr(\"x\", x1);\n\t};\n};\n\nexport const FocusRect = ({\n\twidth,\n\theight,\n}) => {\n\treturn rect => rect\n\t\t.attr(\"width\", width)\n\t\t.attr(\"height\", height)\n\t\t.style(\"fill\", \"none\")\n\t\t.style(\"stroke\", \"none\")\n\t\t.style(\"pointer-events\", \"all\");\n};\n\nexport const Grid = (props) => {\n\tprops.type = \"grid\";\n\treturn Axis(props);\n};\n\nexport const HeightFocusLine = ({\n\ttheme,\n\txCoord = 0,\n\tyCoord = 0,\n\tlength = 0,\n}) => {\n\treturn line => line\n\t\t.attr(\"class\", theme + \" height-focus line\")\n\t\t.attr(\"x1\", xCoord)\n\t\t.attr(\"x2\", xCoord)\n\t\t.attr(\"y1\", yCoord)\n\t\t.attr(\"y2\", length);\n};\n\nexport const HeightFocusLabel = ({\n\ttheme,\n\txCoord = 0,\n\tyCoord = 0,\n\tlabel,\n}) => {\n\treturn text => {\n\t\ttext\n\t\t\t.attr(\"class\", theme + \" height-focus-label\")\n\t\t\t.style(\"pointer-events\", \"none\")\n\t\t\t.attr(\"x\", xCoord + 5)\n\t\t\t.attr(\"y\", yCoord);\n\n\t\tlet y = text.select(\".height-focus-y\");\n\t\tif (!y.node()) y = text.append(\"svg:tspan\");\n\n\t\ty\n\t\t\t.attr(\"class\", \"height-focus-y\")\n\t\t\t.text(label);\n\n\t\ttext.selectAll('tspan').attr(\"x\", xCoord + 5);\n\n\t\treturn text;\n\t};\n};\n\nexport const HeightFocusPoint = ({\n\ttheme,\n\txCoord = 0,\n\tyCoord = 0,\n}) => {\n\treturn circle => circle\n\t\t.attr(\"class\", theme + \" height-focus circle-lower\")\n\t\t.attr(\"transform\", \"translate(\" + xCoord + \",\" + yCoord + \")\")\n\t\t.attr(\"r\", 6)\n\t\t.attr(\"cx\", 0)\n\t\t.attr(\"cy\", 0);\n};\n\n\nexport const LegendItem = ({\n\tname,\n\twidth,\n\theight,\n\tmargins = {},\n}) => {\n\treturn g => {\n\t\tg\n\t\t\t.attr(\"class\", \"legend-item legend-\" + name.toLowerCase())\n\t\t\t.attr(\"data-name\", name);\n\n\t\tg.append(\"rect\")\n\t\t\t.attr(\"class\", \"area\")\n\t\t\t.attr(\"x\", (width / 2) - 50)\n\t\t\t.attr(\"y\", height + margins.bottom / 2)\n\t\t\t.attr(\"width\", 50)\n\t\t\t.attr(\"height\", 10)\n\t\t\t.attr(\"opacity\", 0.75);\n\n\t\tg.append('text')\n\t\t\t.text(L._(name))\n\t\t\t.attr(\"x\", (width / 2) + 5)\n\t\t\t.attr(\"font-size\", 10)\n\t\t\t.style(\"text-decoration-thickness\", \"2px\")\n\t\t\t.style(\"font-weight\", \"700\")\n\t\t\t.attr('y', height + margins.bottom / 2)\n\t\t\t.attr('dy', \"0.75em\");\n\n\t\treturn g;\n\t}\n};\n\nexport const MouseFocusLine = ({\n\txCoord = 0,\n\theight,\n}) => {\n\treturn line => line\n\t\t.attr('class', 'mouse-focus-line')\n\t\t.attr('x2', xCoord)\n\t\t.attr('y2', 0)\n\t\t.attr('x1', xCoord)\n\t\t.attr('y1', height);\n};\n\nexport const MouseFocusLabel = ({\n\txCoord,\n\tyCoord,\n\tlabelX = \"\",\n\tlabelY = \"\",\n\twidth,\n}) => {\n\treturn g => {\n\n\t\tg.attr('class', 'mouse-focus-label');\n\n\t\tlet rect = g.select(\".mouse-focus-label-rect\");\n\t\tlet text = g.select(\".mouse-focus-label-text\");\n\t\tlet y = text.select(\".mouse-focus-label-y\");\n\t\tlet x = text.select(\".mouse-focus-label-x\");\n\n\t\tif (!rect.node()) rect = g.append(\"rect\");\n\t\tif (!text.node()) text = g.append(\"svg:text\");\n\t\tif (!y.node()) y = text.append(\"svg:tspan\");\n\t\tif (!x.node()) x = text.append(\"svg:tspan\");\n\n\t\ty.text(labelY);\n\t\tx.text(labelX);\n\n\t\t// Sets focus-label-text position to the left / right of the mouse-focus-line\n\t\tlet xAlign = 0;\n\t\tlet yAlign = 0;\n\t\tlet bbox = { width: 0, height: 0 };\n\t\ttry { bbox = text.node().getBBox(); } catch (e) { return g; }\n\n\t\tif (xCoord) xAlign = xCoord + (xCoord < width / 2 ? 10 : -bbox.width - 10);\n\t\tif (yCoord) yAlign = Math.max(yCoord - bbox.height, L.Browser.webkit ? 0 : -Infinity);\n\n\t\trect\n\t\t\t.attr(\"class\", \"mouse-focus-label-rect\")\n\t\t\t.attr(\"x\", xAlign - 5)\n\t\t\t.attr(\"y\", yAlign - 5)\n\t\t\t.attr(\"width\", bbox.width + 10)\n\t\t\t.attr(\"height\", bbox.height + 10)\n\t\t\t.attr(\"rx\", 3)\n\t\t\t.attr(\"ry\", 3);\n\t\ttext\n\t\t\t.attr(\"class\", \"mouse-focus-label-text\")\n\t\t\t.style(\"font-weight\", \"700\")\n\t\t\t.attr(\"y\", yAlign);\n\t\ty\n\t\t\t.attr(\"class\", \"mouse-focus-label-y\")\n\t\t\t.attr(\"dy\", \"1em\");\n\t\tx\n\t\t\t.attr(\"class\", \"mouse-focus-label-x\")\n\t\t\t.attr(\"dy\", \"2em\");\n\n\t\ttext.selectAll('tspan').attr(\"x\", xAlign);\n\n\t\treturn g;\n\t};\n};\n\nexport const Scale = ({\n\tdata,\n\tattr,\n\tmin,\n\tforceBounds,\n\trange,\n}) => {\n\tlet domain = data ? d3.extent(data, d => d[attr]) : [0, 1];\n\tif (typeof min !== \"undefined\" && (min < domain[0] || forceBounds)) {\n\t\tdomain[0] = min;\n\t}\n\tif (typeof max !== \"undefined\" && (max > domain[1] || forceBounds)) {\n\t\tdomain[1] = max;\n\t}\n\treturn d3.scaleLinear()\n\t\t.range(range)\n\t\t.domain(domain);\n};\n\nexport const Bisect = ({\n\tdata = [0, 1],\n\tscale,\n\tx,\n\tattr\n}) => {\n\treturn d3\n\t\t.bisector(d => d[attr])\n\t\t.left(data, scale.invert(x));\n};\n","import 'leaflet-i18n';\nimport * as _ from './utils';\nimport * as D3 from './components';\n\nexport var Chart = L.Class.extend({\n\n\tincludes: L.Evented ? L.Evented.prototype : L.Mixin.Events,\n\n\tinitialize: function(options) {\n\t\tlet opts = this.options = options;\n\n\t\tthis._data = [];\n\t\tthis._draggingEnabled = opts.dragging;\n\n\t\tif (this.options.imperial) {\n\t\t\t// this._distanceFactor = this.__mileFactor;\n\t\t\t// this._heightFactor = this.__footFactor;\n\t\t\tthis._xLabel = \"mi\";\n\t\t\tthis._yLabel = \"ft\";\n\t\t} else {\n\t\t\t// this._distanceFactor = this.options.distanceFactor;\n\t\t\t// this._heightFactor = this.options.heightFactor;\n\t\t\tthis._xLabel = this.options.xLabel;\n\t\t\tthis._yLabel = this.options.yLabel;\n\t\t}\n\n\t\tthis._xTicks = opts.xTicks;\n\t\tthis._yTicks = opts.yTicks;\n\n\t\tlet scale = this._updateScale();\n\n\t\tlet svg = this._svg = d3.create(\"svg\")\n\t\t\t.attr(\"class\", \"background\")\n\t\t\t.attr(\"width\", opts.width)\n\t\t\t.attr(\"height\", opts.height);\n\n\t\tlet g = svg\n\t\t\t.append(\"g\")\n\t\t\t.attr(\"transform\", \"translate(\" + opts.margins.left + \",\" + opts.margins.top + \")\")\n\t\t\t.call(this._appendGrid())\n\t\t\t.call(this._appendAxis())\n\t\t\t.call(this._appendAreaPath())\n\t\t\t.call(this._appendFocusable())\n\t\t\t.call(this._appendLegend());\n\n\t\tthis._grid = svg.select('.grid');\n\t\tthis._area = svg.select('.area');\n\t\tthis._path = svg.select('.area path');\n\t\tthis._axis = svg.select('.axis');\n\t\tthis._focus = svg.select('.focus');\n\t\tthis._focusRect = this._focus.select('rect');\n\t\tthis._legend = svg.select('.legend');\n\t\tthis._x = scale.x;\n\t\tthis._y = scale.y;\n\n\t},\n\n\tupdate: function(props) {\n\t\tif (props.data) this._data = props.data;\n\t\tif (props.options) this.options = props.options;\n\n\t\tthis._updateScale();\n\t\tthis._updateAxis();\n\t\tthis._updateAreaPath();\n\n\t\treturn this;\n\t},\n\n\trender: function() {\n\t\treturn container => container.append(() => this._svg.node());\n\t},\n\n\t_updateScale: function() {\n\t\tlet opts = this.options;\n\n\t\tthis._x = D3.Scale({\n\t\t\tdata: this._data,\n\t\t\trange: [0, this._width()],\n\t\t\tattr: opts.xAttr,\n\t\t\tmin: opts.xAxisMin,\n\t\t\tmax: opts.xAxisMax,\n\t\t\tforceBounds: opts.forceAxisBounds,\n\t\t});\n\n\t\tthis._y = D3.Scale({\n\t\t\tdata: this._data,\n\t\t\trange: [this._height(), 0],\n\t\t\tattr: opts.yAttr,\n\t\t\tmin: opts.yAxisMin,\n\t\t\tmax: opts.yAxisMax,\n\t\t\tforceBounds: opts.forceAxisBounds,\n\t\t});\n\n\t\treturn { x: this._x, y: this._y };\n\t},\n\n\t/**\n\t * Update chart axis.\n\t */\n\t_updateAxis: function() {\n\t\tthis._grid.selectAll('g').remove();\n\t\tthis._axis.selectAll('g').remove();\n\t\tthis._grid\n\t\t\t.call(this._appendXGrid())\n\t\t\t.call(this._appendYGrid());\n\t\tthis._axis\n\t\t\t.call(this._appendXaxis())\n\t\t\t.call(this._appendYaxis());\n\n\t\t// this.fire('axis_updated');\n\t},\n\n\t_updateAreaPath: function() {\n\t\tlet opts = this.options;\n\t\tthis._path\n\t\t\t.call(\n\t\t\t\tD3.Area({\n\t\t\t\t\tinterpolation: opts.interpolation,\n\t\t\t\t\tdata: this._data,\n\t\t\t\t\tname: 'Altitude',\n\t\t\t\t\txAttr: opts.xAttr,\n\t\t\t\t\tyAttr: opts.yAttr,\n\t\t\t\t\twidth: this._width(),\n\t\t\t\t\theight: this._height(),\n\t\t\t\t\tscaleX: this._x,\n\t\t\t\t\tscaleY: this._y,\n\t\t\t\t})\n\t\t\t);\n\t},\n\n\t/**\n\t * Generate \"grid\".\n\t */\n\t_appendGrid: function() {\n\t\treturn g =>\n\t\t\tg.append(\"g\")\n\t\t\t.attr(\"class\", \"grid\")\n\t\t\t.call(this._appendXGrid())\n\t\t\t.call(this._appendYGrid());\n\t},\n\n\t/**\n\t * Generate \"x-grid\".\n\t */\n\t_appendXGrid: function() {\n\t\treturn D3.Grid({\n\t\t\taxis: \"x\",\n\t\t\tposition: \"bottom\",\n\t\t\twidth: this._width(),\n\t\t\theight: this._height(),\n\t\t\tscale: this._x,\n\t\t\tticks: this._xTicks,\n\t\t\ttickFormat: \"\",\n\t\t});\n\t},\n\n\t/**\n\t * Generate \"y-grid\".\n\t */\n\t_appendYGrid: function() {\n\t\treturn D3.Grid({\n\t\t\taxis: \"y\",\n\t\t\tposition: \"left\",\n\t\t\twidth: this._width(),\n\t\t\theight: this._height(),\n\t\t\tscale: this._y,\n\t\t\tticks: this.options.yTicks,\n\t\t\ttickFormat: \"\",\n\t\t});\n\t},\n\n\t/**\n\t * Generate \"axis\".\n\t */\n\t_appendAxis: function() {\n\t\treturn g =>\n\t\t\tg.append(\"g\")\n\t\t\t.attr(\"class\", \"axis\")\n\t\t\t.call(this._appendXaxis())\n\t\t\t.call(this._appendYaxis());\n\t},\n\n\t/**\n\t * Generate \"x-axis\".\n\t */\n\t_appendXaxis: function() {\n\t\treturn D3.Axis({\n\t\t\taxis: \"x\",\n\t\t\tposition: \"bottom\",\n\t\t\twidth: this._width(),\n\t\t\theight: this._height(),\n\t\t\tscale: this._x,\n\t\t\tticks: this._xTicks,\n\t\t\tlabel: this._xLabel,\n\t\t\tlabelY: 25,\n\t\t\tlabelX: this._width() + 6,\n\t\t});\n\t},\n\n\t/**\n\t * Generate \"y-axis\".\n\t */\n\t_appendYaxis: function() {\n\t\treturn D3.Axis({\n\t\t\taxis: \"y\",\n\t\t\tposition: \"left\",\n\t\t\twidth: this._width(),\n\t\t\theight: this._height(),\n\t\t\tscale: this._y,\n\t\t\tticks: this.options.yTicks,\n\t\t\tlabel: this._yLabel,\n\t\t\tlabelX: -25,\n\t\t\tlabelY: 3,\n\t\t});\n\t},\n\n\t/**\n\t * Generate \"path\".\n\t */\n\t_appendAreaPath: function() {\n\t\treturn g => g.append('g')\n\t\t\t.attr(\"class\", \"area\")\n\t\t\t.append('path');\n\t},\n\n\t_appendFocusable: function() {\n\t\treturn g => {\n\t\t\treturn g.append('g')\n\t\t\t\t.attr(\"class\", 'focus')\n\t\t\t\t.call(this._appendFocusRect())\n\t\t\t\t.call(this._appendMouseFocusG());\n\t\t};\n\t},\n\n\t/**\n\t * Generate \"mouse-focus\" and \"drag-rect\".\n\t */\n\t_appendFocusRect: function() {\n\t\treturn g => {\n\t\t\tlet focusRect = g.append(\"rect\")\n\t\t\t\t.call(\n\t\t\t\t\tD3.FocusRect({\n\t\t\t\t\t\twidth: this._width(),\n\t\t\t\t\t\theight: this._height()\n\t\t\t\t\t})\n\t\t\t\t);\n\n\t\t\tif (L.Browser.mobile) {\n\t\t\t\tfocusRect\n\t\t\t\t\t.on(\"touchstart.drag\", this._dragStartHandler.bind(this))\n\t\t\t\t\t.on(\"touchmove.drag\", this._dragHandler.bind(this))\n\t\t\t\t\t.on(\"touchstart.focus\", this._mousemoveHandler.bind(this))\n\t\t\t\t\t.on(\"touchmove.focus\", this._mousemoveHandler.bind(this));\n\t\t\t\tL.DomEvent.on(this._svg.node(), 'touchend', this._dragEndHandler, this);\n\t\t\t}\n\n\t\t\tfocusRect\n\t\t\t\t.on(\"mousedown.drag\", this._dragStartHandler.bind(this))\n\t\t\t\t.on(\"mousemove.drag\", this._dragHandler.bind(this))\n\t\t\t\t.on(\"mouseenter.focus\", this._mouseenterHandler.bind(this))\n\t\t\t\t.on(\"mousemove.focus\", this._mousemoveHandler.bind(this))\n\t\t\t\t.on(\"mouseout.focus\", this._mouseoutHandler.bind(this));\n\t\t\tL.DomEvent.on(this._svg.node(), 'mouseup', this._dragEndHandler, this);\n\n\t\t\treturn focusRect;\n\t\t};\n\t},\n\n\t/**\n\t * Generate \"mouse-focus\".\n\t */\n\t_appendMouseFocusG: function() {\n\t\treturn g => {\n\t\t\tlet focusG = this._focusG = g.append(\"g\")\n\t\t\t\t.attr(\"class\", \"mouse-focus-group hidden\");\n\n\t\t\tthis._focusline = focusG.append('svg:line')\n\t\t\t\t.call(\n\t\t\t\t\tD3.MouseFocusLine({\n\t\t\t\t\t\txCoord: 0,\n\t\t\t\t\t\theight: this._height()\n\t\t\t\t\t})\n\t\t\t\t);;\n\t\t\tthis._focuslabel = focusG.append(\"g\")\n\t\t\t\t.call(\n\t\t\t\t\tD3.MouseFocusLabel({\n\t\t\t\t\t\txCoord: 0,\n\t\t\t\t\t\tyCoord: 0,\n\t\t\t\t\t\theight: this._height(),\n\t\t\t\t\t\twidth: this._width(),\n\t\t\t\t\t\tlabelX: \"\",\n\t\t\t\t\t\tlabelY: \"\",\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\treturn focusG;\n\t\t};\n\t},\n\n\t/**\n\t * Generate \"legend\".\n\t */\n\t_appendLegend: function() {\n\t\treturn g => {\n\t\t\t// if (!this.options.legend) return;\n\n\t\t\tlet legend = g.append('g')\n\t\t\t\t.attr(\"class\", \"legend\");\n\n\t\t\t// this.fire(\"legend\");\n\n\t\t\t// let items = legend.selectAll('.legend-item')\n\t\t\t// \t.on('click', (d, i) => {\n\t\t\t// \t\tlet target = items.nodes()[i];\n\t\t\t// \t\tlet name = target.getAttribute('data-name');\n\t\t\t// \t\tlet path = this._area.select('path[data-name=\"' + name + '\"]').node();\n\t\t\t// \t\t// this._fireEvt(\"elepath_toggle\", { path: path, name: name, legend: target });\n\t\t\t// \t});\n\n\t\t\treturn legend;\n\t\t};\n\t},\n\n\t/**\n\t * Calculates chart width.\n\t */\n\t_width: function() {\n\t\tlet opts = this.options;\n\t\treturn opts.width - opts.margins.left - opts.margins.right;\n\t},\n\n\t/**\n\t * Calculates chart height.\n\t */\n\t_height: function() {\n\t\tlet opts = this.options;\n\t\treturn opts.height - opts.margins.top - opts.margins.bottom;\n\t},\n\n\t/*\n\t * Handle drag operations.\n\t */\n\t_dragHandler: function() {\n\t\t//we don't want map events to occur here\n\t\td3.event.preventDefault();\n\t\td3.event.stopPropagation();\n\n\t\tthis._gotDragged = true;\n\t\tthis._drawDragRectangle();\n\t},\n\n\t/*\n\t * Handles start of drag operations.\n\t */\n\t_dragStartHandler: function() {\n\t\td3.event.preventDefault();\n\t\td3.event.stopPropagation();\n\n\t\tthis._gotDragged = false;\n\t\tthis._dragStartCoords = d3.mouse(this._focusRect.node());\n\t},\n\n\t/*\n\t * Draws the currently dragged rectangle over the chart.\n\t */\n\t_drawDragRectangle: function() {\n\t\tif (!this._dragStartCoords || !this._draggingEnabled) return;\n\t\tif (!this._dragRectangle) {\n\t\t\tthis._dragRectangle = this._focus.insert(\"rect\", \".mouse-focus-group\")\n\t\t\t\t.attr('class', 'mouse-drag')\n\t\t\t\t.style(\"pointer-events\", \"none\");\n\t\t}\n\t\tthis._dragRectangle.call(\n\t\t\tD3.DragRectangle({\n\t\t\t\tdragStartCoords: this._dragStartCoords,\n\t\t\t\tdragEndCoords: this._dragCurrentCoords = d3.mouse(this._focusRect.node()),\n\t\t\t\theight: this._height(),\n\t\t\t})\n\t\t);\n\t},\n\n\t/*\n\t * Handles end of drag operations. Zooms the map to the selected items extent.\n\t */\n\t_dragEndHandler: function() {\n\t\tif (!this._dragStartCoords || !this._dragCurrentCoords || !this._gotDragged) {\n\t\t\tthis._dragStartCoords = null;\n\t\t\tthis._gotDragged = false;\n\t\t\tif (this._draggingEnabled) this._resetDrag();\n\t\t\treturn;\n\t\t}\n\n\t\tlet start = this._findItemForX(this._dragStartCoords[0]);\n\t\tlet end = this._findItemForX(this._dragCurrentCoords[0]);\n\n\t\tif (start == end) return;\n\n\t\tthis._dragStartCoords = null;\n\t\tthis._gotDragged = false;\n\n\t\tthis.fire('dragged', { dragstart: this._data[start], dragend: this._data[end] });\n\t},\n\n\t/*\n\t * Handles the moueseenter over the chart.\n\t */\n\t_mouseenterHandler: function() {\n\t\tthis.fire(\"mouse_enter\");\n\t},\n\n\t/*\n\t * Handles the moueseover the chart and displays distance and altitude level.\n\t */\n\t_mousemoveHandler: function(d, i, ctx) {\n\t\tlet coords = d3.mouse(this._focusRect.node());\n\t\tlet xCoord = coords[0];\n\t\tlet item = this._data[this._findItemForX(xCoord)];\n\n\t\tthis.fire(\"mouse_move\", { item: item, xCoord: xCoord });\n\t},\n\n\t/*\n\t * Handles the moueseout over the chart.\n\t */\n\t_mouseoutHandler: function() {\n\t\tthis.fire(\"mouse_out\");\n\t},\n\n\t/*\n\t * Finds a data entry for a given x-coordinate of the diagram\n\t */\n\t_findItemForX: function(x) {\n\t\treturn d3\n\t\t\t.bisector(d => d[this.options.xAttr])\n\t\t\t.left(this._data || [0, 1], this._x.invert(x));\n\t},\n\n\t/*\n\t * Removes the drag rectangle and zoms back to the total extent of the data.\n\t */\n\t_resetDrag: function() {\n\t\tif (this._dragRectangle) {\n\t\t\tthis._dragRectangle.remove();\n\t\t\tthis._dragRectangle = null;\n\t\t\tthis._hideDiagramIndicator();\n\t\t\tthis.fire('reset_drag');\n\t\t}\n\t},\n\n\t/**\n\t * Display distance and altitude level (\"focus-rect\").\n\t */\n\t_showDiagramIndicator: function(item, xCoordinate) {\n\t\t// if (!this._chartEnabled) return;\n\n\t\tthis._focusG.classed(\"hidden\", false);\n\n\t\tlet opts = this.options;\n\t\tlet formatter = opts.hoverNumber.formatter;\n\t\tlet [fx, fy] = [opts.hoverNumber.decimalsX, opts.hoverNumber.decimalsY];\n\t\tlet yCoordinate = this._y(item[opts.yAttr]);\n\n\t\tthis._focusline.call(\n\t\t\tD3.MouseFocusLine({\n\t\t\t\txCoord: xCoordinate,\n\t\t\t\theight: this._height()\n\t\t\t})\n\t\t);\n\t\tthis._focuslabel.call(\n\t\t\tD3.MouseFocusLabel({\n\t\t\t\txCoord: xCoordinate,\n\t\t\t\tyCoord: yCoordinate,\n\t\t\t\theight: this._height(),\n\t\t\t\twidth: this._width(),\n\t\t\t\tlabelX: formatter(item[opts.xAttr], fx) + \" \" + this._xLabel,\n\t\t\t\tlabelY: formatter(item[opts.yAttr], fy) + \" \" + this._yLabel,\n\t\t\t})\n\t\t);\n\t},\n\n\t_hideDiagramIndicator: function() {\n\t\tthis._focusG.classed(\"hidden\", true);\n\t},\n});\n\nChart.addInitHook(function() {\n\tthis.on('mouse_move', function(e) {\n\t\tif (e.item) this._showDiagramIndicator(e.item, e.xCoord);\n\t});\n\n});\n","import 'leaflet-i18n';\nimport * as _ from './utils';\nimport * as D3 from './components';\n\nexport var Marker = L.Class.extend({\n\n\tinitialize: function(options) {\n\t\tthis.options = options;\n\n\t\tif (this.options.imperial) {\n\t\t\t// this._distanceFactor = this.__mileFactor;\n\t\t\t// this._heightFactor = this.__footFactor;\n\t\t\tthis._xLabel = \"mi\";\n\t\t\tthis._yLabel = \"ft\";\n\t\t} else {\n\t\t\t// this._distanceFactor = this.options.distanceFactor;\n\t\t\t// this._heightFactor = this.options.heightFactor;\n\t\t\tthis._xLabel = this.options.xLabel;\n\t\t\tthis._yLabel = this.options.yLabel;\n\t\t}\n\n\t\tif (this.options.marker == 'elevation-line') {\n\t\t\tlet g = this._heightG = d3.create(\"g\").attr(\"class\", \"height-focus-group\");\n\t\t\tthis._mouseHeightFocus = d3.create('svg:line');\n\t\t\tthis._pointG = d3.create(\"svg:circle\");\n\t\t\tthis._mouseHeightFocusLabel = d3.create(\"svg:text\");\n\t\t} else if (this.options.marker == 'position-marker') {\n\t\t\tthis._marker = L.marker([0, 0], { icon: this.options.markerIcon, zIndexOffset: 1000000, interactive: false });\n\t\t}\n\t\treturn this;\n\t},\n\n\taddTo: function(map) {\n\t\tthis._map = map;\n\t\tlet pane, renderer;\n\t\tif (!map.getPane('elevationPane')) {\n\t\t\tpane = this._pane = map.createPane('elevationPane');\n\t\t\tpane.style.zIndex = 625; // This pane is above markers but below popups.\n\t\t\tpane.style.pointerEvents = 'none';\n\t\t}\n\t\tif (this.options.marker == 'elevation-line') {\n\t\t\trenderer = L.svg({ pane: \"elevationPane\" }).addTo(this._map); // default leaflet svg renderer\n\t\t\tlet g = this._heightG = d3.select(renderer.getPane()).select(\"svg > g\").attr(\"class\", \"height-focus-group\");\n\t\t\tg.append(() => this._mouseHeightFocus.node());\n\t\t\tg.append(() => this._pointG.node());\n\t\t\tg.append(() => this._mouseHeightFocusLabel.node());\n\t\t} else if (this.options.marker == 'position-marker') {\n\t\t\tthis._marker.addTo(map, { pane: 'elevationPane' });\n\t\t}\n\t\treturn this;\n\t},\n\n\t/**\n\t * Update position marker (\"leaflet-marker\").\n\t */\n\tupdate: function(props) {\n\t\tif (props.options) this.options = props.options;\n\n\t\tlet opts = this.options;\n\n\t\tif (!this._map) this.addTo(props.map);\n\n\t\tthis._latlng = props.item.latlng;\n\n\t\tlet point = L.extend({}, props.item, this._map.latLngToLayerPoint(this._latlng));\n\n\t\tif (this.options.marker == 'elevation-line') {\n\n\t\t\tlet formatter = opts.hoverNumber.formatter;\n\t\t\tlet fy = opts.hoverNumber.decimalsY;\n\n\t\t\tlet normalizedAlt = this._height() / props.maxElevation * point.z;\n\t\t\tlet normalizedY = point.y - normalizedAlt;\n\n\t\t\tthis._heightG.classed(\"hidden\", false);\n\t\t\tthis._pointG.classed(\"hidden\", false);\n\n\t\t\tthis._pointG\n\t\t\t\t.call(\n\t\t\t\t\tD3.HeightFocusPoint({\n\t\t\t\t\t\ttheme: this.options.theme,\n\t\t\t\t\t\txCoord: point.x,\n\t\t\t\t\t\tyCoord: point.y,\n\t\t\t\t\t}));\n\n\t\t\tthis._mouseHeightFocus\n\t\t\t\t.call(\n\t\t\t\t\tD3.HeightFocusLine({\n\t\t\t\t\t\ttheme: this.options.theme,\n\t\t\t\t\t\txCoord: point.x,\n\t\t\t\t\t\tyCoord: point.y,\n\t\t\t\t\t\tlength: normalizedY\n\t\t\t\t\t})\n\t\t\t\t);\n\n\t\t\tthis._mouseHeightFocusLabel\n\t\t\t\t.call(\n\t\t\t\t\tD3.HeightFocusLabel({\n\t\t\t\t\t\ttheme: this.options.theme,\n\t\t\t\t\t\txCoord: point.x,\n\t\t\t\t\t\tyCoord: normalizedY,\n\t\t\t\t\t\tlabel: formatter(point[opts.yAttr], fy) + \" \" + this._yLabel\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t} else if (this.options.marker == 'position-marker') {\n\t\t\t_.removeClass(this._marker.getElement(), 'hidden');\n\t\t\tthis._marker.setLatLng(this._latlng);\n\t\t}\n\t},\n\n\t/*\n\t * Hides the position/height indicator marker drawn onto the map\n\t */\n\tremove: function() {\n\t\tif (this.options.marker == 'elevation-line') {\n\t\t\tif (this._heightG) this._heightG.classed(\"hidden\", true);\n\t\t\tif (this._pointG) this._pointG.classed(\"hidden\", true);\n\t\t} else if (this.options.marker == 'position-marker') {\n\t\t\t_.addClass(this._marker.getElement(), 'hidden');\n\t\t}\n\t},\n\n\tgetLatLng: function() {\n\t\treturn this._latlng;\n\t},\n\n\t/**\n\t * Calculates chart height.\n\t */\n\t_height: function() {\n\t\tlet opts = this.options;\n\t\treturn opts.height - opts.margins.top - opts.margins.bottom;\n\t},\n\n});\n","import 'leaflet-i18n';\nimport * as _ from './utils';\nimport * as D3 from './components';\n\nexport var Summary = L.Class.extend({\n\tinitialize: function(options) {\n\t\tlet opts = this.options = options;\n\n\t\tlet summary = this._summary = _.create(\"div\", \"elevation-summary \" + (this.options.summary ? this.options.summary + \"-summary\" : ''), {\n\t\t\tstyle: 'max-width:' + this.options.width + 'px'\n\t\t});\n\t},\n\n\trender: function() {\n\t\treturn container => container.append(() => this._summary);\n\t},\n\n\treset: function(){\n\t\tthis._summary.innerHTML = '';\n\t}\n});\n","import * as _ from './utils';\n\nexport var Options = {\n\tautohide: !L.Browser.mobile,\n\tautohideMarker: true,\n\tcollapsed: false,\n\tdetached: true,\n\tdistanceFactor: 1,\n\tdragging: !L.Browser.mobile,\n\tdownloadLink: 'link',\n\televationDiv: \"#elevation-div\",\n\tfollowMarker: true,\n\tforceAxisBounds: false,\n\tgpxOptions: {\n\t\tasync: true,\n\t\tmarker_options: {\n\t\t\tstartIconUrl: null,\n\t\t\tendIconUrl: null,\n\t\t\tshadowUrl: null,\n\t\t\twptIcons: {\n\t\t\t\t'': L.divIcon({\n\t\t\t\t\tclassName: 'elevation-waypoint-marker',\n\t\t\t\t\thtml: '<i class=\"elevation-waypoint-icon\"></i>',\n\t\t\t\t\ticonSize: [30, 30],\n\t\t\t\t\ticonAnchor: [8, 30],\n\t\t\t\t})\n\t\t\t},\n\t\t},\n\t},\n\theight: 200,\n\theightFactor: 1,\n\thoverNumber: {\n\t\tdecimalsX: 2,\n\t\tdecimalsY: 0,\n\t\tformatter: _.formatter,\n\t},\n\timperial: false,\n\tinterpolation: \"curveLinear\",\n\tlazyLoadJS: true,\n\tlegend: true,\n\tloadData: {\n\t\tdefer: false,\n\t\tlazy: false,\n\t},\n\tmargins: {\n\t\ttop: 10,\n\t\tright: 20,\n\t\tbottom: 30,\n\t\tleft: 50\n\t},\n\tmarker: 'elevation-line',\n\tmarkerIcon: L.divIcon({\n\t\tclassName: 'elevation-position-marker',\n\t\thtml: '<i class=\"elevation-position-icon\"></i>',\n\t\ticonSize: [32, 32],\n\t\ticonAnchor: [16, 16],\n\t}),\n\tplaceholder: false,\n\tposition: \"topright\",\n\tpolyline: {\n\t\tclassName: 'elevation-polyline',\n\t\tcolor: '#000',\n\t\topacity: 0.75,\n\t\tweight: 5,\n\t\tlineCap: 'round'\n\t},\n\treverseCoords: false,\n\tskipNullZCoords: false,\n\ttheme: \"lightblue-theme\",\n\tresponsive: true,\n\tsummary: 'inline',\n\tslope: false,\n\tsDeltaMax: false,\n\tsInterpolation: \"curveStepAfter\",\n\tsRange: false,\n\twidth: 600,\n\txAttr: \"dist\",\n\txLabel: \"km\",\n\txTicks: undefined,\n\tyAttr: \"z\",\n\tyAxisMax: undefined,\n\tyAxisMin: undefined,\n\tyLabel: \"m\",\n\tyTicks: undefined,\n\tzFollow: 13,\n};\n","import 'leaflet-i18n';\nimport * as _ from './utils';\nimport * as D3 from './components';\nimport { Chart } from './chart';\nimport { Marker } from './marker';\nimport { Summary } from './summary';\nimport { Options } from './options';\n\nexport const Elevation = L.Control.Elevation = L.Control.extend({\n\n\tincludes: L.Evented ? L.Evented.prototype : L.Mixin.Events,\n\n\toptions: Options,\n\t__mileFactor: 0.621371,\n\t__footFactor: 3.28084,\n\t__D3: 'https://unpkg.com/d3@5.15.0/dist/d3.min.js',\n\t__LGPX: 'https://unpkg.com/leaflet-gpx@1.5.0/gpx.js',\n\n\t/*\n\t * Add data to the diagram either from GPX or GeoJSON and update the axis domain and data\n\t */\n\taddData: function(d, layer) {\n\t\tif ((typeof layer === \"undefined\" || layer === null) && d.on) {\n\t\t\tlayer = d;\n\t\t}\n\t\tElevation._d3LazyLoader = _.lazyLoader(\n\t\t\tthis.__D3,\n\t\t\ttypeof d3 !== 'object' || !this.options.lazyLoadJS,\n\t\t\tElevation._d3LazyLoader\n\t\t).then(() => {\n\t\t\tthis._addData(d);\n\t\t\tthis._addLayer(layer);\n\t\t\tthis._fireEvt(\"eledata_added\", { data: d, layer: layer, track_info: this.track_info });\n\t\t});\n\t},\n\n\t/**\n\t * Adds the control to the given map.\n\t */\n\taddTo: function(map) {\n\t\tif (this.options.detached) {\n\t\t\tlet eleDiv = this._initElevationDiv();\n\t\t\tif (!eleDiv.isConnected) _.insert(map._container, eleDiv, 'afterend');\n\t\t\t_.append(eleDiv, this.onAdd(map));\n\t\t} else {\n\t\t\tL.Control.prototype.addTo.call(this, map);\n\t\t}\n\t\treturn this;\n\t},\n\n\t/*\n\t * Reset data and display\n\t */\n\tclear: function() {\n\t\tthis._marker.remove();\n\t\tthis._chart._resetDrag();\n\n\t\tif (this._layers) { // this fix `TypeError: this._layers is undefined` when bidding external layer\n\t\t\tthis._layers.eachLayer(l => _.removeClass(l._path, this.options.polyline.className + ' ' + this.options.theme));\n\t\t}\n\n\t\tthis._data = null;\n\t\tthis._distance = null;\n\t\tthis.track_info = null;\n\t\tthis._layers = null;\n\n\t\tthis._fireEvt(\"eledata_clear\");\n\t},\n\n\t/**\n\t * Disable dragging chart on touch events.\n\t */\n\tdisableDragging: function() {\n\t\tthis._chart._draggingEnabled = false;\n\t\tthis._resetDrag();\n\t},\n\n\t/**\n\t * Enable dragging chart on touch events.\n\t */\n\tenableDragging: function() {\n\t\tthis._chart._draggingEnabled = true;\n\t},\n\n\t/**\n\t * Sets a map view that contains the given geographical bounds.\n\t */\n\tfitBounds: function(bounds) {\n\t\tbounds = bounds || this.getBounds();\n\t\tif (this._map && bounds.isValid()) this._map.fitBounds(bounds);\n\t},\n\n\tgetBounds: function(data) {\n\t\tdata = data || this._data;\n\t\treturn L.latLngBounds(data.map((d) => d.latlng));\n\t},\n\n\t/**\n\t * Get default zoom level when \"followMarker\" is true.\n\t */\n\tgetZFollow: function() {\n\t\treturn this._zFollow;\n\t},\n\n\t/**\n\t * Hide current elevation chart profile.\n\t */\n\thide: function() {\n\t\t_.style(this._container, \"display\", \"none\");\n\t},\n\n\t/**\n\t * Initialize chart control \"options\" and \"container\".\n\t */\n\tinitialize: function(options) {\n\t\tthis.options = _.deepMerge({}, this.options, options);\n\n\t\tif (this.options.imperial) {\n\t\t\tthis._distanceFactor = this.__mileFactor;\n\t\t\tthis._heightFactor = this.__footFactor;\n\t\t\tthis._xLabel = \"mi\";\n\t\t\tthis._yLabel = \"ft\";\n\t\t} else {\n\t\t\tthis._distanceFactor = this.options.distanceFactor;\n\t\t\tthis._heightFactor = this.options.heightFactor;\n\t\t\tthis._xLabel = this.options.xLabel;\n\t\t\tthis._yLabel = this.options.yLabel;\n\t\t}\n\n\t\tthis._chartEnabled = true;\n\t\tthis._zFollow = this.options.zFollow;\n\n\t\tif (this.options.followMarker) this._setMapView = L.Util.throttle(this._setMapView, 300, this);\n\t\tif (this.options.placeholder) this.options.loadData.lazy = this.options.loadData.defer = true;\n\n\t\tif (this.options.legend) this.options.margins.bottom += 30;\n\t},\n\n\t/**\n\t * Alias for loadData\n\t */\n\tload: function(data, opts) {\n\t\tthis.loadData(data, opts);\n\t},\n\n\t/**\n\t * Alias for addTo\n\t */\n\tloadChart: function(map) {\n\t\tthis.addTo(map);\n\t},\n\n\t/**\n\t * Load elevation data (GPX or GeoJSON).\n\t */\n\tloadData: function(data, opts) {\n\t\topts = L.extend({}, this.options.loadData, opts);\n\t\tif (opts.defer) {\n\t\t\tthis.loadDefer(data, opts);\n\t\t} else if (opts.lazy) {\n\t\t\tthis.loadLazy(data, opts);\n\t\t} else if (_.isXMLDoc(data)) {\n\t\t\tthis.loadGPX(data);\n\t\t} else if (_.isJSONDoc(data)) {\n\t\t\tthis.loadGeoJSON(data);\n\t\t} else {\n\t\t\tthis.loadFile(data);\n\t\t}\n\t},\n\n\t/**\n\t * Wait for document load before download data.\n\t */\n\tloadDefer: function(data, opts) {\n\t\topts = L.extend({}, this.options.loadData, opts);\n\t\topts.defer = false;\n\t\t_.deferFunc(L.bind(this.loadData, this, data, opts));\n\t},\n\n\t/**\n\t * Load data from a remote url.\n\t */\n\tloadFile: function(url) {\n\t\t_.loadFile(url)\n\t\t\t.then((data) => {\n\t\t\t\tthis._downloadURL = url; // TODO: handle multiple urls?\n\t\t\t\tthis.loadData(data, { lazy: false, defer: false });\n\t\t\t})\n\t\t\t.catch((err) => console.warn(err));\n\t},\n\n\t/**\n\t * Load raw GeoJSON data.\n\t */\n\tloadGeoJSON: function(data) {\n\t\t_.GeoJSONLoader(data, this);\n\t},\n\n\t/**\n\t * Load raw GPX data.\n\t */\n\tloadGPX: function(data) {\n\t\tElevation._gpxLazyLoader = _.lazyLoader(\n\t\t\tthis.__LGPX,\n\t\t\ttypeof L.GPX !== 'function' || !this.options.lazyLoadJS,\n\t\t\tElevation._gpxLazyLoader\n\t\t).then(() => _.GPXLoader(data, this));\n\t},\n\n\t/**\n\t * Wait for chart container visible before download data.\n\t */\n\tloadLazy: function(data, opts) {\n\t\topts = L.extend({}, this.options.loadData, opts);\n\t\tlet elem = opts.lazy.parentNode ? opts.lazy : this.placeholder;\n\t\t_.waitHolder(elem)\n\t\t\t.then(() => {\n\t\t\t\topts.lazy = false;\n\t\t\t\tthis.loadData(data, opts)\n\t\t\t\tthis.once('eledata_loaded', () => opts.lazy.parentNode.removeChild(elem));\n\t\t\t});\n\t},\n\n\t/**\n\t * Create container DOM element and related event listeners.\n\t * Called on control.addTo(map).\n\t */\n\tonAdd: function(map) {\n\t\tthis._map = map;\n\n\t\tlet container = this._container = _.create(\"div\", \"elevation-control elevation \" + this.options.theme);\n\n\t\tif (!this.options.detached) {\n\t\t\t_.addClass(container, 'leaflet-control');\n\t\t}\n\n\t\tif (this.options.placeholder && !this._data) {\n\t\t\tthis.placeholder = _.create('img', 'elevation-placeholder', typeof this.options.placeholder === 'string' ? { src: this.options.placeholder, alt: '' } : this.options.placeholder);\n\t\t\t_.insert(container, this.placeholder, 'beforebegin');\n\t\t}\n\n\t\tElevation._d3LazyLoader = _.lazyLoader(\n\t\t\tthis.__D3,\n\t\t\ttypeof d3 !== 'object' || !this.options.lazyLoadJS,\n\t\t\tElevation._d3LazyLoader\n\t\t).then(() => {\n\t\t\tthis._initToggle(container);\n\t\t\tthis._initChart(container);\n\t\t\tthis._initMarker(container);\n\n\t\t\tmap.on('zoom viewreset zoomanim', this._hideMarker, this);\n\t\t\tmap.on('resize', this._resetView, this);\n\t\t\tmap.on('resize', this._resizeChart, this);\n\t\t\tmap.on('mousedown', this._resetDrag, this);\n\n\t\t\t_.on(map._container, 'mousewheel', this._resetDrag, this);\n\t\t\t_.on(map._container, 'touchstart', this._resetDrag, this);\n\n\t\t\tthis.on('eledata_added eledata_loaded', this._updateChart, this);\n\t\t\tthis.on('eledata_added eledata_loaded', this._updateSummary, this);\n\n\t\t\tthis._updateChart();\n\t\t\tthis._updateSummary();\n\t\t});\n\n\t\treturn container;\n\t},\n\n\t/**\n\t * Clean up control code and related event listeners.\n\t * Called on control.remove().\n\t */\n\tonRemove: function(map) {\n\t\tthis._container = null;\n\n\t\tmap.off('zoom viewreset zoomanim', this._hideMarker, this);\n\t\tmap.off('resize', this._resetView, this);\n\t\tmap.off('resize', this._resizeChart, this);\n\t\tmap.off('mousedown', this._resetDrag, this);\n\n\t\t_.off(map._container, 'mousewheel', this._resetDrag, this);\n\t\t_.off(map._container, 'touchstart', this._resetDrag, this);\n\n\t\tthis.off('eledata_added eledata_loaded', this._updateChart, this);\n\t\tthis.off('eledata_added eledata_loaded', this._updateSummary, this);\n\t},\n\n\t/**\n\t * Redraws the chart control. Sometimes useful after screen resize.\n\t */\n\tredraw: function() {\n\t\tthis._resizeChart();\n\t},\n\n\t/**\n\t * Set default zoom level when \"followMarker\" is true.\n\t */\n\tsetZFollow: function(zoom) {\n\t\tthis._zFollow = zoom;\n\t},\n\n\t/**\n\t * Hide current elevation chart profile.\n\t */\n\tshow: function() {\n\t\t_.style(this._container, \"display\", \"block\");\n\t},\n\n\t/*\n\t * Parsing data either from GPX or GeoJSON and update the diagram data\n\t */\n\t_addData: function(d) {\n\t\tlet geom = d && d.geometry;\n\t\tlet feat = d && d.type === \"FeatureCollection\";\n\t\tlet gpx = d && d._latlngs;\n\n\t\tif (geom) {\n\t\t\tswitch (geom.type) {\n\t\t\t\tcase 'LineString':\n\t\t\t\t\tthis._addGeoJSONData(geom.coordinates);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'MultiLineString':\n\t\t\t\t\t_.each(geom.coordinates, coords => this._addGeoJSONData(coords));\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.warn('Unsopperted GeoJSON feature geometry type:' + geom.type);\n\t\t\t}\n\t\t}\n\n\t\tif (feat) {\n\t\t\t_.each(d.features, feature => this._addData(feature));\n\t\t}\n\n\t\tif (gpx) {\n\t\t\tthis._addGPXData(d._latlngs);\n\t\t}\n\t},\n\n\t/*\n\t * Parsing of GeoJSON data lines and their elevation in z-coordinate\n\t */\n\t_addGeoJSONData: function(coords) {\n\t\t_.each(coords, point => this._addPoint(point[1], point[0], point[2]));\n\t},\n\n\t/*\n\t * Parsing function for GPX data and their elevation in z-coordinate\n\t */\n\t_addGPXData: function(coords) {\n\t\t_.each(coords, point => this._addPoint(point.lat, point.lng, point.meta.ele));\n\t},\n\n\t/*\n\t * Parse and push a single (x, y, z) point to current elevation profile.\n\t */\n\t_addPoint: function(x, y, z) {\n\t\tif (this.options.reverseCoords) {\n\t\t\t[x, y] = [y, x];\n\t\t}\n\n\t\tlet data = this._data || [];\n\t\tlet i = data.length;\n\t\tlet eleMax = this._maxElevation || -Infinity;\n\t\tlet eleMin = this._minElevation || +Infinity;\n\t\tlet dist = this._distance || 0;\n\n\t\tlet curr = new L.LatLng(x, y);\n\t\tlet prev = i > 0 ? data[i - 1].latlng : curr;\n\n\t\tlet delta = curr.distanceTo(prev) * this._distanceFactor;\n\n\t\tdist = dist + Math.round(delta / 1000 * 100000) / 100000;\n\n\t\t// check and fix missing elevation data on last added point\n\t\tif (!this.options.skipNullZCoords && i > 0) {\n\t\t\tlet prevZ = data[i - 1].z;\n\t\t\tif (isNaN(prevZ)) {\n\t\t\t\tlet lastZ = this._lastValidZ;\n\t\t\t\tlet currZ = z * this._heightFactor;\n\t\t\t\tif (!isNaN(lastZ) && !isNaN(currZ)) {\n\t\t\t\t\tprevZ = (lastZ + currZ) / 2;\n\t\t\t\t} else if (!isNaN(lastZ)) {\n\t\t\t\t\tprevZ = lastZ;\n\t\t\t\t} else if (!isNaN(currZ)) {\n\t\t\t\t\tprevZ = currZ;\n\t\t\t\t}\n\t\t\t\tif (!isNaN(prevZ)) data[i - 1].z = prevZ;\n\t\t\t\telse data.splice(i - 1, 1);\n\t\t\t}\n\t\t}\n\n\t\tz = z * this._heightFactor;\n\n\t\t// skip point if it has not elevation\n\t\tif (!isNaN(z)) {\n\t\t\teleMax = eleMax < z ? z : eleMax;\n\t\t\teleMin = eleMin > z ? z : eleMin;\n\t\t\tthis._lastValidZ = z;\n\t\t}\n\n\t\tdata.push({\n\t\t\tdist: dist,\n\t\t\tx: x,\n\t\t\ty: y,\n\t\t\tz: z,\n\t\t\tlatlng: curr\n\t\t});\n\n\t\tthis._data = data;\n\t\tthis.track_info = this.track_info || {};\n\t\tthis.track_info.distance = this._distance = dist;\n\t\tthis.track_info.elevation_max = this._maxElevation = eleMax;\n\t\tthis.track_info.elevation_min = this._minElevation = eleMin;\n\n\t\tthis._fireEvt(\"eledata_updated\", { index: i });\n\t},\n\n\t_addLayer: function(layer) {\n\t\tif (layer) {\n\t\t\t_.addClass(layer._path, this.options.polyline.className + ' ' + this.options.theme);\n\n\t\t\tlayer\n\t\t\t\t.on(\"mousemove\", this._mousemoveLayerHandler, this)\n\t\t\t\t.on(\"mouseout\", this._mouseoutHandler, this);\n\n\t\t\tthis._layers = this._layers || L.layerGroup();\n\t\t\tthis._layers.addLayer(layer)\n\t\t}\n\t},\n\n\t/**\n\t * Adds the control to the given \"detached\" div.\n\t */\n\t_initElevationDiv: function() {\n\t\tlet eleDiv = _.select(this.options.elevationDiv);\n\t\tif (!eleDiv) {\n\t\t\tthis.options.elevationDiv = '#elevation-div_' + _.randomId();\n\t\t\teleDiv = _.create('div', 'leaflet-control elevation elevation-div', { id: this.options.elevationDiv.substr(1) });\n\t\t}\n\t\tif (this.options.detached) {\n\t\t\t_.addClass(eleDiv, 'elevation-detached');\n\t\t\t_.removeClass(eleDiv, 'leaflet-control');\n\t\t}\n\t\tthis.eleDiv = eleDiv;\n\t\treturn this.eleDiv;\n\t},\n\n\t/*\n\t * Collapse current chart control.\n\t */\n\t_collapse: function() {\n\t\t_.removeClass(this._container, 'elevation-expanded');\n\t\t_.addClass(this._container, 'elevation-collapsed');\n\t},\n\n\t/*\n\t * Expand current chart control.\n\t */\n\t_expand: function() {\n\t\t_.removeClass(this._container, 'elevation-collapsed');\n\t\t_.addClass(this._container, 'elevation-expanded');\n\t},\n\n\t/*\n\t * Finds an item with the smallest delta in distance to the given latlng coords\n\t */\n\t_findItemForLatLng: function(latlng) {\n\t\tlet result = null;\n\t\tlet d = Infinity;\n\t\t_.each(this._data,\n\t\t\titem => {\n\t\t\t\tlet dist = latlng.distanceTo(item.latlng);\n\t\t\t\tif (dist < d) {\n\t\t\t\t\td = dist;\n\t\t\t\t\tresult = item;\n\t\t\t\t}\n\t\t\t});\n\t\treturn result;\n\t},\n\n\t/*\n\t * Finds a data entry for a given x-coordinate of the diagram\n\t */\n\t_findItemForX: function(x) {\n\t\treturn this._chart._findItemForX(x);\n\t},\n\n\t/**\n\t * Fires an event of the specified type.\n\t */\n\t_fireEvt: function(type, data, propagate) {\n\t\tif (this.fire) this.fire(type, data, propagate);\n\t\tif (this._map) this._map.fire(type, data, propagate);\n\t},\n\n\t/**\n\t * Calculates chart height.\n\t */\n\t_height: function() {\n\t\tlet opts = this.options;\n\t\treturn opts.height - opts.margins.top - opts.margins.bottom;\n\t},\n\n\t/*\n\t * Hides the position/height indicator marker drawn onto the map\n\t */\n\t_hideMarker: function() {\n\t\tif (this.options.autohideMarker) {\n\t\t\tthis._marker.remove();\n\t\t}\n\t},\n\n\t/**\n\t * Generate \"svg\" chart DOM element.\n\t */\n\t_initChart: function() {\n\t\tlet opts = this.options;\n\t\topts.xTicks = opts.xTicks || Math.round(this._width() / 75);\n\t\topts.yTicks = opts.yTicks || Math.round(this._height() / 30);\n\n\t\tif (opts.responsive) {\n\t\t\tif (opts.detached) {\n\t\t\t\tlet offWi = this.eleDiv.offsetWidth;\n\t\t\t\tlet offHe = this.eleDiv.offsetHeight;\n\t\t\t\topts.width = offWi > 0 ? offWi : opts.width;\n\t\t\t\topts.height = (offHe - 20) > 0 ? offHe - 20 : opts.height; // 20 = horizontal scrollbar size.\n\t\t\t} else {\n\t\t\t\topts._maxWidth = opts._maxWidth > opts.width ? opts._maxWidth : opts.width;\n\t\t\t\tlet containerWidth = this._map._container.clientWidth;\n\t\t\t\topts.width = opts._maxWidth > containerWidth ? containerWidth - 30 : opts.width;\n\t\t\t}\n\t\t}\n\n\t\tlet chart = this._chart = new Chart(opts);\n\t\tlet summary = this._summary = new Summary(opts);\n\n\t\tlet container = d3.select(this._container)\n\t\t\t.call(chart.render())\n\t\t\t.call(summary.render());\n\n\t\tthis._svg = chart._svg;\n\t\tthis._grid = chart._grid;\n\t\tthis._area = chart._area;\n\t\tthis._path = chart._path;\n\t\tthis._axis = chart._axis;\n\t\tthis._focus = chart._focus;\n\t\tthis._focusRect = chart._focusRect;\n\t\tthis._x = chart._x;\n\t\tthis._y = chart._y;\n\t\tthis._legend = chart._legend;\n\t\tthis._focuslabel = chart._focuslabel;\n\t\tthis._focusline = chart._focusline;\n\t\tthis.summaryDiv = summary._summary;\n\n\t\tchart.on('reset_drag', this._hideMarker, this);\n\t\tchart.on('mouse_enter', this._fireEvt.bind('elechart_enter'), this);\n\t\tchart.on('dragged', this._fireEvt.bind(\"elechart_dragged\"), this);\n\t\tchart.on('mouse_move', this._mousemoveHandler, this);\n\t\tchart.on('mouse_out', this._mouseoutHandler, this);\n\t\t// chart.on('legend', this._fireEvt.bind('elechart_legend'), this);\n\n\t\tthis._fireEvt(\"elechart_init\");\n\t},\n\n\t_initMarker: function(container) {\n\t\tthis._marker = (new Marker(this.options)).addTo(this._map);\n\n\t\tthis._mouseHeightFocusLabel = this._marker._mouseHeightFocusLabel;\n\t},\n\n\t/**\n\t * Inspired by L.Control.Layers\n\t */\n\t_initToggle: function(container) {\n\t\t//Makes this work on IE10 Touch devices by stopping it from firing a mouseout event when the touch is released\n\t\tcontainer.setAttribute('aria-haspopup', true);\n\n\t\tif (!this.options.detached) {\n\t\t\tL.DomEvent\n\t\t\t\t.disableClickPropagation(container);\n\t\t\t//.disableScrollPropagation(container);\n\t\t}\n\n\t\tif (L.Browser.mobile) {\n\t\t\t_.on(container, 'click', L.DomEvent.stopPropagation);\n\t\t}\n\n\t\t_.on(container, 'mousewheel', this._mousewheelHandler, this);\n\n\t\tif (!this.options.detached) {\n\t\t\tlet link = this._button = _.create('a', \"elevation-toggle elevation-toggle-icon\" + (this.options.autohide ? \"\" : \" close-button\"), { href: '#', title: L._('Elevation') }, container);\n\n\t\t\tif (this.options.collapsed) {\n\t\t\t\tthis._collapse();\n\t\t\t\tif (this.options.autohide) {\n\t\t\t\t\t_.on(container, 'mouseover', this._expand, this);\n\t\t\t\t\t_.on(container, 'mouseout', this._collapse, this);\n\t\t\t\t} else {\n\t\t\t\t\t_.on(link, 'click', L.DomEvent.stop);\n\t\t\t\t\t_.on(link, 'click', this._toggle, this);\n\t\t\t\t}\n\n\t\t\t\t_.on(link, 'focus', this._toggle, this);\n\n\t\t\t\tthis._map.on('click', this._collapse, this);\n\t\t\t\t// TODO: keyboard accessibility\n\t\t\t}\n\t\t} else {\n\t\t\t// TODO: handle autohide when detached=true\n\t\t}\n\t},\n\n\t/*\n\t * Handles the moueseover the chart and displays distance and altitude level.\n\t */\n\t_mousemoveHandler: function(e) {\n\t\tif (!this._data || this._data.length === 0 || !this._chartEnabled) {\n\t\t\treturn;\n\t\t}\n\t\tlet xCoord = e.xCoord;\n\t\tlet item = this._data[this._findItemForX(xCoord)];\n\n\t\tthis._updateMarker(item);\n\t\tthis._setMapView(item);\n\n\t\tif (this._map) {\n\t\t\t_.addClass(this._map._container, 'elechart-hover');\n\t\t}\n\n\t\tthis._fireEvt(\"elechart_change\", { data: item, xCoord: xCoord });\n\t\tthis._fireEvt(\"elechart_hover\", { data: item, xCoord: xCoord });\n\t},\n\n\t/*\n\t * Handles mouseover events of the data layers on the map.\n\t */\n\t_mousemoveLayerHandler: function(e) {\n\t\tif (!this._data || this._data.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet item = this._findItemForLatLng(e.latlng);\n\t\tif (item) {\n\t\t\tlet xCoord = item.xDiagCoord;\n\n\t\t\tif (this._chartEnabled) this._chart._showDiagramIndicator(item, xCoord);\n\n\t\t\tthis._updateMarker(item);\n\n\t\t\tthis._fireEvt(\"elechart_change\", { data: item, xCoord: xCoord });\n\t\t}\n\t},\n\n\t/*\n\t * Handles the moueseout over the chart.\n\t */\n\t_mouseoutHandler: function() {\n\t\tif (!this.options.detached) {\n\t\t\tthis._hideMarker();\n\t\t\tthis._chart._hideDiagramIndicator();\n\t\t}\n\n\t\tif (this._map) {\n\t\t\t_.removeClass(this._map._container, 'elechart-hover');\n\t\t}\n\n\t\tthis._fireEvt(\"elechart_leave\");\n\t},\n\n\t/*\n\t * Handles the mouesewheel over the chart.\n\t */\n\t_mousewheelHandler: function(e) {\n\t\tif (this._map.gestureHandling && this._map.gestureHandling._enabled) return;\n\t\tlet ll = this._marker.getLatLng() || this._map.getCenter();\n\t\tlet z = this._map.getZoom() + Math.sign(e.deltaY);\n\t\tthis._resetDrag();\n\t\tthis._map.flyTo(ll, z);\n\t},\n\n\t/*\n\t * Removes the drag rectangle and zoms back to the total extent of the data.\n\t */\n\t_resetDrag: function() {\n\t\tthis._chart._resetDrag();\n\t\tthis._hideMarker();\n\t},\n\n\t/**\n\t * Resets drag, marker and bounds.\n\t */\n\t_resetView: function() {\n\t\tif (this._map && this._map._isFullscreen) return;\n\t\tthis._resetDrag();\n\t\tthis._hideMarker();\n\t\tthis.fitBounds();\n\t},\n\n\t/**\n\t * Hacky way for handling chart resize. Deletes it and redraw chart.\n\t */\n\t_resizeChart: function() {\n\t\t// prevent displaying chart on resize if hidden\n\t\tif (_.style(this._container, \"display\") == \"none\") return;\n\n\t\tif (this.options.responsive) {\n\t\t\tif (this.options.detached) {\n\t\t\t\tlet newWidth = this.eleDiv.offsetWidth; // - 20;\n\t\t\t\tif (newWidth) {\n\t\t\t\t\tthis.options.width = newWidth;\n\t\t\t\t\tthis.eleDiv.innerHTML = \"\";\n\t\t\t\t\t_.append(this.eleDiv, this.onAdd(this._map));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._map.removeControl(this._container);\n\t\t\t\tthis.addTo(this._map);\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * Collapse or Expand current chart control.\n\t */\n\t_toggle: function() {\n\t\tif (_.hasClass(this._container, \"elevation-expanded\"))\n\t\t\tthis._collapse();\n\t\telse\n\t\t\tthis._expand();\n\t},\n\n\t/**\n\t * Sets the view of the map (center and zoom). Useful when \"followMarker\" is true.\n\t */\n\t_setMapView: function(item) {\n\t\tif (!this.options.followMarker || !this._map) return;\n\t\tlet zoom = this._map.getZoom();\n\t\tzoom = zoom < this._zFollow ? this._zFollow : zoom;\n\t\tthis._map.setView(item.latlng, zoom, { animate: true, duration: 0.25 });\n\t},\n\n\t/**\n\t * Calculates [x, y] domain and then update chart.\n\t */\n\t_updateChart: function() {\n\t\tif (!this._data || !this._container) return;\n\n\t\tthis._chart = this._chart.update({ data: this._data });\n\n\t\tthis._x = this._chart._x;\n\t\tthis._y = this._chart._y;\n\n\t\tthis._fireEvt(\"elechart_axis\");\n\t\tif (this.options.legend) this._fireEvt(\"elechart_legend\");\n\n\t\tthis._fireEvt('elechart_updated');\n\t},\n\n\t/*\n\t * Update the position/height indicator marker drawn onto the map\n\t */\n\t_updateMarker: function(item) {\n\t\tthis._marker.update({ item: item, maxElevation: this._maxElevation, options: this.options });\n\t},\n\n\t/**\n\t * Update chart summary.\n\t */\n\t_updateSummary: function() {\n\t\tthis.track_info = this.track_info || {};\n\t\tthis.track_info.distance = this._distance || 0;\n\t\tthis.track_info.elevation_max = this._maxElevation || 0;\n\t\tthis.track_info.elevation_min = this._minElevation || 0;\n\n\t\tthis._summary.reset();\n\n\t\tif (this.options.summary) {\n\t\t\tthis._fireEvt(\"elechart_summary\");\n\t\t}\n\t\tif (this.options.downloadLink && this._downloadURL) { // TODO: generate dynamically file content instead of using static file urls.\n\t\t\tthis.summaryDiv.innerHTML += '<span class=\"download\"><a href=\"#\">' + L._('Download') + '</a></span>'\n\t\t\t_.select('.download a', this.summaryDiv).onclick = (e) => {\n\t\t\t\te.preventDefault();\n\t\t\t\tthis._fireEvt('eletrack_download', { downloadLink: this.options.downloadLink, confirm: _.saveFile.bind(this, this._downloadURL) });\n\t\t\t};\n\t\t};\n\t},\n\n\n\t/**\n\t * Calculates chart width.\n\t */\n\t_width: function() {\n\t\tlet opts = this.options;\n\t\treturn opts.width - opts.margins.left - opts.margins.right;\n\t},\n\n});\n\n/**\n * Attach here some useful elevation hooks.\n */\nElevation.addInitHook(function() {\n\n\tthis.on('waypoint_added', function(e) {\n\t\tlet p = e.point,\n\t\t\tpop = p._popup;\n\t\tif (pop) {\n\t\t\tpop.options.className = 'elevation-popup';\n\t\t}\n\t\tif (pop._content) {\n\t\t\tpop._content = decodeURI(pop._content);\n\t\t\tp.bindTooltip(pop._content, { direction: 'top', sticky: true, opacity: 1, className: 'elevation-tooltip' }).openTooltip();\n\t\t}\n\t});\n\n\tthis.on('elepath_toggle', function(e) {\n\t\tlet path = e.path;\n\n\t\tlet enabled = _.hasClass(path, 'hidden');\n\t\tlet text = _.select('text', e.legend);\n\n\t\tif (enabled) {\n\t\t\t_.removeClass(path, 'hidden');\n\t\t\t_.style(text, \"text-decoration-line\", \"\")\n\t\t} else {\n\t\t\t_.addClass(path, 'hidden');\n\t\t\t_.style(text, \"text-decoration-line\", \"line-through\")\n\t\t}\n\n\t\tthis._chartEnabled = this._area.selectAll('path:not(.hidden)').nodes().length != 0;\n\n\t\t// autotoggle chart data on single click\n\t\tif (!this._chartEnabled) {;\n\t\t\tthis._resetDrag();\n\t\t\t// this._clearPath();\n\t\t} else {\n\t\t\t// this._resizeChart();\n\t\t\tif (this._layers) {\n\t\t\t\tthis._layers.eachLayer(l => _.addClass(l._path, this.options.polyline.className + ' ' + this.options.theme));\n\t\t\t}\n\t\t}\n\t});\n\n\tthis.on(\"elechart_dragged\", function(e) {\n\t\tthis._hideMarker();\n\t\tthis.fitBounds(L.latLngBounds([e.dragstart.latlng, e.dragend.latlng]));\n\t});\n\n\tthis.on(\"elechart_updated\", function() {\n\t\t// TODO: maybe should i listen for this inside chart.js?\n\t\tthis._legend.selectAll('.legend-item')\n\t\t\t.on('click', (d, i, n) => {\n\t\t\t\tlet target = n[i];\n\t\t\t\tlet name = target.getAttribute('data-name');\n\t\t\t\tlet path = this._area.select('path[data-name=\"' + name + '\"]').node();\n\t\t\t\tthis._fireEvt(\"elepath_toggle\", { path: path, name: name, legend: target });\n\t\t\t});\n\t});\n\n\tthis.on(\"eletrack_download\", function(e) {\n\t\tif (e.downloadLink == 'modal' && typeof CustomEvent === \"function\") {\n\t\t\tdocument.dispatchEvent(new CustomEvent(\"eletrack_download\", { detail: e }));\n\t\t} else if (e.downloadLink == 'link' || e.downloadLink === true) {\n\t\t\te.confirm();\n\t\t}\n\t});\n\n\tthis.on('eledata_loaded', function(e) {\n\t\tlet layer = e.layer;\n\t\tif (this._map) {\n\t\t\tthis._map.once('layeradd', function(e) {\n\t\t\t\tthis.fitBounds(layer.getBounds());\n\t\t\t}, this);\n\t\t\tlayer.addTo(this._map);\n\t\t} else {\n\t\t\tconsole.warn(\"Undefined elevation map object\");\n\t\t}\n\t});\n\n\tthis.on('eledata_clear', function() {\n\t\tthis._area.selectAll('path')\n\t\t\t.attr(\"d\", \"M0 0\");\n\t\tif (this._path) {\n\t\t\t// this._x.domain([0, 1]);\n\t\t\t// this._y.domain([0, 1]);\n\t\t\t// this._updateAxis();\n\t\t}\n\t});\n});","import 'leaflet-i18n';\nimport * as _ from './utils';\nimport * as D3 from './components';\nimport { Elevation } from './control';\n\nElevation.addInitHook(function() {\n\n\tthis.on(\"elechart_legend\", function() {\n\t\tthis._altitudeLegend = this._legend.append('g')\n\t\t\t.call(\n\t\t\t\tD3.LegendItem({\n\t\t\t\t\tname: 'Altitude',\n\t\t\t\t\twidth: this._width(),\n\t\t\t\t\theight: this._height(),\n\t\t\t\t\tmargins: this.options.margins,\n\t\t\t\t})\n\t\t\t);\n\t});\n\n\tthis.on(\"elechart_summary\", function() {\n\t\tthis.summaryDiv.innerHTML +=\n\t\t\t'<span class=\"totlen\"><span class=\"summarylabel\">' + L._(\"Total Length: \") + '</span><span class=\"summaryvalue\">' + this.track_info.distance.toFixed(2) + '&nbsp;' + this._xLabel + '</span></span>' +\n\t\t\t'<span class=\"maxele\"><span class=\"summarylabel\">' + L._(\"Max Elevation: \") + '</span><span class=\"summaryvalue\">' + this.track_info.elevation_max.toFixed(2) + '&nbsp;' + this._yLabel + '</span></span>' +\n\t\t\t'<span class=\"minele\"><span class=\"summarylabel\">' + L._(\"Min Elevation: \") + '</span><span class=\"summaryvalue\">' + this.track_info.elevation_min.toFixed(2) + '&nbsp;' + this._yLabel + '</span></span>';\n\t});\n\n\tthis.on(\"eledata_clear\", function() {\n\t\tthis._maxElevation = null;\n\t\tthis._minElevation = null;\n\t});\n\n});\n","import 'leaflet-i18n';\nimport * as _ from './utils';\nimport * as D3 from './components';\nimport { Elevation } from './control';\n\nElevation.addInitHook(function() {\n\n\tif (!this.options.slope) return;\n\n\tlet opts = this.options;\n\tlet slope = {};\n\topts.margins.right = 50;\n\n\tif (this.options.slope != \"summary\") {\n\n\t\tthis.on(\"elechart_init\", function() {\n\t\t\tslope.path = this._area.append('path')\n\t\t\t\t.style(\"pointer-events\", \"none\")\n\t\t\t\t// TODO: add a class here.\n\t\t\t\t.attr(\"fill\", \"#F00\")\n\t\t\t\t.attr(\"stroke\", \"#000\")\n\t\t\t\t.attr(\"stroke-opacity\", \"0.5\")\n\t\t\t\t.attr(\"fill-opacity\", \"0.25\");\n\t\t});\n\n\t\tthis.on(\"elechart_axis\", function() {\n\t\t\tslope.x = this._x;\n\n\t\t\t// slope.x = D3.Scale({\n\t\t\t// \tdata: this._data,\n\t\t\t// \trange: [0, this._width()],\n\t\t\t// \tattr: opts.xAttr,\n\t\t\t// \tmin: opts.xAxisMin,\n\t\t\t// \tmax: opts.xAxisMax,\n\t\t\t// \tforceBounds: opts.forceAxisBounds,\n\t\t\t// });\n\n\t\t\tslope.y = D3.Scale({\n\t\t\t\tdata: this._data,\n\t\t\t\trange: [this._height(), 0],\n\t\t\t\tattr: \"slope\",\n\t\t\t\tmin: -1,\n\t\t\t\tmax: +1,\n\t\t\t\tforceBounds: opts.forceAxisBounds,\n\t\t\t});\n\n\t\t\tslope.axis = D3.Axis({\n\t\t\t\taxis: \"y\",\n\t\t\t\tposition: \"right\",\n\t\t\t\twidth: this._width(),\n\t\t\t\theight: this._height(),\n\t\t\t\tscale: slope.y,\n\t\t\t\tticks: this.options.yTicks,\n\t\t\t\ttickPadding: 16,\n\t\t\t\tlabel: \"%\",\n\t\t\t\tlabelX: 25,\n\t\t\t\tlabelY: 3,\n\t\t\t});\n\n\t\t\tthis._axis.call(slope.axis);\n\t\t});\n\n\t\tthis.on(\"elechart_updated\", function() {\n\t\t\tslope.area = D3.Area({\n\t\t\t\tinterpolation: opts.sInterpolation,\n\t\t\t\tdata: this._data,\n\t\t\t\tname: 'Slope',\n\t\t\t\txAttr: opts.xAttr,\n\t\t\t\tyAttr: \"slope\",\n\t\t\t\twidth: this._width(),\n\t\t\t\theight: this._height(),\n\t\t\t\tscaleX: slope.x,\n\t\t\t\tscaleY: slope.y,\n\t\t\t});\n\n\t\t\tslope.path.call(slope.area);\n\t\t});\n\n\t\tthis.on(\"elechart_legend\", function() {\n\t\t\tslope.legend = this._legend.append(\"g\")\n\t\t\t\t.call(\n\t\t\t\t\tD3.LegendItem({\n\t\t\t\t\t\tname: 'Slope',\n\t\t\t\t\t\twidth: this._width(),\n\t\t\t\t\t\theight: this._height(),\n\t\t\t\t\t\tmargins: this.options.margins,\n\t\t\t\t\t})\n\t\t\t\t);\n\n\t\t\tthis._altitudeLegend\n\t\t\t\t.attr(\"transform\", \"translate(-50, 0)\");\n\n\t\t\tslope.legend\n\t\t\t\t.attr(\"transform\", \"translate(50, 0)\");\n\n\t\t\tslope.legend.select(\"rect\")\n\t\t\t\t.classed(\"area\", false)\n\t\t\t\t// TODO: add a class here.\n\t\t\t\t.attr(\"fill\", \"#F00\")\n\t\t\t\t.attr(\"stroke\", \"#000\")\n\t\t\t\t.attr(\"stroke-opacity\", \"0.5\")\n\t\t\t\t.attr(\"fill-opacity\", \"0.25\");\n\n\t\t});\n\t}\n\n\tthis.on(\"eledata_updated\", function(e) {\n\t\tlet data = this._data;\n\t\tlet i = e.index;\n\t\tlet z = data[i].z;\n\n\t\tlet curr = data[i].latlng;\n\t\tlet prev = i > 0 ? data[i - 1].latlng : curr;\n\n\t\tlet delta = curr.distanceTo(prev) * this._distanceFactor;\n\n\t\t// Slope / Gain\n\t\tlet tAsc = this._tAsc || 0; // Total Ascent\n\t\tlet tDes = this._tDes || 0; // Total Descent\n\t\tlet sMax = this._sMax || 0; // Slope Max\n\t\tlet sMin = this._sMin || 0; // Slope Min\n\t\tlet slope = 0;\n\n\t\tif (!isNaN(z)) {\n\t\t\tlet deltaZ = i > 0 ? z - data[i - 1].z : 0;\n\t\t\tif (deltaZ > 0) tAsc += deltaZ;\n\t\t\telse if (deltaZ < 0) tDes -= deltaZ;\n\t\t\t// slope in % = ( height / length ) * 100\n\t\t\tslope = delta !== 0 ? (deltaZ / delta) * 100 : 0;\n\t\t}\n\n\t\tif (this.options.sDeltaMax) {\n\t\t\tlet deltaS = i > 0 ? slope - data[i - 1].slope : 0;\n\t\t\tlet maxDeltaS = this.options.sDeltaMax;\n\t\t\tif (Math.abs(deltaS) > maxDeltaS) {\n\t\t\t\tslope = data[i - 1].slope + maxDeltaS * Math.sign(deltaS);\n\t\t\t}\n\t\t}\n\n\t\tif (this.options.sRange) {\n\t\t\tlet range = this.options.sRange;\n\t\t\tif (slope < range[0]) slope = range[0];\n\t\t\telse if (slope > range[1]) slope = range[1];\n\t\t}\n\n\t\tslope = L.Util.formatNum(slope, 2);\n\n\t\tsMax = slope > sMax ? slope : sMax;\n\t\tsMin = slope < sMin ? slope : sMin;\n\n\t\tdata[i].slope = slope;\n\n\t\tthis.track_info = this.track_info || {};\n\t\tthis.track_info.ascent = this._tAsc = tAsc;\n\t\tthis.track_info.descent = this._tDes = tDes;\n\t\tthis.track_info.slope_max = this._sMax = sMax;\n\t\tthis.track_info.slope_min = this._sMin = sMin;\n\t});\n\n\tthis.on(\"elechart_change\", function(e) {\n\t\tlet item = e.data;\n\t\tlet xCoordinate = e.xCoord;\n\n\t\tif (this._focuslabel) {\n\t\t\tif (!this._focuslabelSlope || !this._focuslabelSlope.property('isConnected')) {\n\t\t\t\tthis._focuslabelSlope = this._focuslabel.select('text').insert(\"svg:tspan\", \".mouse-focus-label-x\")\n\t\t\t\t\t.attr(\"class\", \"mouse-focus-label-slope\")\n\t\t\t\t\t.attr(\"dy\", \"1.5em\");\n\t\t\t}\n\n\t\t\tthis._focuslabelSlope.text(item.slope + \"%\");\n\n\t\t\tthis._focuslabel.select('.mouse-focus-label-x')\n\t\t\t\t.attr(\"dy\", \"1.5em\");\n\t\t}\n\n\t\tif (this._mouseHeightFocusLabel) {\n\t\t\tif (!this._mouseSlopeFocusLabel) {\n\t\t\t\tthis._mouseSlopeFocusLabel = this._mouseHeightFocusLabel.append(\"svg:tspan\")\n\t\t\t\t\t.attr(\"class\", \"height-focus-slope \");\n\t\t\t}\n\n\t\t\tthis._mouseSlopeFocusLabel\n\t\t\t\t.attr(\"dy\", \"1.5em\")\n\t\t\t\t.text(Math.round(item.slope) + \"%\");\n\n\t\t\tthis._mouseHeightFocusLabel.select('.height-focus-y')\n\t\t\t\t.attr(\"dy\", \"-1.5em\");\n\t\t}\n\t});\n\n\tthis.on(\"elechart_summary\", function() {\n\t\tthis.track_info.ascent = this._tAsc || 0;\n\t\tthis.track_info.descent = this._tDes || 0;\n\t\tthis.track_info.slope_max = this._sMax || 0;\n\t\tthis.track_info.slope_min = this._sMin || 0;\n\n\t\tthis.summaryDiv.querySelector('.minele').insertAdjacentHTML('afterend', '<span class=\"ascent\"><span class=\"summarylabel\">' + L._(\"Total Ascent: \") + '</span><span class=\"summaryvalue\">' + Math.round(this.track_info.ascent) + '&nbsp;' +\n\t\t\tthis._yLabel +\n\t\t\t'</span></span>' + '<span class=\"descent\"><span class=\"summarylabel\">' + L._(\"Total Descent: \") + '</span><span class=\"summaryvalue\">' + Math.round(this.track_info.descent) + '&nbsp;' + this._yLabel +\n\t\t\t'</span></span>' + '<span class=\"minslope\"><span class=\"summarylabel\">' + L._(\"Min Slope: \") + '</span><span class=\"summaryvalue\">' + this.track_info.slope_min + '&nbsp;' + '%' +\n\t\t\t'</span></span>' + '<span class=\"maxslope\"><span class=\"summarylabel\">' + L._(\"Max Slope: \") + '</span><span class=\"summaryvalue\">' + this.track_info.slope_max + '&nbsp;' + '%' +\n\t\t\t'</span></span>');\n\t});\n\n\tthis.on(\"eledata_clear\", function() {\n\t\tthis._sMax = null;\n\t\tthis._sMin = null;\n\t\tthis._tAsc = null;\n\t\tthis._tDes = null;\n\t});\n\n});\n","/*\n * Copyright (c) 2019, GPL-3.0+ Project, Raruto\n *\n *  This file is free software: you may copy, redistribute and/or modify it\n *  under the terms of the GNU General Public License as published by the\n *  Free Software Foundation, either version 2 of the License, or (at your\n *  option) any later version.\n *\n *  This file is distributed in the hope that it will be useful, but\n *  WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n *  General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see .\n *\n * This file incorporates work covered by the following copyright and\n * permission notice:\n *\n *     Copyright (c) 2013-2016, MIT License, Felix MrMufflon Bache\n *\n *     Permission to use, copy, modify, and/or distribute this software\n *     for any purpose with or without fee is hereby granted, provided\n *     that the above copyright notice and this permission notice appear\n *     in all copies.\n *\n *     THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL\n *     WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED\n *     WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE\n *     AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR\n *     CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS\n *     OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT,\n *     NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN\n *     CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.\n */\n\nimport 'leaflet-i18n';\nimport * as _ from './utils';\nimport * as D3 from './components';\nimport { Chart } from './chart';\nimport { Elevation } from './control';\nimport './altitude';\nimport './slope';\n\nElevation.Utils = _;\nElevation.Components = D3;\nElevation.Chart = Chart;\n\nL.control.elevation = (options) => new Elevation(options);\n"],"names":["deepMerge","target","sources","length","source","shift","isObject","key","Object","assign","deferFunc","f","document","readyState","window","addEventListener","once","formatter","num","dec","sep","res","L","Util","formatNum","toString","numbers","split","d","join","GeoJSONLoader","data","control","JSON","parse","this","layer","geoJson","style","feature","extend","options","polyline","theme","className","pointToLayer","latlng","marker","icon","gpxOptions","marker_options","wptIcons","desc","properties","name","bindPopup","openPopup","fire","point","point_type","element","onEachFeature","geometry","type","addData","track_info","Control","Elevation","_d3LazyLoader","then","_fireEvt","GPXLoader","polyline_options","GPX","on","e","line","get_name","item","_typeof","Array","isArray","isVisible","elem","styles","getComputedStyle","visibility","display","isVisibleByStyles","boundingRect","getBoundingClientRect","left","right","top","above","bottom","pointerEvents","elementFromPoint","isAboveOtherElements","isJSONDoc","doc","lazy","trim","indexOf","console","warn","isXMLDoc","documentElement","ownerDocument","nodeName","lazyLoader","url","skip","loader","Promise","resolve","reject","tag","createElement","src","head","appendChild","loadFile","success","xhr","XMLHttpRequest","responseType","open","onload","response","onerror","status","send","saveFile","dataURI","fileName","a","create","href","download","b","body","click","removeChild","waitHolder","ticking","scrollFn","requestAnimFrame","removeEventListener","addClass","targetNode","each","s","DomUtil","removeClass","value","getStyle","setProperty","tagName","attributes","parent","setAttributes","append","child","insert","position","insertAdjacentElement","attrs","k","setAttribute","select","selector","context","querySelector","factory","define","amd","exports","module","require","locales","locale","registerLocale","code","setLocale","i18n","_","string","template","err","DomEvent","off","hasClass","randomId","Math","random","substr","obj","fn","i","offsetWidth","offsetHeight","getClientRects","Area","xAttr","yAttr","scaleX","scaleY","height","interpolation","path","d3","area","curve","x","xDiagCoord","y0","y1","datum","attr","Axis","tickSize","tickPadding","width","axis","scale","ticks","tickFormat","label","labelX","labelY","g","w","h","axisScale","replace","l","toUpperCase","axisGroup","call","text","DragRectangle","dragStartCoords","dragEndCoords","rect","x1","min","x2","max","FocusRect","Grid","props","HeightFocusLine","xCoord","yCoord","HeightFocusLabel","y","node","selectAll","HeightFocusPoint","circle","LegendItem","margins","toLowerCase","MouseFocusLine","MouseFocusLabel","xAlign","yAlign","bbox","getBBox","Browser","webkit","Infinity","Scale","forceBounds","range","domain","extent","scaleLinear","bisector","invert","Chart","Class","includes","Evented","prototype","Mixin","Events","initialize","opts","_data","_draggingEnabled","dragging","imperial","_xLabel","_yLabel","xLabel","yLabel","_xTicks","xTicks","_yTicks","yTicks","_updateScale","svg","_svg","_appendGrid","_appendAxis","_appendAreaPath","_appendFocusable","_appendLegend","_grid","_area","_path","_axis","_focus","_focusRect","_legend","_x","_y","update","_updateAxis","_updateAreaPath","render","container","_this","D3","_width","xAxisMin","xAxisMax","forceAxisBounds","_height","yAxisMin","yAxisMax","remove","_appendXGrid","_appendYGrid","_appendXaxis","_appendYaxis","_this2","_this3","_this4","_appendFocusRect","_appendMouseFocusG","focusRect","_this5","mobile","_dragStartHandler","bind","_dragHandler","_mousemoveHandler","_dragEndHandler","_mouseenterHandler","_mouseoutHandler","focusG","_this6","_focusG","_focusline","_focuslabel","event","preventDefault","stopPropagation","_gotDragged","_drawDragRectangle","_dragStartCoords","mouse","_dragRectangle","_dragCurrentCoords","_resetDrag","start","_findItemForX","end","dragstart","dragend","ctx","_this7","_hideDiagramIndicator","_showDiagramIndicator","xCoordinate","classed","hoverNumber","decimalsX","decimalsY","fx","fy","yCoordinate","addInitHook","Marker","_heightG","_mouseHeightFocus","_pointG","_mouseHeightFocusLabel","_marker","markerIcon","zIndexOffset","interactive","addTo","map","pane","renderer","_map","getPane","_pane","createPane","zIndex","_latlng","latLngToLayerPoint","normalizedAlt","maxElevation","z","normalizedY","getElement","setLatLng","getLatLng","Summary","_summary","summary","reset","innerHTML","Options","autohide","autohideMarker","collapsed","detached","distanceFactor","downloadLink","elevationDiv","followMarker","async","startIconUrl","endIconUrl","shadowUrl","divIcon","html","iconSize","iconAnchor","heightFactor","lazyLoadJS","legend","loadData","defer","placeholder","color","opacity","weight","lineCap","reverseCoords","skipNullZCoords","responsive","slope","sDeltaMax","sInterpolation","sRange","undefined","zFollow","__mileFactor","__footFactor","__D3","__LGPX","_addData","_addLayer","eleDiv","_initElevationDiv","isConnected","_container","onAdd","clear","_chart","_layers","eachLayer","_distance","disableDragging","enableDragging","fitBounds","bounds","getBounds","isValid","latLngBounds","getZFollow","_zFollow","hide","_distanceFactor","_heightFactor","_chartEnabled","_setMapView","throttle","load","loadChart","loadDefer","loadLazy","loadGPX","loadGeoJSON","_downloadURL","catch","_gpxLazyLoader","parentNode","alt","_initToggle","_initChart","_initMarker","_hideMarker","_resetView","_resizeChart","_updateChart","_updateSummary","onRemove","redraw","setZFollow","zoom","show","geom","feat","gpx","_latlngs","_addGeoJSONData","coordinates","coords","features","_addGPXData","_this8","_addPoint","_this9","lat","lng","meta","ele","eleMax","_maxElevation","eleMin","_minElevation","dist","curr","LatLng","prev","delta","distanceTo","round","prevZ","isNaN","lastZ","_lastValidZ","currZ","splice","push","distance","elevation_max","elevation_min","index","_mousemoveLayerHandler","layerGroup","addLayer","id","_collapse","_expand","_findItemForLatLng","result","propagate","offWi","offHe","_maxWidth","containerWidth","clientWidth","chart","summaryDiv","disableClickPropagation","_mousewheelHandler","link","_button","title","stop","_toggle","_updateMarker","gestureHandling","_enabled","ll","getCenter","getZoom","sign","deltaY","flyTo","_isFullscreen","newWidth","removeControl","setView","animate","duration","onclick","_this10","confirm","p","pop","_popup","_content","decodeURI","bindTooltip","direction","sticky","openTooltip","enabled","nodes","_this11","n","getAttribute","_this12","CustomEvent","dispatchEvent","detail","_altitudeLegend","toFixed","tAsc","_tAsc","tDes","_tDes","sMax","_sMax","sMin","_sMin","deltaZ","deltaS","maxDeltaS","abs","ascent","descent","slope_max","slope_min","_focuslabelSlope","property","_mouseSlopeFocusLabel","insertAdjacentHTML","Utils","Components","elevation"],"mappings":"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"}