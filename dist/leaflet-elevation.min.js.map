{"version":3,"file":"leaflet-elevation.min.js","sources":["../src/utils.js","../node_modules/leaflet-i18n/Leaflet.i18n.js","../src/components.js","../src/control.js","../src/slope.js","../src/index.js"],"sourcesContent":["/**\r\n * Recursive deep merge objects.\r\n * Alternative to L.Util.setOptions(this, options).\r\n */\r\nexport function deepMerge(target, ...sources) {\r\n\tif (!sources.length) return target;\r\n\tconst source = sources.shift();\r\n\tif (isObject(target) && isObject(source)) {\r\n\t\tfor (const key in source) {\r\n\t\t\tif (isObject(source[key])) {\r\n\t\t\t\tif (!target[key]) Object.assign(target, {\r\n\t\t\t\t\t[key]: {}\r\n\t\t\t\t});\r\n\t\t\t\tdeepMerge(target[key], source[key]);\r\n\t\t\t} else {\r\n\t\t\t\tObject.assign(target, {\r\n\t\t\t\t\t[key]: source[key]\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn deepMerge(target, ...sources);\r\n}\r\n\r\n/**\r\n * Wait for document load before execute function.\r\n */\r\nexport function deferFunc(f) {\r\n\tif (document.readyState !== 'complete') window.addEventListener(\"load\", f, { once: true });\r\n\telse f();\r\n}\r\n\r\n/*\r\n * Formatting funciton using the given decimals and seperator.\r\n */\r\nexport function formatter(num, dec, sep) {\r\n\tlet res = L.Util.formatNum(num, dec).toString();\r\n\tlet numbers = res.split(\".\");\r\n\tif (numbers[1]) {\r\n\t\tfor (let d = dec - numbers[1].length; d > 0; d--) {\r\n\t\t\tnumbers[1] += \"0\";\r\n\t\t}\r\n\t\tres = numbers.join(sep || \".\");\r\n\t}\r\n\treturn res;\r\n}\r\n\r\n/**\r\n * Simple GeoJSON data loader.\r\n */\r\nexport function GeoJSONLoader(data, control) {\r\n\tif (typeof data === \"string\") {\r\n\t\tdata = JSON.parse(data);\r\n\t}\r\n\tcontrol = control || this;\r\n\r\n\tlet layer = L.geoJson(data, {\r\n\t\tstyle: (feature) => {\r\n\t\t\tlet style = L.extend({}, control.options.polyline);\r\n\t\t\tif (control.options.theme) {\r\n\t\t\t\tstyle.className += ' ' + control.options.theme;\r\n\t\t\t}\r\n\t\t\treturn style;\r\n\t\t},\r\n\t\tpointToLayer: (feature, latlng) => {\r\n\t\t\tlet marker = L.marker(latlng, { icon: control.options.gpxOptions.marker_options.wptIcons[''] });\r\n\t\t\tlet desc = feature.properties.desc ? feature.properties.desc : '';\r\n\t\t\tlet name = feature.properties.name ? feature.properties.name : '';\r\n\t\t\tif (name || desc) {\r\n\t\t\t\tmarker.bindPopup(\"<b>\" + name + \"</b>\" + (desc.length > 0 ? '<br>' + desc : '')).openPopup();\r\n\t\t\t}\r\n\t\t\tcontrol.fire('waypoint_added', { point: marker, point_type: 'waypoint', element: latlng });\r\n\t\t\treturn marker;\r\n\t\t},\r\n\t\tonEachFeature: (feature, layer) => {\r\n\t\t\tif (feature.geometry.type == 'Point') return;\r\n\r\n\t\t\tcontrol.addData(feature, layer);\r\n\r\n\t\t\tcontrol.track_info = L.extend({}, control.track_info, { type: \"geojson\", name: data.name });\r\n\t\t},\r\n\t});\r\n\r\n\tcontrol._fireEvt(\"eledata_loaded\", { data: data, layer: layer, name: control.track_info.name, track_info: control.track_info }, true);\r\n\r\n\treturn layer;\r\n}\r\n\r\n/**\r\n * Simple GPX data loader.\r\n */\r\nexport function GPXLoader(data, control) {\r\n\tcontrol = control || this;\r\n\r\n\tcontrol.options.gpxOptions.polyline_options = L.extend({}, control.options.polyline, control.options.gpxOptions.polyline_options);\r\n\r\n\tif (control.options.theme) {\r\n\t\tcontrol.options.gpxOptions.polyline_options.className += ' ' + control.options.theme;\r\n\t}\r\n\r\n\tlet layer = new L.GPX(data, control.options.gpxOptions);\r\n\r\n\t// similar to L.GeoJSON.pointToLayer\r\n\tlayer.on('addpoint', (e) => {\r\n\t\tcontrol.fire(\"waypoint_added\", e, true);\r\n\t});\r\n\r\n\t// similar to L.GeoJSON.onEachFeature\r\n\tlayer.once(\"addline\", (e) => {\r\n\t\tcontrol.addData(e.line /*, layer*/ );\r\n\t\tcontrol.track_info = L.extend({}, control.track_info, { type: \"gpx\", name: layer.get_name() });\r\n\t});\r\n\r\n\t// unlike the L.GeoJSON, L.GPX parsing is async\r\n\tlayer.once('loaded', (e) => {\r\n\t\tcontrol._fireEvt(\"eledata_loaded\", { data: data, layer: layer, name: control.track_info.name, track_info: control.track_info }, true);\r\n\t});\r\n\r\n\treturn layer;\r\n}\r\n\r\n/**\r\n * Check DOM element visibility.\r\n */\r\nexport function isDomVisible(elem) {\r\n\treturn !!(elem.offsetWidth || elem.offsetHeight || elem.getClientRects().length);\r\n}\r\n\r\n/**\r\n * Check object type.\r\n */\r\nexport function isObject(item) {\r\n\treturn (item && typeof item === 'object' && !Array.isArray(item));\r\n}\r\n\r\n/**\r\n * Check DOM element viewport visibility.\r\n */\r\nexport function isVisible(elem) {\r\n\tif (!elem) return false;\r\n\r\n\tlet styles = window.getComputedStyle(elem);\r\n\r\n\tfunction isVisibleByStyles(elem, styles) {\r\n\t\treturn styles.visibility !== 'hidden' && styles.display !== 'none';\r\n\t}\r\n\r\n\tfunction isAboveOtherElements(elem, styles) {\r\n\t\tlet boundingRect = elem.getBoundingClientRect();\r\n\t\tlet left = boundingRect.left + 1;\r\n\t\tlet right = boundingRect.right - 1;\r\n\t\tlet top = boundingRect.top + 1;\r\n\t\tlet bottom = boundingRect.bottom - 1;\r\n\t\tlet above = true;\r\n\r\n\t\tlet pointerEvents = elem.style.pointerEvents;\r\n\r\n\t\tif (styles['pointer-events'] == 'none') elem.style.pointerEvents = 'auto';\r\n\r\n\t\tif (document.elementFromPoint(left, top) !== elem) above = false;\r\n\t\tif (document.elementFromPoint(right, top) !== elem) above = false;\r\n\r\n\t\t// Only for completely visible elements\r\n\t\t// if (document.elementFromPoint(left, bottom) !== elem) above = false;\r\n\t\t// if (document.elementFromPoint(right, bottom) !== elem) above = false;\r\n\r\n\t\telem.style.pointerEvents = pointerEvents;\r\n\r\n\t\treturn above;\r\n\t}\r\n\r\n\tif (!isVisibleByStyles(elem, styles)) return false;\r\n\tif (!isAboveOtherElements(elem, styles)) return false;\r\n\treturn true;\r\n}\r\n\r\n/**\r\n * Check JSON object type.\r\n */\r\nexport function isJSONDoc(doc, lazy) {\r\n\tlazy = typeof lazy === \"undefined\" ? true : lazy;\r\n\tif (typeof doc === \"string\" && lazy) {\r\n\t\tdoc = doc.trim();\r\n\t\treturn doc.indexOf(\"{\") == 0 || doc.indexOf(\"[\") == 0;\r\n\t} else {\r\n\t\ttry {\r\n\t\t\tJSON.parse(doc.toString());\r\n\t\t} catch (e) {\r\n\t\t\tif (typeof doc === \"object\" && lazy) return true;\r\n\t\t\tconsole.warn(e);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\n/**\r\n * Check XML object type.\r\n */\r\nexport function isXMLDoc(doc, lazy) {\r\n\tlazy = typeof lazy === \"undefined\" ? true : lazy;\r\n\tif (typeof doc === \"string\" && lazy) {\r\n\t\tdoc = doc.trim();\r\n\t\treturn doc.indexOf(\"<\") == 0;\r\n\t} else {\r\n\t\tlet documentElement = (doc ? doc.ownerDocument || doc : 0).documentElement;\r\n\t\treturn documentElement ? documentElement.nodeName !== \"HTML\" : false;\r\n\t}\r\n}\r\n\r\n/**\r\n * Async JS script download.\r\n */\r\nexport function lazyLoader(url, skip, loader) {\r\n\tif (skip === false) {\r\n\t\treturn Promise.resolve();\r\n\t}\r\n\tif (loader instanceof Promise) {\r\n\t\treturn loader;\r\n\t}\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tlet tag = document.createElement(\"script\");\r\n\t\ttag.addEventListener('load', resolve, { once: true });\r\n\t\ttag.src = url;\r\n\t\tdocument.head.appendChild(tag);\r\n\t});\r\n}\r\n\r\n/**\r\n * Download data from a remote url.\r\n */\r\nexport function loadFile(url, success) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tlet xhr = new XMLHttpRequest();\r\n\t\txhr.responseType = \"text\";\r\n\t\txhr.open('GET', url);\r\n\t\txhr.onload = () => resolve(xhr.response);\r\n\t\txhr.onerror = () => reject(\"Error \" + xhr.status + \" while fetching remote file: \" + url);\r\n\t\txhr.send();\r\n\t});\r\n}\r\n\r\n/**\r\n * Generate download data event.\r\n */\r\nexport function saveFile(dataURI, fileName) {\r\n\tlet d = document,\r\n\t\ta = d.createElement('a'),\r\n\t\tb = d.body;\r\n\ta.href = dataURI;\r\n\ta.target = '_new';\r\n\ta.download = fileName || \"\";\r\n\ta.style.display = 'none';\r\n\tb.appendChild(a);\r\n\ta.click();\r\n\tb.removeChild(a);\r\n}\r\n\r\n/**\r\n * Wait for element visible before execute function.\r\n */\r\nexport function waitHolder(elem) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tlet ticking = false;\r\n\t\tlet scrollFn = () => {\r\n\t\t\tif (!ticking) {\r\n\t\t\t\tL.Util.requestAnimFrame(() => {\r\n\t\t\t\t\tif (isVisible(elem)) {\r\n\t\t\t\t\t\twindow.removeEventListener('scroll', scrollFn);\r\n\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tticking = false;\r\n\t\t\t\t});\r\n\t\t\t\tticking = true;\r\n\t\t\t}\r\n\t\t};\r\n\t\twindow.addEventListener('scroll', scrollFn);\r\n\t\tif (elem) elem.addEventListener('mouseenter', scrollFn, { once: true });\r\n\t\tscrollFn();\r\n\t});\r\n}\r\n","// Following https://github.com/Leaflet/Leaflet/blob/master/PLUGIN-GUIDE.md\n(function (factory, window) {\n\n    // define an AMD module that relies on 'leaflet'\n    if (typeof define === 'function' && define.amd) {\n        define(['leaflet'], factory);\n\n        // define a Common JS module that relies on 'leaflet'\n    } else if (typeof exports === 'object') {\n        module.exports = factory(require('leaflet'));\n    }\n\n    // attach your plugin to the global 'L' variable\n    if (typeof window !== 'undefined' && window.L) {\n        factory(window.L);\n\n    }\n}(function (L) {\n    L.locales = {};\n    L.locale = null;\n    L.registerLocale = function registerLocale(code, locale) {\n        L.locales[code] = L.Util.extend({}, L.locales[code], locale);\n    };\n    L.setLocale = function setLocale(code) {\n        L.locale = code;\n    };\n    return L.i18n = L._ = function translate(string, data) {\n        if (L.locale && L.locales[L.locale] && L.locales[L.locale][string]) {\n            string = L.locales[L.locale][string];\n        }\n        try {\n            // Do not fail if some data is missing\n            // a bad translation should not break the app\n            string = L.Util.template(string, data);\n        }\n        catch (err) {/*pass*/\n        }\n\n        return string;\n    };\n}, window));\n","export const Area = (props) => {\r\n\treturn path => {\r\n\t\tlet interpolation = props.interpolation || \"curveLinear\";\r\n\r\n\t\tif (typeof props.interpolation !== 'function') {\r\n\t\t\tinterpolation = d3[props.interpolation];\r\n\t\t}\r\n\r\n\t\tlet area = d3.area().curve(interpolation)\r\n\t\t\t.x(d => (d.xDiagCoord = props.scaleX(d[props.xAttr])))\r\n\t\t\t.y0(props.height)\r\n\t\t\t.y1(d => props.scaleY(d[props.yAttr]));\r\n\r\n\t\tif (props.data) path.datum(props.data).attr(\"d\", area);\r\n\t\tif (props.name) path.attr('data-name', props.name);\r\n\r\n\t\treturn area;\r\n\t};\r\n};\r\n\r\nexport const AreaPath = (props) => {\r\n\treturn d3.create('svg:path')\r\n\t\t.attr(\"class\", \"area\")\r\n\t\t.call(Area(props));\r\n};\r\n\r\nexport const Axis = (props) => {\r\n\treturn g => {\r\n\t\tprops = L.extend({ type: \"axis\", tickSize: 6, tickPadding: 3 }, props);\r\n\r\n\t\tlet [w, h] = [0, 0];\r\n\t\tif (props.axis == \"x\" && props.position == \"top\") {\r\n\t\t\t[w, h] = [0, 0];\r\n\t\t} else if (props.axis == \"x\" && props.position == \"bottom\") {\r\n\t\t\t[w, h] = [0, props.height];\r\n\t\t} else if (props.axis == \"y\" && props.position == \"left\") {\r\n\t\t\t[w, h] = [0, 0];\r\n\t\t} else if (props.axis == \"y\" && props.position == \"right\") {\r\n\t\t\t[w, h] = [props.width, 0];\r\n\t\t}\r\n\r\n\t\tif (props.axis == \"x\" && props.type == \"grid\") {\r\n\t\t\tprops.tickSize = -props.height;\r\n\t\t} else if (props.axis == \"y\" && props.type == \"grid\") {\r\n\t\t\tprops.tickSize = -props.width;\r\n\t\t}\r\n\r\n\t\tlet scale = d3[\"axis\" + props.position.replace(/\\b\\w/g, l => l.toUpperCase())]()\r\n\t\t\t.scale(props.scale)\r\n\t\t\t.ticks(props.ticks)\r\n\t\t\t.tickPadding(props.tickPadding)\r\n\t\t\t.tickSize(props.tickSize)\r\n\t\t\t.tickFormat(props.tickFormat);\r\n\r\n\t\tlet axis = g.append(\"g\")\r\n\t\t\t.attr(\"class\", [props.axis, props.type, props.position].join(\" \"))\r\n\t\t\t.attr(\"transform\", \"translate(\" + w + \",\" + h + \")\")\r\n\t\t\t.call(scale);\r\n\r\n\t\tif (props.label) {\r\n\t\t\taxis.append(\"text\")\r\n\t\t\t\t.attr(\"x\", props.labelX)\r\n\t\t\t\t.attr(\"y\", props.labelY)\r\n\t\t\t\t.text(props.label);\r\n\t\t}\r\n\r\n\t\treturn axis;\r\n\t};\r\n};\r\n\r\nexport const DragRectangle = (props) => {\r\n\treturn rect => {\r\n\t\tlet x1 = Math.min(props.dragStartCoords[0], props.dragEndCoords[0]);\r\n\t\tlet x2 = Math.max(props.dragStartCoords[0], props.dragEndCoords[0]);\r\n\r\n\t\treturn rect\r\n\t\t\t.attr(\"width\", x2 - x1)\r\n\t\t\t.attr(\"height\", props.height)\r\n\t\t\t.attr(\"x\", x1);\r\n\t};\r\n};\r\n\r\nexport const FocusRect = (props) => {\r\n\treturn rect => rect\r\n\t\t.attr(\"width\", props.width)\r\n\t\t.attr(\"height\", props.height)\r\n\t\t.style(\"fill\", \"none\")\r\n\t\t.style(\"stroke\", \"none\")\r\n\t\t.style(\"pointer-events\", \"all\");\r\n};\r\n\r\nexport const Grid = (props) => {\r\n\tprops.type = \"grid\";\r\n\treturn Axis(props);\r\n};\r\n\r\nexport const HeightFocusLine = (props) => {\r\n\treturn line => line\r\n\t\t.attr(\"class\", props.theme + \" height-focus line\")\r\n\t\t.attr(\"x1\", props.xCoord || 0)\r\n\t\t.attr(\"x2\", props.xCoord || 0)\r\n\t\t.attr(\"y1\", props.yCoord || 0)\r\n\t\t.attr(\"y2\", props.length || 0);\r\n};\r\n\r\nexport const HeightFocusLabel = (props) => {\r\n\treturn text => {\r\n\t\ttext\r\n\t\t\t.attr(\"class\", props.theme + \" height-focus-label\")\r\n\t\t\t.style(\"pointer-events\", \"none\")\r\n\t\t\t.attr(\"x\", props.xCoord + 5 || 0)\r\n\t\t\t.attr(\"y\", props.yCoord || 0);\r\n\r\n\t\tlet y = text.select(\".height-focus-y\");\r\n\t\tif (!y.node()) y = text.append(\"svg:tspan\");\r\n\r\n\t\ty\r\n\t\t\t.attr(\"class\", \"height-focus-y\")\r\n\t\t\t.text(props.label);\r\n\r\n\t\ttext.selectAll('tspan').attr(\"x\", props.xCoord + 5 || 0);\r\n\r\n\t\treturn text;\r\n\t};\r\n};\r\n\r\nexport const HeightFocusPoint = (props) => {\r\n\treturn circle => circle\r\n\t\t.attr(\"class\", props.theme + \" height-focus circle-lower\")\r\n\t\t.attr(\"transform\", \"translate(\" + (props.xCoord || 0) + \",\" + (props.yCoord || 0) + \")\")\r\n\t\t.attr(\"r\", 6)\r\n\t\t.attr(\"cx\", 0)\r\n\t\t.attr(\"cy\", 0);\r\n};\r\n\r\n\r\nexport const LegendItem = (props) => {\r\n\treturn g => {\r\n\t\tg\r\n\t\t\t.attr(\"class\", \"legend-item legend-\" + props.name.toLowerCase())\r\n\t\t\t.attr(\"data-name\", props.name);\r\n\r\n\t\tg.append(\"rect\")\r\n\t\t\t.attr(\"class\", \"area\")\r\n\t\t\t.attr(\"x\", (props.width / 2) - 50)\r\n\t\t\t.attr(\"y\", props.height + props.margins.bottom / 2)\r\n\t\t\t.attr(\"width\", 50)\r\n\t\t\t.attr(\"height\", 10)\r\n\t\t\t.attr(\"opacity\", 0.75);\r\n\r\n\t\tg.append('text')\r\n\t\t\t.text(L._(props.name))\r\n\t\t\t.attr(\"x\", (props.width / 2) + 5)\r\n\t\t\t.attr(\"font-size\", 10)\r\n\t\t\t.style(\"text-decoration-thickness\", \"2px\")\r\n\t\t\t.style(\"font-weight\", \"700\")\r\n\t\t\t.attr('y', props.height + props.margins.bottom / 2)\r\n\t\t\t.attr('dy', \"0.75em\");\r\n\r\n\t\treturn g;\r\n\t}\r\n};\r\n\r\nexport const MouseFocusLine = (props) => {\r\n\treturn line => line\r\n\t\t.attr('class', 'mouse-focus-line')\r\n\t\t.attr('x2', props.xCoord)\r\n\t\t.attr('y2', 0)\r\n\t\t.attr('x1', props.xCoord)\r\n\t\t.attr('y1', props.height);\r\n};\r\n\r\nexport const MouseFocusLabel = (props) => {\r\n\treturn g => {\r\n\r\n\t\tg.attr('class', 'mouse-focus-label');\r\n\r\n\t\tlet rect = g.select(\".mouse-focus-label-rect\");\r\n\t\tlet text = g.select(\".mouse-focus-label-text\");\r\n\t\tlet y = text.select(\".mouse-focus-label-y\");\r\n\t\tlet x = text.select(\".mouse-focus-label-x\");\r\n\r\n\t\tif (!rect.node()) rect = g.append(\"rect\");\r\n\t\tif (!text.node()) text = g.append(\"svg:text\");\r\n\t\tif (!y.node()) y = text.append(\"svg:tspan\");\r\n\t\tif (!x.node()) x = text.append(\"svg:tspan\");\r\n\r\n\t\tif (props.labelY) y.text(props.labelY);\r\n\t\tif (props.labelX) x.text(props.labelX);\r\n\r\n\t\t// Sets focus-label-text position to the left / right of the mouse-focus-line\r\n\t\tlet bbox = text.node().getBBox();\r\n\t\tlet xAlign = 0;\r\n\t\tlet yAlign = 0;\r\n\r\n\t\tif (props.xCoord) xAlign = props.xCoord + (props.xCoord < props.width / 2 ? 10 : -bbox.width - 10);\r\n\t\tif (props.yCoord) yAlign = Math.max(props.yCoord - bbox.height, L.Browser.webkit ? 0 : -Infinity);\r\n\r\n\t\trect\r\n\t\t\t.attr(\"class\", \"mouse-focus-label-rect\")\r\n\t\t\t.attr(\"x\", xAlign - 5)\r\n\t\t\t.attr(\"y\", yAlign - 5)\r\n\t\t\t.attr(\"width\", bbox.width + 10)\r\n\t\t\t.attr(\"height\", bbox.height + 10)\r\n\t\t\t.attr(\"rx\", 3)\r\n\t\t\t.attr(\"ry\", 3);\r\n\t\ttext\r\n\t\t\t.attr(\"class\", \"mouse-focus-label-text\")\r\n\t\t\t.style(\"font-weight\", \"700\")\r\n\t\t\t.attr(\"y\", yAlign);\r\n\t\ty\r\n\t\t\t.attr(\"class\", \"mouse-focus-label-y\")\r\n\t\t\t.attr(\"dy\", \"1em\");\r\n\t\tx\r\n\t\t\t.attr(\"class\", \"mouse-focus-label-x\")\r\n\t\t\t.attr(\"dy\", \"2em\");\r\n\r\n\t\ttext.selectAll('tspan').attr(\"x\", xAlign);\r\n\r\n\t\treturn g;\r\n\t};\r\n};\r\n\r\nexport const Scale = (props) => {\r\n\tlet domain = props.data ? d3.extent(props.data, d => d[props.attr]) : [0, 1];\r\n\tif (props.hasOwnProperty('min') && (props.min < domain[0] || props.forceBounds)) {\r\n\t\tdomain[0] = props.min;\r\n\t}\r\n\tif (props.hasOwnProperty('max') && (props.max > domain[1] || props.forceBounds)) {\r\n\t\tdomain[1] = props.max;\r\n\t}\r\n\treturn d3.scaleLinear()\r\n\t\t.range(props.range)\r\n\t\t.domain(domain);\r\n};\r\n","import 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\n\r\nexport const Elevation = L.Control.Elevation = L.Control.extend({\r\n\r\n\tincludes: L.Evented ? L.Evented.prototype : L.Mixin.Events,\r\n\r\n\toptions: {\r\n\t\tautohide: !L.Browser.mobile,\r\n\t\tautohideMarker: true,\r\n\t\tcollapsed: false,\r\n\t\tcontrolButton: {\r\n\t\t\ticonCssClass: \"elevation-toggle-icon\",\r\n\t\t\ttitle: \"Elevation\"\r\n\t\t},\r\n\t\tdetached: true,\r\n\t\tdistanceFactor: 1,\r\n\t\tdragging: !L.Browser.mobile,\r\n\t\tdownloadLink: 'link',\r\n\t\televationDiv: \"#elevation-div\",\r\n\t\tfollowMarker: true,\r\n\t\tforceAxisBounds: false,\r\n\t\tgpxOptions: {\r\n\t\t\tasync: true,\r\n\t\t\tmarker_options: {\r\n\t\t\t\tstartIconUrl: null,\r\n\t\t\t\tendIconUrl: null,\r\n\t\t\t\tshadowUrl: null,\r\n\t\t\t\twptIcons: {\r\n\t\t\t\t\t'': L.divIcon({\r\n\t\t\t\t\t\tclassName: 'elevation-waypoint-marker',\r\n\t\t\t\t\t\thtml: '<i class=\"elevation-waypoint-icon\"></i>',\r\n\t\t\t\t\t\ticonSize: [30, 30],\r\n\t\t\t\t\t\ticonAnchor: [8, 30],\r\n\t\t\t\t\t})\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t},\r\n\t\theight: 200,\r\n\t\theightFactor: 1,\r\n\t\thoverNumber: {\r\n\t\t\tdecimalsX: 2,\r\n\t\t\tdecimalsY: 0,\r\n\t\t\tformatter: _.formatter,\r\n\t\t},\r\n\t\timperial: false,\r\n\t\tinterpolation: \"curveLinear\",\r\n\t\tlazyLoadJS: true,\r\n\t\tlegend: true,\r\n\t\tloadData: {\r\n\t\t\tdefer: false,\r\n\t\t\tlazy: false,\r\n\t\t},\r\n\t\tmarker: 'elevation-line',\r\n\t\tmarkerIcon: L.divIcon({\r\n\t\t\tclassName: 'elevation-position-marker',\r\n\t\t\thtml: '<i class=\"elevation-position-icon\"></i>',\r\n\t\t\ticonSize: [32, 32],\r\n\t\t\ticonAnchor: [16, 16],\r\n\t\t}),\r\n\t\tplaceholder: false,\r\n\t\tposition: \"topright\",\r\n\t\tpolyline: {\r\n\t\t\tclassName: 'elevation-polyline',\r\n\t\t\tcolor: '#000',\r\n\t\t\topacity: 0.75,\r\n\t\t\tweight: 5,\r\n\t\t\tlineCap: 'round'\r\n\t\t},\r\n\t\treverseCoords: false,\r\n\t\tskipNullZCoords: false,\r\n\t\ttheme: \"lightblue-theme\",\r\n\t\tmargins: {\r\n\t\t\ttop: 10,\r\n\t\t\tright: 20,\r\n\t\t\tbottom: 30,\r\n\t\t\tleft: 50\r\n\t\t},\r\n\t\tresponsive: true,\r\n\t\tsummary: 'inline',\r\n\t\twidth: 600,\r\n\t\txAttr: \"dist\",\r\n\t\txLabel: \"km\",\r\n\t\txTicks: undefined,\r\n\t\tyAttr: \"z\",\r\n\t\tyAxisMax: undefined,\r\n\t\tyAxisMin: undefined,\r\n\t\tyLabel: \"m\",\r\n\t\tyTicks: undefined,\r\n\t\tzFollow: 13,\r\n\t},\r\n\t__mileFactor: 0.621371,\r\n\t__footFactor: 3.28084,\r\n\r\n\t/*\r\n\t * Add data to the diagram either from GPX or GeoJSON and update the axis domain and data\r\n\t */\r\n\taddData: function(d, layer) {\r\n\t\tif ((typeof layer === \"undefined\" || layer === null) && d.on) {\r\n\t\t\tlayer = d;\r\n\t\t}\r\n\t\tElevation._d3LazyLoader = _.lazyLoader(\r\n\t\t\t'https://unpkg.com/d3@5.15.0/dist/d3.min.js',\r\n\t\t\ttypeof d3 !== 'object' || !this.options.lazyLoadJS,\r\n\t\t\tElevation._d3LazyLoader\r\n\t\t).then(() => {\r\n\t\t\tthis._addData(d);\r\n\t\t\tthis._addLayer(layer);\r\n\t\t\tthis._fireEvt(\"eledata_added\", { data: d, layer: layer, track_info: this.track_info }, true);\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Adds the control to the given map.\r\n\t */\r\n\taddTo: function(map) {\r\n\t\tif (this.options.detached) {\r\n\t\t\tthis._appendElevationDiv(map._container).appendChild(this.onAdd(map));\r\n\t\t} else {\r\n\t\t\tL.Control.prototype.addTo.call(this, map);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t * Reset data and display\r\n\t */\r\n\tclear: function() {\r\n\t\tthis._clearPath();\r\n\t\tthis._clearChart();\r\n\t\tthis._clearData();\r\n\r\n\t\tthis._fireEvt(\"eledata_clear\");\r\n\t},\r\n\r\n\t/**\r\n\t * Disable dragging chart on touch events.\r\n\t */\r\n\tdisableDragging: function() {\r\n\t\tthis._draggingEnabled = false;\r\n\t\tthis._resetDrag();\r\n\t},\r\n\r\n\t/**\r\n\t * Enable dragging chart on touch events.\r\n\t */\r\n\tenableDragging: function() {\r\n\t\tthis._draggingEnabled = true;\r\n\t},\r\n\r\n\t/**\r\n\t * Sets a map view that contains the given geographical bounds.\r\n\t */\r\n\tfitBounds: function(bounds) {\r\n\t\tbounds = bounds || this._fullExtent;\r\n\t\tif (this._map && bounds) this._map.fitBounds(bounds);\r\n\t},\r\n\r\n\t/**\r\n\t * Get default zoom level when \"followMarker\" is true.\r\n\t */\r\n\tgetZFollow: function() {\r\n\t\treturn this._zFollow;\r\n\t},\r\n\r\n\t/**\r\n\t * Hide current elevation chart profile.\r\n\t */\r\n\thide: function() {\r\n\t\tthis._container.style.display = \"none\";\r\n\t},\r\n\r\n\t/**\r\n\t * Initialize chart control \"options\" and \"container\".\r\n\t */\r\n\tinitialize: function(options) {\r\n\t\tthis.options = _.deepMerge({}, this.options, options);\r\n\r\n\t\tif (this.options.imperial) {\r\n\t\t\tthis._distanceFactor = this.__mileFactor;\r\n\t\t\tthis._heightFactor = this.__footFactor;\r\n\t\t\tthis._xLabel = \"mi\";\r\n\t\t\tthis._yLabel = \"ft\";\r\n\t\t} else {\r\n\t\t\tthis._distanceFactor = this.options.distanceFactor;\r\n\t\t\tthis._heightFactor = this.options.heightFactor;\r\n\t\t\tthis._xLabel = this.options.xLabel;\r\n\t\t\tthis._yLabel = this.options.yLabel;\r\n\t\t}\r\n\r\n\t\tthis._chartEnabled = true;\r\n\t\tthis._draggingEnabled = this.options.dragging;\r\n\t\tthis._zFollow = this.options.zFollow;\r\n\r\n\t\tif (this.options.followMarker) this._setMapView = L.Util.throttle(this._setMapView, 300, this);\r\n\t\tif (this.options.placeholder) this.options.loadData.lazy = this.options.loadData.defer = true;\r\n\r\n\t\tif (this.options.legend) this.options.margins.bottom += 30;\r\n\t},\r\n\r\n\t/**\r\n\t * Alias for loadData\r\n\t */\r\n\tload: function(data, opts) {\r\n\t\tthis.loadData(data, opts);\r\n\t},\r\n\r\n\t/**\r\n\t * Alias for addTo\r\n\t */\r\n\tloadChart: function(map) {\r\n\t\tthis.addTo(map);\r\n\t},\r\n\r\n\t/**\r\n\t * Load elevation data (GPX or GeoJSON).\r\n\t */\r\n\tloadData: function(data, opts) {\r\n\t\topts = L.extend({}, this.options.loadData, opts);\r\n\t\tif (opts.defer) {\r\n\t\t\tthis.loadDefer(data, opts);\r\n\t\t} else if (opts.lazy) {\r\n\t\t\tthis.loadLazy(data, opts);\r\n\t\t} else if (_.isXMLDoc(data)) {\r\n\t\t\tthis.loadGPX(data);\r\n\t\t} else if (_.isJSONDoc(data)) {\r\n\t\t\tthis.loadGeoJSON(data);\r\n\t\t} else {\r\n\t\t\tthis.loadFile(data);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Wait for document load before download data.\r\n\t */\r\n\tloadDefer: function(data, opts) {\r\n\t\topts = L.extend({}, this.options.loadData, opts);\r\n\t\topts.defer = false;\r\n\t\t_.deferFunc(L.bind(this.loadData, this, data, opts));\r\n\t},\r\n\r\n\t/**\r\n\t * Load data from a remote url.\r\n\t */\r\n\tloadFile: function(url) {\r\n\t\t_.loadFile(url)\r\n\t\t\t.then((data) => {\r\n\t\t\t\tthis._downloadURL = url; // TODO: handle multiple urls?\r\n\t\t\t\tthis.loadData(data, { lazy: false, defer: false });\r\n\t\t\t})\r\n\t\t\t.catch((err) => console.warn(err));\r\n\t},\r\n\r\n\t/**\r\n\t * Load raw GeoJSON data.\r\n\t */\r\n\tloadGeoJSON: function(data) {\r\n\t\t_.GeoJSONLoader(data, this);\r\n\t},\r\n\r\n\t/**\r\n\t * Load raw GPX data.\r\n\t */\r\n\tloadGPX: function(data) {\r\n\t\tElevation._gpxLazyLoader = _.lazyLoader(\r\n\t\t\t'https://unpkg.com/leaflet-gpx@1.5.0/gpx.js',\r\n\t\t\ttypeof L.GPX !== 'function' || !this.options.lazyLoadJS,\r\n\t\t\tElevation._gpxLazyLoader\r\n\t\t).then(() => {\r\n\t\t\t_.GPXLoader(data, this);\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Wait for chart container visible before download data.\r\n\t */\r\n\tloadLazy: function(data, opts) {\r\n\t\topts = L.extend({}, this.options.loadData, opts);\r\n\t\tlet elem = opts.lazy.parentNode ? opts.lazy : this.placeholder;\r\n\t\t_.waitHolder(opts.lazy)\r\n\t\t\t.then(() => {\r\n\t\t\t\topts.lazy = false;\r\n\t\t\t\tthis.loadData(data, opts)\r\n\t\t\t\tthis.once('eledata_loaded', () => opts.lazy.parentNode.removeChild(elem));\r\n\t\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Create container DOM element and related event listeners.\r\n\t * Called on control.addTo(map).\r\n\t */\r\n\tonAdd: function(map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tlet container = this._container = L.DomUtil.create(\"div\", \"elevation-control elevation\");\r\n\r\n\t\tif (!this.options.detached) {\r\n\t\t\tL.DomUtil.addClass(container, 'leaflet-control');\r\n\t\t}\r\n\r\n\t\tif (this.options.theme) {\r\n\t\t\tL.DomUtil.addClass(container, this.options.theme); // append theme to control\r\n\t\t}\r\n\r\n\t\tif (this.options.placeholder && !this._data) {\r\n\t\t\tthis.placeholder = L.DomUtil.create('img', 'elevation-placeholder');\r\n\t\t\tif (typeof this.options.placeholder === 'string') {\r\n\t\t\t\tthis.placeholder.src = this.options.placeholder;\r\n\t\t\t\tthis.placeholder.alt = '';\r\n\t\t\t} else {\r\n\t\t\t\tfor (let i in this.options.placeholder) { this.placeholder.setAttribute(i, this.options.placeholder[i]); }\r\n\t\t\t}\r\n\t\t\tcontainer.insertBefore(this.placeholder, container.firstChild);\r\n\t\t}\r\n\r\n\t\tif (!map.getPane('elevationPane')) {\r\n\t\t\tlet pane = map.createPane('elevationPane');\r\n\t\t\tpane.style.zIndex = 625; // This pane is above markers but below popups.\r\n\t\t\tpane.style.pointerEvents = 'none';\r\n\t\t}\r\n\r\n\t\tElevation._d3LazyLoader = _.lazyLoader(\r\n\t\t\t'https://unpkg.com/d3@5.15.0/dist/d3.min.js',\r\n\t\t\ttypeof d3 !== 'object' || !this.options.lazyLoadJS,\r\n\t\t\tElevation._d3LazyLoader\r\n\t\t).then(() => {\r\n\t\t\tthis._initToggle(container);\r\n\t\t\tthis._initChart(container);\r\n\r\n\t\t\tthis._map.on('zoom viewreset zoomanim', this._hidePositionMarker, this);\r\n\t\t\tthis._map.on('resize', this._resetView, this);\r\n\t\t\tthis._map.on('resize', this._resizeChart, this);\r\n\t\t\tthis._map.on('mousedown', this._resetDrag, this);\r\n\r\n\t\t\tL.DomEvent.on(this._map._container, 'mousewheel', this._resetDrag, this);\r\n\t\t\tL.DomEvent.on(this._map._container, 'touchstart', this._resetDrag, this);\r\n\r\n\t\t\tthis.on('eledata_added', this._updateChart, this);\r\n\t\t\tthis.on('eledata_added', this._updateSummary, this);\r\n\r\n\t\t\tthis._updateChart();\r\n\t\t\tthis._updateSummary();\r\n\t\t});\r\n\r\n\t\treturn container;\r\n\t},\r\n\r\n\t/**\r\n\t * Clean up control code and related event listeners.\r\n\t * Called on control.remove().\r\n\t */\r\n\tonRemove: function(map) {\r\n\t\tthis._container = null;\r\n\r\n\t\tthis._map.off('zoom viewreset zoomanim', this._hidePositionMarker, this);\r\n\t\tthis._map.off('resize', this._resetView, this);\r\n\t\tthis._map.off('resize', this._resizeChart, this);\r\n\t\tthis._map.off('mousedown', this._resetDrag, this);\r\n\r\n\t\tL.DomEvent.off(this._map._container, 'mousewheel', this._resetDrag, this);\r\n\t\tL.DomEvent.off(this._map._container, 'touchstart', this._resetDrag, this);\r\n\r\n\t\tthis.off('eledata_added', this._updateChart, this);\r\n\t\tthis.off('eledata_added', this._updateSummary, this);\r\n\t},\r\n\r\n\t/**\r\n\t * Redraws the chart control. Sometimes useful after screen resize.\r\n\t */\r\n\tredraw: function() {\r\n\t\tthis._resizeChart();\r\n\t},\r\n\r\n\t/**\r\n\t * Set default zoom level when \"followMarker\" is true.\r\n\t */\r\n\tsetZFollow: function(zoom) {\r\n\t\tthis._zFollow = zoom;\r\n\t},\r\n\r\n\t/**\r\n\t * Hide current elevation chart profile.\r\n\t */\r\n\tshow: function() {\r\n\t\tthis._container.style.display = \"block\";\r\n\t},\r\n\r\n\t/*\r\n\t * Parsing data either from GPX or GeoJSON and update the diagram data\r\n\t */\r\n\t_addData: function(d) {\r\n\t\tlet geom = d && d.geometry;\r\n\t\tlet feat = d && d.type === \"FeatureCollection\";\r\n\t\tlet gpx = d && d._latlngs;\r\n\r\n\t\tif (geom) {\r\n\t\t\tswitch (geom.type) {\r\n\t\t\t\tcase 'LineString':\r\n\t\t\t\t\tthis._addGeoJSONData(geom.coordinates);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'MultiLineString':\r\n\t\t\t\t\tgeom.coordinates.forEach(coords => this._addGeoJSONData(coords));\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconsole.warn('Unsopperted GeoJSON feature geometry type:' + geom.type);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (feat) {\r\n\t\t\td.features.forEach(feature => this._addData(feature));\r\n\t\t}\r\n\r\n\t\tif (gpx) {\r\n\t\t\tthis._addGPXdata(d._latlngs);\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Parsing of GeoJSON data lines and their elevation in z-coordinate\r\n\t */\r\n\t_addGeoJSONData: function(coords) {\r\n\t\tif (coords) {\r\n\t\t\tcoords.forEach(point => this._addPoint(point[1], point[0], point[2]));\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Parsing function for GPX data and their elevation in z-coordinate\r\n\t */\r\n\t_addGPXdata: function(coords) {\r\n\t\tif (coords) {\r\n\t\t\tcoords.forEach(point => this._addPoint(point.lat, point.lng, point.meta.ele));\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Parse and push a single (x, y, z) point to current elevation profile.\r\n\t */\r\n\t_addPoint: function(x, y, z) {\r\n\t\tif (this.options.reverseCoords) {\r\n\t\t\t[x, y] = [y, x];\r\n\t\t}\r\n\r\n\t\tlet data = this._data || [];\r\n\t\tlet eleMax = this._maxElevation || -Infinity;\r\n\t\tlet eleMin = this._minElevation || +Infinity;\r\n\t\tlet dist = this._distance || 0;\r\n\r\n\t\tlet curr = new L.LatLng(x, y);\r\n\t\tlet prev = data.length ? data[data.length - 1].latlng : curr;\r\n\r\n\t\tlet delta = curr.distanceTo(prev) * this._distanceFactor;\r\n\r\n\t\tdist = dist + Math.round(delta / 1000 * 100000) / 100000;\r\n\r\n\t\t// check and fix missing elevation data on last added point\r\n\t\tif (!this.options.skipNullZCoords && data.length > 0) {\r\n\t\t\tlet prevZ = data[data.length - 1].z;\r\n\t\t\tif (isNaN(prevZ)) {\r\n\t\t\t\tlet lastZ = this._lastValidZ;\r\n\t\t\t\tlet currZ = z * this._heightFactor;\r\n\t\t\t\tif (!isNaN(lastZ) && !isNaN(currZ)) {\r\n\t\t\t\t\tprevZ = (lastZ + currZ) / 2;\r\n\t\t\t\t} else if (!isNaN(lastZ)) {\r\n\t\t\t\t\tprevZ = lastZ;\r\n\t\t\t\t} else if (!isNaN(currZ)) {\r\n\t\t\t\t\tprevZ = currZ;\r\n\t\t\t\t}\r\n\t\t\t\tif (!isNaN(prevZ)) data[data.length - 1].z = prevZ;\r\n\t\t\t\telse data.splice(data.length - 1, 1);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tz = z * this._heightFactor;\r\n\r\n\t\t// skip point if it has not elevation\r\n\t\tif (!isNaN(z)) {\r\n\t\t\teleMax = eleMax < z ? z : eleMax;\r\n\t\t\teleMin = eleMin > z ? z : eleMin;\r\n\t\t\tthis._lastValidZ = z;\r\n\t\t}\r\n\r\n\t\tdata.push({\r\n\t\t\tdist: dist,\r\n\t\t\tx: x,\r\n\t\t\ty: y,\r\n\t\t\tz: z,\r\n\t\t\tlatlng: curr\r\n\t\t});\r\n\r\n\t\tthis._data = data;\r\n\t\tthis.track_info = this.track_info || {};\r\n\t\tthis.track_info.distance = this._distance = dist;\r\n\t\tthis.track_info.elevation_max = this._maxElevation = eleMax;\r\n\t\tthis.track_info.elevation_min = this._minElevation = eleMin;\r\n\r\n\t\tthis._fireEvt(\"eledata_updated\", { index: data.length - 1 }, true);\r\n\t},\r\n\r\n\t_addLayer: function(layer) {\r\n\t\tif (layer) {\r\n\t\t\tif (layer._path) {\r\n\t\t\t\tL.DomUtil.addClass(layer._path, this.options.polyline.className + ' ' + this.options.theme);\r\n\t\t\t}\r\n\t\t\tlayer\r\n\t\t\t\t.on(\"mousemove\", this._mousemoveLayerHandler, this)\r\n\t\t\t\t.on(\"mouseout\", this._mouseoutHandler, this);\r\n\r\n\t\t\tthis._layers = this._layers || {};\r\n\t\t\tthis._layers[L.Util.stamp(layer)] = layer;\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"svg\" chart container.\r\n\t */\r\n\t_appendChart: function() {\r\n\t\tlet opts = this.options;\r\n\t\treturn container => {\r\n\t\t\tlet svg = container.append(\"svg\")\r\n\t\t\t\t.attr(\"class\", \"background\")\r\n\t\t\t\t.attr(\"width\", opts.width)\r\n\t\t\t\t.attr(\"height\", opts.height);\r\n\r\n\t\t\tlet g = svg\r\n\t\t\t\t.append(\"g\")\r\n\t\t\t\t.attr(\"transform\", \"translate(\" + opts.margins.left + \",\" + opts.margins.top + \")\")\r\n\t\t\t\t.call(this._appendGrid())\r\n\t\t\t\t.call(this._appendAxis())\r\n\t\t\t\t.call(this._appendAreaPath())\r\n\t\t\t\t.call(this._appendFocusable())\r\n\t\t\t\t.call(this._appendLegend());\r\n\r\n\t\t\treturn svg;\r\n\t\t};\r\n\t},\r\n\r\n\t/**\r\n\t * Adds the control to the given \"detached\" div.\r\n\t */\r\n\t_appendElevationDiv: function(container) {\r\n\t\tlet eleDiv = document.querySelector(this.options.elevationDiv);\r\n\t\tif (!eleDiv) {\r\n\t\t\teleDiv = L.DomUtil.create('div', 'leaflet-control elevation elevation-div');\r\n\t\t\tthis.options.elevationDiv = '#elevation-div_' + Math.random().toString(36).substr(2, 9);\r\n\t\t\teleDiv.id = this.options.elevationDiv.substr(1);\r\n\t\t\tcontainer.parentNode.insertBefore(eleDiv, container.nextSibling); // insert after end of container.\r\n\t\t}\r\n\t\tif (this.options.detached) {\r\n\t\t\tL.DomUtil.addClass(eleDiv, 'elevation-detached');\r\n\t\t\tL.DomUtil.removeClass(eleDiv, 'leaflet-control');\r\n\t\t}\r\n\t\tthis.eleDiv = eleDiv;\r\n\t\treturn this.eleDiv;\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"div\" summary container.\r\n\t */\r\n\t_appendSummary: function() {\r\n\t\treturn container => {\r\n\t\t\tlet summary = this.summaryDiv = container.append(\"div\")\r\n\t\t\t\t.attr(\"class\", \"elevation-summary \" + (this.options.summary ? this.options.summary + \"-summary\" : '')).node();\r\n\r\n\t\t\tthis._updateSummary();\r\n\t\t\treturn summary;\r\n\t\t};\r\n\t},\r\n\r\n\t_appendXaxis: function() {\r\n\t\treturn D3.Axis({\r\n\t\t\taxis: \"x\",\r\n\t\t\tposition: \"bottom\",\r\n\t\t\twidth: this._width(),\r\n\t\t\theight: this._height(),\r\n\t\t\tscale: this._x,\r\n\t\t\tticks: this._xTicks,\r\n\t\t\tlabel: this._xLabel,\r\n\t\t\tlabelY: 25,\r\n\t\t\tlabelX: this._width() + 6,\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"x-grid\".\r\n\t */\r\n\t_appendXGrid: function() {\r\n\t\treturn D3.Grid({\r\n\t\t\taxis: \"x\",\r\n\t\t\tposition: \"bottom\",\r\n\t\t\twidth: this._width(),\r\n\t\t\theight: this._height(),\r\n\t\t\tscale: this._x,\r\n\t\t\tticks: this._xTicks,\r\n\t\t\ttickFormat: \"\",\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"y-axis\".\r\n\t */\r\n\t_appendYaxis: function() {\r\n\t\treturn D3.Axis({\r\n\t\t\taxis: \"y\",\r\n\t\t\tposition: \"left\",\r\n\t\t\twidth: this._width(),\r\n\t\t\theight: this._height(),\r\n\t\t\tscale: this._y,\r\n\t\t\tticks: this.options.yTicks,\r\n\t\t\tlabel: this._yLabel,\r\n\t\t\tlabelX: -25,\r\n\t\t\tlabelY: 3,\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"y-grid\".\r\n\t */\r\n\t_appendYGrid: function() {\r\n\t\treturn D3.Grid({\r\n\t\t\taxis: \"y\",\r\n\t\t\tposition: \"left\",\r\n\t\t\twidth: this._width(),\r\n\t\t\theight: this._height(),\r\n\t\t\tscale: this._y,\r\n\t\t\tticks: this.options.yTicks,\r\n\t\t\ttickFormat: \"\",\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"path\".\r\n\t */\r\n\t_appendAreaPath: function() {\r\n\t\treturn g => g.append('g')\r\n\t\t\t.attr(\"class\", \"area\")\r\n\t\t\t.append('path');\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"axis\".\r\n\t */\r\n\t_appendAxis: function() {\r\n\t\treturn g =>\r\n\t\t\tg.append(\"g\")\r\n\t\t\t.attr(\"class\", \"axis\")\r\n\t\t\t.call(this._appendXaxis())\r\n\t\t\t.call(this._appendYaxis());\r\n\t},\r\n\r\n\t_appendFocusable: function() {\r\n\t\treturn g => {\r\n\t\t\treturn g.append('g')\r\n\t\t\t\t.attr(\"class\", 'focus')\r\n\t\t\t\t.call(this._appendFocusRect())\r\n\t\t\t\t.call(this._appendMouseFocusG());\r\n\t\t};\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"mouse-focus\" and \"drag-rect\".\r\n\t */\r\n\t_appendFocusRect: function() {\r\n\t\treturn g => {\r\n\t\t\tlet focusRect = g.append(\"rect\")\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.FocusRect({\r\n\t\t\t\t\t\twidth: this._width(),\r\n\t\t\t\t\t\theight: this._height()\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\r\n\t\t\tif (L.Browser.mobile) {\r\n\t\t\t\tfocusRect\r\n\t\t\t\t\t.on(\"touchmove.drag\", this._dragHandler.bind(this))\r\n\t\t\t\t\t.on(\"touchstart.drag\", this._dragStartHandler.bind(this))\r\n\t\t\t\t\t.on(\"touchstart.focus\", this._mousemoveHandler.bind(this))\r\n\t\t\t\t\t.on(\"touchmove.focus\", this._mousemoveHandler.bind(this));\r\n\t\t\t\tL.DomEvent.on(this._container, 'touchend', this._dragEndHandler, this);\r\n\t\t\t}\r\n\r\n\t\t\tfocusRect\r\n\t\t\t\t.on(\"mousemove.drag\", this._dragHandler.bind(this))\r\n\t\t\t\t.on(\"mousedown.drag\", this._dragStartHandler.bind(this))\r\n\t\t\t\t.on(\"mouseenter.focus\", this._mouseenterHandler.bind(this))\r\n\t\t\t\t.on(\"mousemove.focus\", this._mousemoveHandler.bind(this))\r\n\t\t\t\t.on(\"mouseout.focus\", this._mouseoutHandler.bind(this));\r\n\t\t\tL.DomEvent.on(this._container, 'mouseup', this._dragEndHandler, this);\r\n\r\n\t\t\treturn focusRect;\r\n\t\t};\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"grid\".\r\n\t */\r\n\t_appendGrid: function() {\r\n\t\treturn g =>\r\n\t\t\tg.append(\"g\")\r\n\t\t\t.attr(\"class\", \"grid\")\r\n\t\t\t.call(this._appendXGrid())\r\n\t\t\t.call(this._appendYGrid());\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"mouse-focus\".\r\n\t */\r\n\t_appendMouseFocusG: function() {\r\n\t\treturn g => {\r\n\t\t\tlet focusG = this._focusG = g.append(\"g\")\r\n\t\t\t\t.attr(\"class\", \"mouse-focus-group hidden\");\r\n\r\n\t\t\tthis._focusline = focusG.append('svg:line')\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.MouseFocusLine({\r\n\t\t\t\t\t\txCoord: 0,\r\n\t\t\t\t\t\theight: this._height()\r\n\t\t\t\t\t})\r\n\t\t\t\t);;\r\n\t\t\tthis._focuslabel = focusG.append(\"g\")\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.MouseFocusLabel({\r\n\t\t\t\t\t\txCoord: 0,\r\n\t\t\t\t\t\tyCoord: 0,\r\n\t\t\t\t\t\theight: this._height(),\r\n\t\t\t\t\t\twidth: this._width(),\r\n\t\t\t\t\t\tlabelX: \"\",\r\n\t\t\t\t\t\tlabelY: \"\",\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\t\t\treturn focusG;\r\n\t\t};\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"legend\".\r\n\t */\r\n\t_appendLegend: function() {\r\n\t\treturn g => {\r\n\t\t\tif (!this.options.legend) return;\r\n\r\n\t\t\tlet legend = this._legend = g.append('g')\r\n\t\t\t\t.attr(\"class\", \"legend\");\r\n\r\n\t\t\tthis._fireEvt(\"elechart_legend\");\r\n\r\n\t\t\tlet items = legend.selectAll('.legend-item')\r\n\t\t\t\t.on('click', (d, i) => {\r\n\t\t\t\t\tlet target = items.nodes()[i];\r\n\t\t\t\t\tlet name = target.getAttribute('data-name');\r\n\t\t\t\t\tlet path = this._area.select('path[data-name=\"' + name + '\"]').node();\r\n\t\t\t\t\tthis._fireEvt(\"elepath_toggle\", { path: path, name: name, legend: target, });\r\n\t\t\t\t});\r\n\r\n\t\t\treturn legend;\r\n\t\t};\r\n\t},\r\n\r\n\t/*\r\n\t * Calculates the full extent of the data array\r\n\t */\r\n\t_calculateFullExtent: function(data) {\r\n\t\tif (!data || data.length < 1) {\r\n\t\t\tthrow new Error(\"no data in parameters\");\r\n\t\t}\r\n\r\n\t\tlet ext = new L.latLngBounds(data[0].latlng, data[0].latlng);\r\n\r\n\t\tdata.forEach(item => ext.extend(item.latlng));\r\n\r\n\t\treturn ext;\r\n\t},\r\n\r\n\t/*\r\n\t * Reset chart.\r\n\t */\r\n\t_clearChart: function() {\r\n\t\tthis._resetDrag();\r\n\t},\r\n\r\n\t/*\r\n\t * Reset data.\r\n\t */\r\n\t_clearData: function() {\r\n\t\tthis._data = null;\r\n\t\tthis._distance = null;\r\n\t\tthis._maxElevation = null;\r\n\t\tthis._minElevation = null;\r\n\t\tthis.track_info = null;\r\n\t\tthis._layers = null;\r\n\t},\r\n\r\n\t/*\r\n\t * Reset path.\r\n\t */\r\n\t_clearPath: function() {\r\n\t\tthis._hidePositionMarker();\r\n\t\tfor (let id in this._layers) {\r\n\t\t\tif (this._layers[id]._path) {\r\n\t\t\t\tL.DomUtil.removeClass(this._layers[id]._path, this.options.polyline.className);\r\n\t\t\t\tL.DomUtil.removeClass(this._layers[id]._path, this.options.theme);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Collapse current chart control.\r\n\t */\r\n\t_collapse: function() {\r\n\t\tif (this._container) {\r\n\t\t\tL.DomUtil.removeClass(this._container, 'elevation-expanded');\r\n\t\t\tL.DomUtil.addClass(this._container, 'elevation-collapsed');\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Handle drag operations.\r\n\t */\r\n\t_dragHandler: function() {\r\n\t\t//we don't want map events to occur here\r\n\t\td3.event.preventDefault();\r\n\t\td3.event.stopPropagation();\r\n\r\n\t\tthis._gotDragged = true;\r\n\t\tthis._drawDragRectangle();\r\n\t},\r\n\r\n\t/*\r\n\t * Handles end of drag operations. Zooms the map to the selected items extent.\r\n\t */\r\n\t_dragEndHandler: function() {\r\n\t\tif (!this._dragStartCoords || !this._dragCurrentCoords || !this._gotDragged) {\r\n\t\t\tthis._dragStartCoords = null;\r\n\t\t\tthis._gotDragged = false;\r\n\t\t\tif (this._draggingEnabled) this._resetDrag();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet item1 = this._findItemForX(this._dragStartCoords[0]);\r\n\t\tlet item2 = this._findItemForX(this._dragCurrentCoords[0]);\r\n\r\n\t\tif (item1 == item2) return;\r\n\r\n\t\tthis._hidePositionMarker();\r\n\r\n\t\tthis._fitSection(item1, item2);\r\n\r\n\t\tthis._dragStartCoords = null;\r\n\t\tthis._gotDragged = false;\r\n\r\n\t\tthis._fireEvt(\"elechart_dragged\", { data: { dragstart: this._data[item1], dragend: this._data[item2] } }, true);\r\n\t},\r\n\r\n\t/*\r\n\t * Handles start of drag operations.\r\n\t */\r\n\t_dragStartHandler: function() {\r\n\t\td3.event.preventDefault();\r\n\t\td3.event.stopPropagation();\r\n\r\n\t\tthis._gotDragged = false;\r\n\t\tthis._dragStartCoords = d3.mouse(this._focusRect.node());\r\n\t},\r\n\r\n\t/*\r\n\t * Draws the currently dragged rectangle over the chart.\r\n\t */\r\n\t_drawDragRectangle: function() {\r\n\t\tif (!this._dragStartCoords || !this._draggingEnabled) return;\r\n\t\tif (!this._dragRectangle) {\r\n\t\t\tthis._dragRectangle = this._focus.insert(\"rect\", \".mouse-focus-group\")\r\n\t\t\t\t.attr('class', 'mouse-drag')\r\n\t\t\t\t.style(\"pointer-events\", \"none\");\r\n\t\t}\r\n\t\tthis._dragRectangle.call(\r\n\t\t\tD3.DragRectangle({\r\n\t\t\t\tdragStartCoords: this._dragStartCoords,\r\n\t\t\t\tdragEndCoords: this._dragCurrentCoords = d3.mouse(this._focusRect.node()),\r\n\t\t\t\theight: this._height(),\r\n\t\t\t})\r\n\t\t);\r\n\t},\r\n\r\n\t/*\r\n\t * Expand current chart control.\r\n\t */\r\n\t_expand: function() {\r\n\t\tif (this._container) {\r\n\t\t\tL.DomUtil.removeClass(this._container, 'elevation-collapsed');\r\n\t\t\tL.DomUtil.addClass(this._container, 'elevation-expanded');\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Finds an item with the smallest delta in distance to the given latlng coords\r\n\t */\r\n\t_findItemForLatLng: function(latlng) {\r\n\t\tlet result = null;\r\n\t\tlet d = Infinity;\r\n\t\tthis._data.forEach(item => {\r\n\t\t\tlet dist = latlng.distanceTo(item.latlng);\r\n\t\t\tif (dist < d) {\r\n\t\t\t\td = dist;\r\n\t\t\t\tresult = item;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t},\r\n\r\n\t/*\r\n\t * Finds a data entry for a given x-coordinate of the diagram\r\n\t */\r\n\t_findItemForX: function(x) {\r\n\t\tlet opts = this.options;\r\n\t\tlet data = this._data ? this._data : [0, 1];\r\n\t\tlet bisect = d3.bisector(d => d[opts.xAttr]).left;\r\n\t\tlet xinvert = this._x.invert(x);\r\n\t\treturn bisect(data, xinvert);\r\n\t},\r\n\r\n\t/**\r\n\t * Fires an event of the specified type.\r\n\t */\r\n\t_fireEvt: function(type, data, propagate) {\r\n\t\tif (this.fire) {\r\n\t\t\tthis.fire(type, data, propagate);\r\n\t\t}\r\n\t\tif (this._map) {\r\n\t\t\tthis._map.fire(type, data, propagate);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Make the map fit the route section between given indexes.\r\n\t */\r\n\t_fitSection: function(index1, index2) {\r\n\t\tlet start = Math.min(index1, index2);\r\n\t\tlet end = Math.max(index1, index2);\r\n\t\tlet ext = this._calculateFullExtent(this._data.slice(start, end));\r\n\t\tthis.fitBounds(ext);\r\n\t},\r\n\r\n\t/**\r\n\t * Calculates chart height.\r\n\t */\r\n\t_height: function() {\r\n\t\tlet opts = this.options;\r\n\t\treturn opts.height - opts.margins.top - opts.margins.bottom;\r\n\t},\r\n\r\n\t/*\r\n\t * Hides the position/height indicator marker drawn onto the map\r\n\t */\r\n\t_hidePositionMarker: function() {\r\n\t\tif (!this.options.autohideMarker) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._selectedItem = null;\r\n\r\n\t\tif (this._marker) {\r\n\t\t\tthis._marker.remove();\r\n\t\t}\r\n\t\tif (this._heightG) {\r\n\t\t\tthis._heightG.classed(\"hidden\", true);\r\n\t\t}\r\n\t\tif (this._pointG) {\r\n\t\t\tthis._pointG.classed(\"hidden\", true);\r\n\t\t}\r\n\t\tif (this._focusG) {\r\n\t\t\tthis._focusG.classed(\"hidden\", true);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"svg\" chart DOM element.\r\n\t */\r\n\t_initChart: function() {\r\n\t\tlet opts = this.options;\r\n\t\topts.xTicks = opts.xTicks || Math.round(this._width() / 75);\r\n\t\topts.yTicks = opts.yTicks || Math.round(this._height() / 30);\r\n\r\n\t\tif (opts.responsive) {\r\n\t\t\tif (opts.detached) {\r\n\t\t\t\tlet offWi = this.eleDiv.offsetWidth;\r\n\t\t\t\tlet offHe = this.eleDiv.offsetHeight;\r\n\t\t\t\topts.width = offWi > 0 ? offWi : opts.width;\r\n\t\t\t\topts.height = (offHe - 20) > 0 ? offHe - 20 : opts.height; // 20 = horizontal scrollbar size.\r\n\t\t\t} else {\r\n\t\t\t\topts._maxWidth = opts._maxWidth > opts.width ? opts._maxWidth : opts.width;\r\n\t\t\t\tlet containerWidth = this._map._container.clientWidth;\r\n\t\t\t\topts.width = opts._maxWidth > containerWidth ? containerWidth - 30 : opts.width;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet scale = this._updateScale();\r\n\r\n\t\tlet container = d3.select(this._container)\r\n\t\t\t.call(this._appendChart())\r\n\t\t\t.call(this._appendSummary());\r\n\r\n\t\tlet svg = this._svg = container.select('svg');\r\n\t\tthis._grid = svg.select('.grid');\r\n\t\tthis._area = svg.select('.area');\r\n\t\tthis._path = svg.select('.area path');\r\n\t\tthis._axis = svg.select('.axis');\r\n\t\tthis._focus = svg.select('.focus');\r\n\t\tthis._focusRect = svg.select('rect');\r\n\t\tthis._x = scale.x;\r\n\t\tthis._y = scale.y;\r\n\r\n\t\tthis._fireEvt(\"elechart_init\", null, true);\r\n\t},\r\n\r\n\t/**\r\n\t * Inspired by L.Control.Layers\r\n\t */\r\n\t_initToggle: function(container) {\r\n\t\t//Makes this work on IE10 Touch devices by stopping it from firing a mouseout event when the touch is released\r\n\t\tcontainer.setAttribute('aria-haspopup', true);\r\n\r\n\t\tif (!this.options.detached) {\r\n\t\t\tL.DomEvent\r\n\t\t\t\t.disableClickPropagation(container);\r\n\t\t\t//.disableScrollPropagation(container);\r\n\t\t}\r\n\r\n\t\tif (L.Browser.mobile) {\r\n\t\t\tL.DomEvent.on(container, 'click', L.DomEvent.stopPropagation);\r\n\t\t}\r\n\r\n\t\tL.DomEvent.on(container, 'mousewheel', this._mousewheelHandler, this);\r\n\r\n\t\tif (!this.options.detached) {\r\n\t\t\tlet iconCssClass = \"elevation-toggle \" + this.options.controlButton.iconCssClass + (this.options.autohide ? \"\" : \" close-button\");\r\n\t\t\tlet link = this._button = L.DomUtil.create('a', iconCssClass, container);\r\n\t\t\tlink.href = '#';\r\n\t\t\tlink.title = this.options.controlButton.title;\r\n\r\n\t\t\tif (this.options.collapsed) {\r\n\t\t\t\tthis._collapse();\r\n\t\t\t\tif (this.options.autohide) {\r\n\t\t\t\t\tL.DomEvent\r\n\t\t\t\t\t\t.on(container, 'mouseover', this._expand, this)\r\n\t\t\t\t\t\t.on(container, 'mouseout', this._collapse, this);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tL.DomEvent\r\n\t\t\t\t\t\t.on(link, 'click', L.DomEvent.stop)\r\n\t\t\t\t\t\t.on(link, 'click', this._toggle, this);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tL.DomEvent.on(link, 'focus', this._toggle, this);\r\n\r\n\t\t\t\tthis._map.on('click', this._collapse, this);\r\n\t\t\t\t// TODO: keyboard accessibility\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// TODO: handle autohide when detached=true\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseenter over the chart.\r\n\t */\r\n\t_mouseenterHandler: function() {\r\n\t\tthis._fireEvt(\"elechart_enter\", null, true);\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseover the chart and displays distance and altitude level.\r\n\t */\r\n\t_mousemoveHandler: function(d, i, ctx) {\r\n\t\tif (!this._data || this._data.length === 0 || !this._chartEnabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet coords = d3.mouse(this._focusRect.node());\r\n\t\tlet xCoord = coords[0];\r\n\t\tlet item = this._data[this._findItemForX(xCoord)];\r\n\r\n\t\tthis._hidePositionMarker();\r\n\t\tthis._showDiagramIndicator(item, xCoord);\r\n\t\tthis._showPositionMarker(item);\r\n\t\tthis._setMapView(item);\r\n\r\n\t\tif (this._map && this._map._container) {\r\n\t\t\tL.DomUtil.addClass(this._map._container, 'elechart-hover');\r\n\t\t}\r\n\r\n\t\tthis._fireEvt(\"elechart_change\", { data: item, xCoord: xCoord }, true);\r\n\t\tthis._fireEvt(\"elechart_hover\", { data: item, xCoord: xCoord }, true);\r\n\t},\r\n\r\n\t/*\r\n\t * Handles mouseover events of the data layers on the map.\r\n\t */\r\n\t_mousemoveLayerHandler: function(e) {\r\n\t\tif (!this._data || this._data.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet latlng = e.latlng;\r\n\t\tlet item = this._findItemForLatLng(latlng);\r\n\t\tif (item) {\r\n\t\t\tlet xCoord = item.xDiagCoord;\r\n\r\n\t\t\tthis._hidePositionMarker();\r\n\t\t\tthis._showDiagramIndicator(item, xCoord);\r\n\t\t\tthis._showPositionMarker(item);\r\n\r\n\t\t\tthis._fireEvt(\"elechart_change\", { data: item, xCoord: xCoord }, true);\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseout over the chart.\r\n\t */\r\n\t_mouseoutHandler: function() {\r\n\t\tif (!this.options.detached) {\r\n\t\t\tthis._hidePositionMarker();\r\n\t\t}\r\n\r\n\t\tif (this._map && this._map._container) {\r\n\t\t\tL.DomUtil.removeClass(this._map._container, 'elechart-hover');\r\n\t\t}\r\n\r\n\t\tthis._fireEvt(\"elechart_leave\", null, true);\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the mouesewheel over the chart.\r\n\t */\r\n\t_mousewheelHandler: function(e) {\r\n\t\tif (this._map.gestureHandling && this._map.gestureHandling._enabled) return;\r\n\t\tlet ll = this._selectedItem ? this._selectedItem.latlng : this._map.getCenter();\r\n\t\tlet z = e.deltaY > 0 ? this._map.getZoom() - 1 : this._map.getZoom() + 1;\r\n\t\tthis._resetDrag();\r\n\t\tthis._map.flyTo(ll, z);\r\n\r\n\t},\r\n\r\n\t/*\r\n\t * Removes the drag rectangle and zoms back to the total extent of the data.\r\n\t */\r\n\t_resetDrag: function() {\r\n\t\tif (this._dragRectangle) {\r\n\t\t\tthis._dragRectangle.remove();;\r\n\t\t\tthis._dragRectangle = null;\r\n\t\t\tthis._hidePositionMarker();\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Resets drag, marker and bounds.\r\n\t */\r\n\t_resetView: function() {\r\n\t\tif (this._map && this._map._isFullscreen) return;\r\n\t\tthis._resetDrag();\r\n\t\tthis._hidePositionMarker();\r\n\t\tthis.fitBounds(this._fullExtent);\r\n\t},\r\n\r\n\t/**\r\n\t * Hacky way for handling chart resize. Deletes it and redraw chart.\r\n\t */\r\n\t_resizeChart: function() {\r\n\t\t// prevent displaying chart on resize if hidden\r\n\t\tif (this._container.style.display == \"none\") return;\r\n\r\n\t\tif (this.options.responsive) {\r\n\t\t\tif (this.options.detached) {\r\n\t\t\t\tlet newWidth = this.eleDiv.offsetWidth; // - 20;\r\n\r\n\t\t\t\tif (newWidth <= 0) return;\r\n\r\n\t\t\t\tthis.options.width = newWidth;\r\n\t\t\t\tthis.eleDiv.innerHTML = \"\";\r\n\t\t\t\tthis.eleDiv.appendChild(this.onAdd(this._map));\r\n\t\t\t} else {\r\n\t\t\t\tthis._map.removeControl(this._container);\r\n\t\t\t\tthis.addTo(this._map);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Display distance and altitude level (\"focus-rect\").\r\n\t */\r\n\t_showDiagramIndicator: function(item, xCoordinate) {\r\n\t\tif (!this._chartEnabled) return;\r\n\r\n\t\tlet opts = this.options;\r\n\t\tlet formatter = opts.hoverNumber.formatter;\r\n\t\tlet [fx, fy] = [opts.hoverNumber.decimalsX, opts.hoverNumber.decimalsY];\r\n\t\tlet yCoordinate = this._y(item[opts.yAttr]);\r\n\r\n\t\tthis._focusG.classed(\"hidden\", false);\r\n\r\n\t\tthis._focusline.call(\r\n\t\t\tD3.MouseFocusLine({\r\n\t\t\t\txCoord: xCoordinate,\r\n\t\t\t\theight: this._height()\r\n\t\t\t})\r\n\t\t);\r\n\t\tthis._focuslabel.call(\r\n\t\t\tD3.MouseFocusLabel({\r\n\t\t\t\txCoord: xCoordinate,\r\n\t\t\t\tyCoord: yCoordinate,\r\n\t\t\t\theight: this._height(),\r\n\t\t\t\twidth: this._width(),\r\n\t\t\t\tlabelX: formatter(item[opts.xAttr], fx) + \" \" + this._xLabel,\r\n\t\t\t\tlabelY: formatter(item[opts.yAttr], fy) + \" \" + this._yLabel,\r\n\t\t\t})\r\n\t\t);\r\n\t},\r\n\r\n\t/**\r\n\t * Collapse or Expand current chart control.\r\n\t */\r\n\t_toggle: function() {\r\n\t\tif (L.DomUtil.hasClass(this._container, \"elevation-expanded\"))\r\n\t\t\tthis._collapse();\r\n\t\telse\r\n\t\t\tthis._expand();\r\n\t},\r\n\r\n\t/**\r\n\t * Sets the view of the map (center and zoom). Useful when \"followMarker\" is true.\r\n\t */\r\n\t_setMapView: function(item) {\r\n\t\tif (!this.options.followMarker || !this._map) return;\r\n\t\tlet zoom = this._map.getZoom();\r\n\t\tzoom = zoom < this._zFollow ? this._zFollow : zoom;\r\n\t\tthis._map.setView(item.latlng, zoom, { animate: true, duration: 0.25 });\r\n\t},\r\n\r\n\t/*\r\n\t * Shows the position/height indicator marker drawn onto the map\r\n\t */\r\n\t_showPositionMarker: function(item) {\r\n\t\tthis._selectedItem = item;\r\n\t\tif (this.options.marker == 'elevation-line') {\r\n\t\t\tthis._updatePositionMarker(item);\r\n\t\t} else if (this.options.marker == 'position-marker') {\r\n\t\t\tthis._updateLeafletMarker(item);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Update chart axis.\r\n\t */\r\n\t_updateAxis: function() {\r\n\t\tthis._grid.selectAll('g').remove();\r\n\t\tthis._axis.selectAll('g').remove();\r\n\t\tthis._grid\r\n\t\t\t.call(this._appendXGrid())\r\n\t\t\t.call(this._appendYGrid());\r\n\t\tthis._axis\r\n\t\t\t.call(this._appendXaxis())\r\n\t\t\t.call(this._appendYaxis());\r\n\r\n\t\tthis._fireEvt('elechart_axis');\r\n\t},\r\n\r\n\t/**\r\n\t * Calculates [x, y] domain and then update chart.\r\n\t */\r\n\t_updateChart: function() {\r\n\t\tif (!this._data || !this._container) return;\r\n\r\n\t\tthis._updateScale();\r\n\t\tthis._updateAxis();\r\n\t\tthis._updateAreaPath();\r\n\r\n\t\tthis._fullExtent = this._calculateFullExtent(this._data);\r\n\r\n\t\tthis._fireEvt('elechart_updated');\r\n\t},\r\n\r\n\t_updateAreaPath: function() {\r\n\t\tlet opts = this.options;\r\n\t\tthis._path\r\n\t\t\t.call(\r\n\t\t\t\tD3.Area({\r\n\t\t\t\t\tinterpolation: opts.interpolation,\r\n\t\t\t\t\tdata: this._data,\r\n\t\t\t\t\tname: 'Altitude',\r\n\t\t\t\t\txAttr: opts.xAttr,\r\n\t\t\t\t\tyAttr: opts.yAttr,\r\n\t\t\t\t\twidth: this._width(),\r\n\t\t\t\t\theight: this._height(),\r\n\t\t\t\t\tscaleX: this._x,\r\n\t\t\t\t\tscaleY: this._y,\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t},\r\n\r\n\t/**\r\n\t * Update position marker (\"leaflet-marker\").\r\n\t */\r\n\t_updateLeafletMarker: function(item) {\r\n\t\tif (!this._marker) {\r\n\t\t\tthis._marker = L.marker(item.latlng, { icon: this.options.markerIcon, zIndexOffset: 1000000 })\r\n\t\t\t\t.addTo(this._map, { pane: 'elevationPane' });\r\n\t\t} else {\r\n\t\t\tthis._marker.setLatLng(item.latlng);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Update position marker (\"leaflet-marker\").\r\n\t */\r\n\t_updatePositionMarker: function(item) {\r\n\t\tlet opts = this.options;\r\n\t\tlet point = L.extend({}, item, this._map.latLngToLayerPoint(item.latlng));\r\n\r\n\t\tlet formatter = opts.hoverNumber.formatter;\r\n\t\tlet fy = opts.hoverNumber.decimalsY;\r\n\r\n\t\tlet normalizedAlt = this._height() / this._maxElevation * point.z;\r\n\t\tlet normalizedY = point.y - normalizedAlt;\r\n\r\n\t\tif (!this._heightG) {\r\n\t\t\tlet renderer = L.svg({ pane: \"elevationPane\" }).addTo(this._map); // default leaflet svg renderer\r\n\t\t\tlet pane = d3.select(renderer.getPane()).select(\"svg\");\r\n\t\t\tlet g = this._heightG = pane.select(\"g\").attr(\"class\", \"height-focus-group\");\r\n\t\t\tthis._mouseHeightFocus = g.append('svg:line');\r\n\t\t\tthis._pointG = g.append(\"svg:circle\");\r\n\t\t\tthis._mouseHeightFocusLabel = g.append(\"svg:text\");\r\n\t\t}\r\n\r\n\t\tthis._heightG.classed(\"hidden\", false);\r\n\t\tthis._pointG.classed(\"hidden\", false);\r\n\r\n\t\tthis._pointG\r\n\t\t\t.call(\r\n\t\t\t\tD3.HeightFocusPoint({\r\n\t\t\t\t\ttheme: this.options.theme,\r\n\t\t\t\t\txCoord: point.x,\r\n\t\t\t\t\tyCoord: point.y,\r\n\t\t\t\t}));\r\n\r\n\t\tthis._mouseHeightFocus\r\n\t\t\t.call(\r\n\t\t\t\tD3.HeightFocusLine({\r\n\t\t\t\t\ttheme: this.options.theme,\r\n\t\t\t\t\txCoord: point.x,\r\n\t\t\t\t\tyCoord: point.y,\r\n\t\t\t\t\tlength: normalizedY\r\n\t\t\t\t})\r\n\t\t\t);\r\n\r\n\t\tthis._mouseHeightFocusLabel\r\n\t\t\t.call(\r\n\t\t\t\tD3.HeightFocusLabel({\r\n\t\t\t\t\ttheme: this.options.theme,\r\n\t\t\t\t\txCoord: point.x,\r\n\t\t\t\t\tyCoord: normalizedY,\r\n\t\t\t\t\tlabel: formatter(point[opts.yAttr], fy) + \" \" + this._yLabel\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t},\r\n\r\n\t_updateScale: function() {\r\n\t\tlet opts = this.options;\r\n\r\n\t\tthis._x = D3.Scale({\r\n\t\t\tdata: this._data,\r\n\t\t\trange: [0, this._width()],\r\n\t\t\tattr: opts.xAttr,\r\n\t\t\tmin: opts.xAxisMin,\r\n\t\t\tmax: opts.xAxisMax,\r\n\t\t\tforceBounds: opts.forceAxisBounds,\r\n\t\t});\r\n\r\n\t\tthis._y = D3.Scale({\r\n\t\t\tdata: this._data,\r\n\t\t\trange: [this._height(), 0],\r\n\t\t\tattr: opts.yAttr,\r\n\t\t\tmin: opts.yAxisMin,\r\n\t\t\tmax: opts.yAxisMax,\r\n\t\t\tforceBounds: opts.forceAxisBounds,\r\n\t\t});\r\n\r\n\t\treturn { x: this._x, y: this._y };\r\n\t},\r\n\r\n\t/**\r\n\t * Update chart summary.\r\n\t */\r\n\t_updateSummary: function() {\r\n\t\tthis.summaryDiv.innerHTML = '';\r\n\t\tthis.track_info = this.track_info || {};\r\n\t\tthis.track_info.distance = this._distance || 0;\r\n\t\tthis.track_info.elevation_max = this._maxElevation || 0;\r\n\t\tthis.track_info.elevation_min = this._minElevation || 0;\r\n\r\n\t\tif (this.options.summary) {\r\n\t\t\tthis._fireEvt(\"elechart_summary\");\r\n\t\t}\r\n\t\tif (this.options.downloadLink && this._downloadURL) { // TODO: generate dynamically file content instead of using static file urls.\r\n\t\t\tthis.summaryDiv.innerHTML += '<span class=\"download\"><a href=\"#\">' + L._('Download') + '</a></span>'\r\n\t\t\tthis.summaryDiv.querySelector('.download a').onclick = (e) => {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tthis._fireEvt('eletrack_download', { downloadLink: this.options.downloadLink, confirm: _.saveFile.bind(this._downloadURL) });\r\n\t\t\t};\r\n\t\t};\r\n\t},\r\n\r\n\r\n\t/**\r\n\t * Calculates chart width.\r\n\t */\r\n\t_width: function() {\r\n\t\tlet opts = this.options;\r\n\t\treturn opts.width - opts.margins.left - opts.margins.right;\r\n\t},\r\n\r\n});\r\n\r\n/**\r\n * Attach here some useful elevation hooks.\r\n */\r\nElevation.addInitHook(function() {\r\n\r\n\tthis.on('waypoint_added', function(e) {\r\n\t\tlet p = e.point,\r\n\t\t\tpop = p._popup;\r\n\t\tif (pop) {\r\n\t\t\tpop.options.className = 'elevation-popup';\r\n\t\t}\r\n\t\tif (pop._content) {\r\n\t\t\tpop._content = decodeURI(pop._content);\r\n\t\t\tp.bindTooltip(pop._content, { direction: 'top', sticky: true, opacity: 1, className: 'elevation-tooltip' }).openTooltip();\r\n\t\t}\r\n\t});\r\n\r\n\tthis.on('elepath_toggle', function(e) {\r\n\t\tlet path = e.path;\r\n\r\n\t\tlet enabled = L.DomUtil.hasClass(path, 'hidden');\r\n\t\tlet text = d3.select(e.legend).select('text');\r\n\r\n\t\tif (enabled) {\r\n\t\t\tL.DomUtil.removeClass(path, 'hidden');\r\n\t\t\ttext.style(\"text-decoration-line\", \"\")\r\n\t\t} else {\r\n\t\t\tL.DomUtil.setClass(path, 'hidden');\r\n\t\t\ttext.style(\"text-decoration-line\", \"line-through\")\r\n\t\t}\r\n\r\n\t\tthis._chartEnabled = this._area.selectAll('path:not(.hidden)').nodes().length != 0;\r\n\r\n\t\t// autotoggle chart data on single click\r\n\t\tif (!this._chartEnabled) {;\r\n\t\t\tthis._resetDrag();\r\n\t\t\tthis._clearPath();\r\n\t\t} else {\r\n\t\t\t// this._resizeChart();\r\n\t\t\tfor (let id in this._layers) {\r\n\t\t\t\tif (this._layers[id]._path) {\r\n\t\t\t\t\tL.DomUtil.addClass(this._layers[id]._path, this.options.polyline.className + ' ' + this.options.theme);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tthis.on(\"elechart_legend\", function() {\r\n\t\tthis._altitudeLegend = this._legend.append('g')\r\n\t\t\t.call(\r\n\t\t\t\tD3.LegendItem({\r\n\t\t\t\t\tname: 'Altitude',\r\n\t\t\t\t\twidth: this._width(),\r\n\t\t\t\t\theight: this._height(),\r\n\t\t\t\t\tmargins: this.options.margins,\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t});\r\n\r\n\tthis.on(\"elechart_summary\", function() {\r\n\t\tthis.summaryDiv.innerHTML +=\r\n\t\t\t'<span class=\"totlen\"><span class=\"summarylabel\">' + L._(\"Total Length: \") + '</span><span class=\"summaryvalue\">' + this.track_info.distance.toFixed(2) + '&nbsp;' + this._xLabel + '</span></span>' +\r\n\t\t\t'<span class=\"maxele\"><span class=\"summarylabel\">' + L._(\"Max Elevation: \") + '</span><span class=\"summaryvalue\">' + this.track_info.elevation_max.toFixed(2) + '&nbsp;' + this._yLabel + '</span></span>' +\r\n\t\t\t'<span class=\"minele\"><span class=\"summarylabel\">' + L._(\"Min Elevation: \") + '</span><span class=\"summaryvalue\">' + this.track_info.elevation_min.toFixed(2) + '&nbsp;' + this._yLabel + '</span></span>';\r\n\t});\r\n\r\n\tthis.on(\"eletrack_download\", function(e) {\r\n\t\tif (e.downloadLink == 'modal' && typeof CustomEvent === \"function\") {\r\n\t\t\tdocument.dispatchEvent(new CustomEvent(\"eletrack_download\", { detail: e }));\r\n\t\t} else if (e.downloadLink == 'link' || e.downloadLink === true) {\r\n\t\t\te.confirm();\r\n\t\t}\r\n\t});\r\n\r\n\tthis.on('eledata_loaded', function(e) {\r\n\t\tlet layer = e.layer;\r\n\t\tif (this._map) {\r\n\t\t\tthis._map.once('layeradd', function(e) {\r\n\t\t\t\tthis.fitBounds(layer.getBounds());\r\n\t\t\t}, this);\r\n\t\t\tlayer.addTo(this._map);\r\n\t\t} else {\r\n\t\t\tconsole.warn(\"Undefined elevation map object\");\r\n\t\t}\r\n\t});\r\n\r\n\tthis.on('eledata_clear', function() {\r\n\t\tthis._area.selectAll('path')\r\n\t\t\t.attr(\"d\", \"M0 0\");\r\n\t\tif (this._path) {\r\n\t\t\t// this._x.domain([0, 1]);\r\n\t\t\t// this._y.domain([0, 1]);\r\n\t\t\t// this._updateAxis();\r\n\t\t}\r\n\t});\r\n});\r\n","import 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\nimport { Elevation } from './control';\r\n\r\nElevation.addInitHook(function() {\r\n\r\n\tif (!this.options.slope) return;\r\n\r\n\tlet opts = this.options;\r\n\tlet slope = {};\r\n\topts.margins.right = 50;\r\n\r\n\tthis.on(\"elechart_init\", function() {\r\n\t\tslope.path = this._area.append('path')\r\n\t\t\t.style(\"pointer-events\", \"none\")\r\n\t\t\t// TODO: add a class here.\r\n\t\t\t.attr(\"fill\", \"#F00\")\r\n\t\t\t.attr(\"stroke\", \"#000\")\r\n\t\t\t.attr(\"stroke-opacity\", \"0.5\")\r\n\t\t\t.attr(\"fill-opacity\", \"0.25\");\r\n\t});\r\n\r\n\tthis.on(\"elechart_axis\", function() {\r\n\t\tslope.x = this._x;\r\n\r\n\t\tslope.y = D3.Scale({\r\n\t\t\tdata: this._data,\r\n\t\t\trange: [this._height(), 0],\r\n\t\t\tattr: \"slope\",\r\n\t\t\tmin: -1,\r\n\t\t\tmax: +1,\r\n\t\t\tforceBounds: opts.forceAxisBounds,\r\n\t\t});\r\n\r\n\t\tslope.axis = D3.Axis({\r\n\t\t\taxis: \"y\",\r\n\t\t\tposition: \"right\",\r\n\t\t\twidth: this._width(),\r\n\t\t\theight: this._height(),\r\n\t\t\tscale: slope.y,\r\n\t\t\tticks: this.options.yTicks,\r\n\t\t\ttickPadding: 16,\r\n\t\t\tlabel: \"%\",\r\n\t\t\tlabelX: 25,\r\n\t\t\tlabelY: 3,\r\n\t\t});\r\n\r\n\t\tthis._axis.call(slope.axis);\r\n\t});\r\n\r\n\tthis.on(\"elechart_updated\", function() {\r\n\t\tslope.area = D3.Area({\r\n\t\t\tinterpolation: \"curveStepAfter\",\r\n\t\t\tdata: this._data,\r\n\t\t\tname: 'Slope',\r\n\t\t\txAttr: opts.xAttr,\r\n\t\t\tyAttr: \"slope\",\r\n\t\t\twidth: this._width(),\r\n\t\t\theight: this._height(),\r\n\t\t\tscaleX: slope.x,\r\n\t\t\tscaleY: slope.y,\r\n\t\t});\r\n\r\n\t\tslope.path.call(slope.area);\r\n\t});\r\n\r\n\tthis.on(\"elechart_legend\", function() {\r\n\t\tslope.legend = this._legend.append(\"g\")\r\n\t\t\t.call(\r\n\t\t\t\tD3.LegendItem({\r\n\t\t\t\t\tname: 'Slope',\r\n\t\t\t\t\twidth: this._width(),\r\n\t\t\t\t\theight: this._height(),\r\n\t\t\t\t\tmargins: this.options.margins,\r\n\t\t\t\t})\r\n\t\t\t);\r\n\r\n\t\tthis._altitudeLegend\r\n\t\t\t.attr(\"transform\", \"translate(-50, 0)\");\r\n\r\n\t\tslope.legend\r\n\t\t\t.attr(\"transform\", \"translate(50, 0)\");\r\n\r\n\t\tslope.legend.select(\"rect\")\r\n\t\t\t.classed(\"area\", false)\r\n\t\t\t // TODO: add a class here.\r\n\t\t\t.attr(\"fill\", \"#F00\")\r\n\t\t\t.attr(\"stroke\", \"#000\")\r\n\t\t\t.attr(\"stroke-opacity\", \"0.5\")\r\n\t\t\t.attr(\"fill-opacity\", \"0.25\");\r\n\r\n\t});\r\n\r\n\tthis.on(\"eledata_updated\", function(e) {\r\n\t\tlet data = this._data;\r\n\t\tlet i = e.index;\r\n\t\tlet z = data[i].z;\r\n\r\n\t\tlet curr = data[i].latlng;\r\n\t\tlet prev = i > 0 ? data[i - 1].latlng : curr;\r\n\r\n\t\tlet delta = curr.distanceTo(prev) * this._distanceFactor;\r\n\r\n\t\t// Slope / Gain\r\n\t\tlet tAsc = this._tAsc || 0; // Total Ascent\r\n\t\tlet tDes = this._tDes || 0; // Total Descent\r\n\t\tlet sMax = this._sMax || 0; // Slope Max\r\n\t\tlet sMin = this._sMin || 0; // Slope Min\r\n\t\tlet diff = 0;\r\n\t\tlet slope = 0;\r\n\r\n\t\tif (!isNaN(z)) {\r\n\t\t\t// diff height between actual and previous point\r\n\t\t\tdiff = i > 0 ? z - data[i - 1].z : 0;\r\n\t\t\tif (diff > 0) tAsc += diff;\r\n\t\t\tif (diff < 0) tDes -= diff;\r\n\t\t\t// slope in % = ( height / length ) * 100\r\n\t\t\tslope = delta !== 0 ? Math.round((diff / delta) * 10000) / 100 : 0;\r\n\t\t\t// apply slope to the previous point because we will\r\n\t\t\t// ascent or desent, so the slope is in the fist point\r\n\t\t\tif (i > 0) data[i - 1].slope = slope;\r\n\t\t\tsMax = slope > sMax ? slope : sMax;\r\n\t\t\tsMin = slope < sMin ? slope : sMin;\r\n\t\t}\r\n\r\n\t\tdata[i].slope = slope;\r\n\r\n\t\tthis.track_info = this.track_info || {};\r\n\t\tthis.track_info.ascent = this._tAsc = tAsc;\r\n\t\tthis.track_info.descent = this._tDes = tDes;\r\n\t\tthis.track_info.slope_max = this._sMax = sMax;\r\n\t\tthis.track_info.slope_min = this._sMin = sMin;\r\n\t});\r\n\r\n\tthis.on(\"elechart_change\", function(e) {\r\n\t\tlet item = e.data;\r\n\t\tlet xCoordinate = e.xCoord;\r\n\r\n\t\tif (!this._focuslabelSlope || !this._focuslabelSlope.property('isConnected')) {\r\n\t\t\tthis._focuslabelSlope = this._focuslabel.select('text').insert(\"svg:tspan\", \".mouse-focus-label-x\")\r\n\t\t\t\t.attr(\"class\", \"mouse-focus-label-slope\")\r\n\t\t\t\t.attr(\"dy\", \"1.5em\");\r\n\t\t}\r\n\r\n\t\tthis._focuslabelSlope.text(item.slope + \"%\");\r\n\r\n\t\tif (!this._mouseSlopeFocusLabel) {\r\n\t\t\tthis._mouseSlopeFocusLabel = this._mouseHeightFocusLabel.append(\"svg:tspan\")\r\n\t\t\t\t.attr(\"class\", \"height-focus-slope \");\r\n\t\t}\r\n\r\n\t\tthis._mouseHeightFocusLabel.select('.height-focus-y')\r\n\t\t\t.attr(\"dy\", \"-1.5em\");\r\n\t\tthis._focuslabel.select('.mouse-focus-label-x')\r\n\t\t\t.attr(\"dy\", \"1.5em\");\r\n\r\n\t\tthis._mouseSlopeFocusLabel\r\n\t\t\t.attr(\"dy\", \"1.5em\")\r\n\t\t\t.text(Math.round(item.slope) + \"%\");\r\n\r\n\t});\r\n\r\n\tthis.on(\"elechart_summary\", function() {\r\n\t\tthis.track_info.ascent = this._tAsc || 0;\r\n\t\tthis.track_info.descent = this._tDes || 0;\r\n\t\tthis.track_info.slope_max = this._sMax || 0;\r\n\t\tthis.track_info.slope_min = this._sMin || 0;\r\n\r\n\t\tthis.summaryDiv.querySelector('.minele').insertAdjacentHTML('afterend', '<span class=\"ascent\"><span class=\"summarylabel\">' + L._(\"Total Ascent: \") + '</span><span class=\"summaryvalue\">' + Math.round(this.track_info.ascent) + '&nbsp;' +\r\n\t\t\tthis._yLabel +\r\n\t\t\t'</span></span>' + '<span class=\"descent\"><span class=\"summarylabel\">' + L._(\"Total Descent: \") + '</span><span class=\"summaryvalue\">' + Math.round(this.track_info.descent) + '&nbsp;' + this._yLabel +\r\n\t\t\t'</span></span>' + '<span class=\"minslope\"><span class=\"summarylabel\">' + L._(\"Min Slope: \") + '</span><span class=\"summaryvalue\">' + this.track_info.slope_min + '&nbsp;' + '%' +\r\n\t\t\t'</span></span>' + '<span class=\"maxslope\"><span class=\"summarylabel\">' + L._(\"Max Slope: \") + '</span><span class=\"summaryvalue\">' + this.track_info.slope_max + '&nbsp;' + '%' +\r\n\t\t\t'</span></span>');\r\n\t});\r\n\r\n\tthis.on(\"eledata_clear\", function() {\r\n\t\tthis._sMax = null;\r\n\t\tthis._sMin = null;\r\n\t\tthis._tAsc = null;\r\n\t\tthis._tDes = null;\r\n\t});\r\n\r\n});\r\n","/*\r\n * Copyright (c) 2019, GPL-3.0+ Project, Raruto\r\n *\r\n *  This file is free software: you may copy, redistribute and/or modify it\r\n *  under the terms of the GNU General Public License as published by the\r\n *  Free Software Foundation, either version 2 of the License, or (at your\r\n *  option) any later version.\r\n *\r\n *  This file is distributed in the hope that it will be useful, but\r\n *  WITHOUT ANY WARRANTY; without even the implied warranty of\r\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n *  General Public License for more details.\r\n *\r\n *  You should have received a copy of the GNU General Public License\r\n *  along with this program.  If not, see .\r\n *\r\n * This file incorporates work covered by the following copyright and\r\n * permission notice:\r\n *\r\n *     Copyright (c) 2013-2016, MIT License, Felix MrMufflon Bache\r\n *\r\n *     Permission to use, copy, modify, and/or distribute this software\r\n *     for any purpose with or without fee is hereby granted, provided\r\n *     that the above copyright notice and this permission notice appear\r\n *     in all copies.\r\n *\r\n *     THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL\r\n *     WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED\r\n *     WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE\r\n *     AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR\r\n *     CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS\r\n *     OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT,\r\n *     NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN\r\n *     CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.\r\n */\r\n\r\nimport 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\nimport { Elevation } from './control';\r\nimport './slope';\r\n\r\nElevation.Utils = _;\r\nElevation.Components = D3;\r\n\r\nL.control.elevation = (options) => new Elevation(options);\r\n"],"names":["deepMerge","target","sources","length","source","shift","isObject","key","Object","assign","[object Object]","deferFunc","f","document","readyState","window","addEventListener","once","formatter","num","dec","sep","res","L","Util","formatNum","toString","numbers","split","d","join","GeoJSONLoader","data","control","JSON","parse","this","layer","geoJson","style","feature","extend","options","polyline","theme","className","pointToLayer","latlng","marker","icon","gpxOptions","marker_options","wptIcons","desc","properties","name","bindPopup","openPopup","fire","point","point_type","element","onEachFeature","geometry","type","addData","track_info","_fireEvt","GPXLoader","polyline_options","GPX","on","e","line","get_name","item","Array","isArray","isVisible","elem","styles","getComputedStyle","visibility","display","isVisibleByStyles","boundingRect","getBoundingClientRect","left","right","top","above","bottom","pointerEvents","elementFromPoint","isAboveOtherElements","isJSONDoc","doc","lazy","trim","indexOf","console","warn","isXMLDoc","documentElement","ownerDocument","nodeName","lazyLoader","url","skip","loader","Promise","resolve","reject","tag","createElement","src","head","appendChild","loadFile","success","xhr","XMLHttpRequest","responseType","open","onload","response","onerror","status","send","saveFile","dataURI","fileName","a","b","body","href","download","click","removeChild","waitHolder","ticking","scrollFn","requestAnimFrame","removeEventListener","factory","define","amd","exports","module","require","locales","locale","registerLocale","code","setLocale","i18n","_","string","template","err","offsetWidth","offsetHeight","getClientRects","Area","props","path","interpolation","d3","area","curve","x","xDiagCoord","scaleX","xAttr","y0","height","y1","scaleY","yAttr","datum","attr","Axis","g","tickSize","tickPadding","w","h","axis","position","width","scale","replace","l","toUpperCase","ticks","tickFormat","append","call","label","labelX","labelY","text","DragRectangle","rect","x1","Math","min","dragStartCoords","dragEndCoords","x2","max","FocusRect","Grid","HeightFocusLine","xCoord","yCoord","HeightFocusLabel","y","select","node","selectAll","HeightFocusPoint","circle","LegendItem","toLowerCase","margins","MouseFocusLine","MouseFocusLabel","bbox","getBBox","xAlign","yAlign","Browser","webkit","Infinity","Scale","domain","extent","hasOwnProperty","forceBounds","scaleLinear","range","create","Elevation","Control","includes","Evented","prototype","Mixin","Events","autohide","mobile","autohideMarker","collapsed","controlButton","iconCssClass","title","detached","distanceFactor","dragging","downloadLink","elevationDiv","followMarker","forceAxisBounds","async","startIconUrl","endIconUrl","shadowUrl","divIcon","html","iconSize","iconAnchor","heightFactor","hoverNumber","decimalsX","decimalsY","_.formatter","imperial","lazyLoadJS","legend","loadData","defer","markerIcon","placeholder","color","opacity","weight","lineCap","reverseCoords","skipNullZCoords","responsive","summary","xLabel","xTicks","undefined","yAxisMax","yAxisMin","yLabel","yTicks","zFollow","__mileFactor","__footFactor","_d3LazyLoader","_.lazyLoader","then","_addData","_addLayer","addTo","map","_appendElevationDiv","_container","onAdd","clear","_clearPath","_clearChart","_clearData","disableDragging","_draggingEnabled","_resetDrag","enableDragging","fitBounds","bounds","_fullExtent","_map","getZFollow","_zFollow","hide","initialize","_.deepMerge","_distanceFactor","_heightFactor","_xLabel","_yLabel","_chartEnabled","_setMapView","throttle","load","opts","loadChart","loadDefer","loadLazy","_.isXMLDoc","loadGPX","_.isJSONDoc","loadGeoJSON","_.deferFunc","bind","_.loadFile","_downloadURL","catch","_.GeoJSONLoader","_gpxLazyLoader","_.GPXLoader","parentNode","_.waitHolder","container","DomUtil","addClass","_data","alt","i","setAttribute","insertBefore","firstChild","getPane","pane","createPane","zIndex","_initToggle","_initChart","_hidePositionMarker","_resetView","_resizeChart","DomEvent","_updateChart","_updateSummary","onRemove","off","redraw","setZFollow","zoom","show","geom","feat","gpx","_latlngs","_addGeoJSONData","coordinates","forEach","coords","features","_addGPXdata","_addPoint","lat","lng","meta","ele","z","eleMax","_maxElevation","eleMin","_minElevation","dist","_distance","curr","LatLng","prev","delta","distanceTo","round","prevZ","isNaN","lastZ","_lastValidZ","currZ","splice","push","distance","elevation_max","elevation_min","index","_path","_mousemoveLayerHandler","_mouseoutHandler","_layers","stamp","_appendChart","svg","_appendGrid","_appendAxis","_appendAreaPath","_appendFocusable","_appendLegend","eleDiv","querySelector","random","substr","id","nextSibling","removeClass","_appendSummary","summaryDiv","_appendXaxis","D3.Axis","_width","_height","_x","_xTicks","_appendXGrid","D3.Grid","_appendYaxis","_y","_appendYGrid","_appendFocusRect","_appendMouseFocusG","focusRect","D3.FocusRect","_dragHandler","_dragStartHandler","_mousemoveHandler","_dragEndHandler","_mouseenterHandler","focusG","_focusG","_focusline","D3.MouseFocusLine","_focuslabel","D3.MouseFocusLabel","_legend","items","nodes","getAttribute","_area","_calculateFullExtent","Error","ext","latLngBounds","_collapse","event","preventDefault","stopPropagation","_gotDragged","_drawDragRectangle","_dragStartCoords","_dragCurrentCoords","item1","_findItemForX","item2","_fitSection","dragstart","dragend","mouse","_focusRect","_dragRectangle","_focus","insert","D3.DragRectangle","_expand","_findItemForLatLng","result","bisect","bisector","invert","propagate","index1","index2","start","end","slice","_selectedItem","_marker","remove","_heightG","classed","_pointG","offWi","offHe","_maxWidth","containerWidth","clientWidth","_updateScale","_svg","_grid","_axis","disableClickPropagation","_mousewheelHandler","link","_button","stop","_toggle","ctx","_showDiagramIndicator","_showPositionMarker","gestureHandling","_enabled","ll","getCenter","deltaY","getZoom","flyTo","_isFullscreen","newWidth","innerHTML","removeControl","xCoordinate","fx","fy","yCoordinate","hasClass","setView","animate","duration","_updatePositionMarker","_updateLeafletMarker","_updateAxis","_updateAreaPath","D3.Area","setLatLng","zIndexOffset","latLngToLayerPoint","normalizedAlt","normalizedY","renderer","_mouseHeightFocus","_mouseHeightFocusLabel","D3.HeightFocusPoint","D3.HeightFocusLine","D3.HeightFocusLabel","D3.Scale","xAxisMin","xAxisMax","onclick","confirm","_.saveFile","addInitHook","p","pop","_popup","_content","decodeURI","bindTooltip","direction","sticky","openTooltip","enabled","setClass","_altitudeLegend","D3.LegendItem","toFixed","CustomEvent","dispatchEvent","detail","getBounds","slope","tAsc","_tAsc","tDes","_tDes","sMax","_sMax","sMin","_sMin","diff","ascent","descent","slope_max","slope_min","_focuslabelSlope","property","_mouseSlopeFocusLabel","insertAdjacentHTML","Utils","Components","D3","elevation"],"mappings":"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"}