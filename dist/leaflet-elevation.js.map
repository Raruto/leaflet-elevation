{"version":3,"file":"leaflet-elevation.js","sources":["../node_modules/leaflet-i18n/Leaflet.i18n.js","../src/utils.js","../src/components.js","../src/chart.js","../src/marker.js","../src/summary.js","../src/options.js","../src/control.js","../src/altitude.js","../src/slope.js","../src/index.js"],"sourcesContent":["// Following https://github.com/Leaflet/Leaflet/blob/master/PLUGIN-GUIDE.md\n(function (factory, window) {\n\n    // define an AMD module that relies on 'leaflet'\n    if (typeof define === 'function' && define.amd) {\n        define(['leaflet'], factory);\n\n        // define a Common JS module that relies on 'leaflet'\n    } else if (typeof exports === 'object') {\n        module.exports = factory(require('leaflet'));\n    }\n\n    // attach your plugin to the global 'L' variable\n    if (typeof window !== 'undefined' && window.L) {\n        factory(window.L);\n\n    }\n}(function (L) {\n    L.locales = {};\n    L.locale = null;\n    L.registerLocale = function registerLocale(code, locale) {\n        L.locales[code] = L.Util.extend({}, L.locales[code], locale);\n    };\n    L.setLocale = function setLocale(code) {\n        L.locale = code;\n    };\n    return L.i18n = L._ = function translate(string, data) {\n        if (L.locale && L.locales[L.locale] && L.locales[L.locale][string]) {\n            string = L.locales[L.locale][string];\n        }\n        try {\n            // Do not fail if some data is missing\n            // a bad translation should not break the app\n            string = L.Util.template(string, data);\n        }\n        catch (err) {/*pass*/\n        }\n\n        return string;\n    };\n}, window));\n","/**\r\n * Recursive deep merge objects.\r\n * Alternative to L.Util.setOptions(this, options).\r\n */\r\nexport function deepMerge(target, ...sources) {\r\n\tif (!sources.length) return target;\r\n\tconst source = sources.shift();\r\n\tif (isObject(target) && isObject(source)) {\r\n\t\tfor (const key in source) {\r\n\t\t\tif (isObject(source[key])) {\r\n\t\t\t\tif (!target[key]) Object.assign(target, {\r\n\t\t\t\t\t[key]: {}\r\n\t\t\t\t});\r\n\t\t\t\tdeepMerge(target[key], source[key]);\r\n\t\t\t} else {\r\n\t\t\t\tObject.assign(target, {\r\n\t\t\t\t\t[key]: source[key]\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn deepMerge(target, ...sources);\r\n}\r\n\r\n/**\r\n * Wait for document load before execute function.\r\n */\r\nexport function deferFunc(f) {\r\n\tif (document.readyState !== 'complete') window.addEventListener(\"load\", f, { once: true });\r\n\telse f();\r\n}\r\n\r\n/*\r\n * Formatting funciton using the given decimals and seperator.\r\n */\r\nexport function formatter(num, dec, sep) {\r\n\tlet res = L.Util.formatNum(num, dec).toString();\r\n\tlet numbers = res.split(\".\");\r\n\tif (numbers[1]) {\r\n\t\tfor (let d = dec - numbers[1].length; d > 0; d--) {\r\n\t\t\tnumbers[1] += \"0\";\r\n\t\t}\r\n\t\tres = numbers.join(sep || \".\");\r\n\t}\r\n\treturn res;\r\n}\r\n\r\n/**\r\n * Simple GeoJSON data loader.\r\n */\r\nexport function GeoJSONLoader(data, control) {\r\n\tif (typeof data === \"string\") {\r\n\t\tdata = JSON.parse(data);\r\n\t}\r\n\tcontrol = control || this;\r\n\r\n\tlet layer = L.geoJson(data, {\r\n\t\tstyle: (feature) => {\r\n\t\t\tlet style = L.extend({}, control.options.polyline);\r\n\t\t\tif (control.options.theme) {\r\n\t\t\t\tstyle.className += ' ' + control.options.theme;\r\n\t\t\t}\r\n\t\t\treturn style;\r\n\t\t},\r\n\t\tpointToLayer: (feature, latlng) => {\r\n\t\t\tlet marker = L.marker(latlng, { icon: control.options.gpxOptions.marker_options.wptIcons[''] });\r\n\t\t\tlet desc = feature.properties.desc ? feature.properties.desc : '';\r\n\t\t\tlet name = feature.properties.name ? feature.properties.name : '';\r\n\t\t\tif (name || desc) {\r\n\t\t\t\tmarker.bindPopup(\"<b>\" + name + \"</b>\" + (desc.length > 0 ? '<br>' + desc : '')).openPopup();\r\n\t\t\t}\r\n\t\t\tcontrol.fire('waypoint_added', { point: marker, point_type: 'waypoint', element: latlng });\r\n\t\t\treturn marker;\r\n\t\t},\r\n\t\tonEachFeature: (feature, layer) => {\r\n\t\t\tif (feature.geometry.type == 'Point') return;\r\n\r\n\t\t\tcontrol.addData(feature, layer);\r\n\r\n\t\t\tcontrol.track_info = L.extend({}, control.track_info, { type: \"geojson\", name: data.name });\r\n\t\t},\r\n\t});\r\n\r\n\tL.Control.Elevation._d3LazyLoader.then(() => {\r\n\t\tcontrol._fireEvt(\"eledata_loaded\", { data: data, layer: layer, name: control.track_info.name, track_info: control.track_info })\r\n\t});\r\n\r\n\treturn layer;\r\n}\r\n\r\n/**\r\n * Simple GPX data loader.\r\n */\r\nexport function GPXLoader(data, control) {\r\n\tcontrol = control || this;\r\n\r\n\tcontrol.options.gpxOptions.polyline_options = L.extend({}, control.options.polyline, control.options.gpxOptions.polyline_options);\r\n\r\n\tif (control.options.theme) {\r\n\t\tcontrol.options.gpxOptions.polyline_options.className += ' ' + control.options.theme;\r\n\t}\r\n\r\n\tlet layer = new L.GPX(data, control.options.gpxOptions);\r\n\r\n\t// similar to L.GeoJSON.pointToLayer\r\n\tlayer.on('addpoint', (e) => {\r\n\t\tcontrol.fire(\"waypoint_added\", e);\r\n\t});\r\n\r\n\t// similar to L.GeoJSON.onEachFeature\r\n\tlayer.on(\"addline\", (e) => {\r\n\t\tcontrol.addData(e.line /*, layer*/ );\r\n\t\tcontrol.track_info = L.extend({}, control.track_info, { type: \"gpx\", name: layer.get_name() });\r\n\t});\r\n\r\n\t// unlike the L.GeoJSON, L.GPX parsing is async\r\n\tlayer.once('loaded', (e) => {\r\n\t\tL.Control.Elevation._d3LazyLoader.then(() => {\r\n\t\t\tcontrol._fireEvt(\"eledata_loaded\", { data: data, layer: layer, name: control.track_info.name, track_info: control.track_info });\r\n\t\t});\r\n\t});\r\n\r\n\treturn layer;\r\n}\r\n\r\n/**\r\n * Check DOM element visibility.\r\n */\r\nexport function isDomVisible(elem) {\r\n\treturn !!(elem.offsetWidth || elem.offsetHeight || elem.getClientRects().length);\r\n}\r\n\r\n/**\r\n * Check object type.\r\n */\r\nexport function isObject(item) {\r\n\treturn (item && typeof item === 'object' && !Array.isArray(item));\r\n}\r\n\r\n/**\r\n * Check DOM element viewport visibility.\r\n */\r\nexport function isVisible(elem) {\r\n\tif (!elem) return false;\r\n\r\n\tlet styles = window.getComputedStyle(elem);\r\n\r\n\tfunction isVisibleByStyles(elem, styles) {\r\n\t\treturn styles.visibility !== 'hidden' && styles.display !== 'none';\r\n\t}\r\n\r\n\tfunction isAboveOtherElements(elem, styles) {\r\n\t\tlet boundingRect = elem.getBoundingClientRect();\r\n\t\tlet left = boundingRect.left + 1;\r\n\t\tlet right = boundingRect.right - 1;\r\n\t\tlet top = boundingRect.top + 1;\r\n\t\tlet bottom = boundingRect.bottom - 1;\r\n\t\tlet above = true;\r\n\r\n\t\tlet pointerEvents = elem.style.pointerEvents;\r\n\r\n\t\tif (styles['pointer-events'] == 'none') elem.style.pointerEvents = 'auto';\r\n\r\n\t\tif (document.elementFromPoint(left, top) !== elem) above = false;\r\n\t\tif (document.elementFromPoint(right, top) !== elem) above = false;\r\n\r\n\t\t// Only for completely visible elements\r\n\t\t// if (document.elementFromPoint(left, bottom) !== elem) above = false;\r\n\t\t// if (document.elementFromPoint(right, bottom) !== elem) above = false;\r\n\r\n\t\telem.style.pointerEvents = pointerEvents;\r\n\r\n\t\treturn above;\r\n\t}\r\n\r\n\tif (!isVisibleByStyles(elem, styles)) return false;\r\n\tif (!isAboveOtherElements(elem, styles)) return false;\r\n\treturn true;\r\n}\r\n\r\n/**\r\n * Check JSON object type.\r\n */\r\nexport function isJSONDoc(doc, lazy) {\r\n\tlazy = typeof lazy === \"undefined\" ? true : lazy;\r\n\tif (typeof doc === \"string\" && lazy) {\r\n\t\tdoc = doc.trim();\r\n\t\treturn doc.indexOf(\"{\") == 0 || doc.indexOf(\"[\") == 0;\r\n\t} else {\r\n\t\ttry {\r\n\t\t\tJSON.parse(doc.toString());\r\n\t\t} catch (e) {\r\n\t\t\tif (typeof doc === \"object\" && lazy) return true;\r\n\t\t\tconsole.warn(e);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\n/**\r\n * Check XML object type.\r\n */\r\nexport function isXMLDoc(doc, lazy) {\r\n\tlazy = typeof lazy === \"undefined\" ? true : lazy;\r\n\tif (typeof doc === \"string\" && lazy) {\r\n\t\tdoc = doc.trim();\r\n\t\treturn doc.indexOf(\"<\") == 0;\r\n\t} else {\r\n\t\tlet documentElement = (doc ? doc.ownerDocument || doc : 0).documentElement;\r\n\t\treturn documentElement ? documentElement.nodeName !== \"HTML\" : false;\r\n\t}\r\n}\r\n\r\n/**\r\n * Async JS script download.\r\n */\r\nexport function lazyLoader(url, skip, loader) {\r\n\tif (skip === false) {\r\n\t\treturn Promise.resolve();\r\n\t}\r\n\tif (loader instanceof Promise) {\r\n\t\treturn loader;\r\n\t}\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tlet tag = document.createElement(\"script\");\r\n\t\ttag.addEventListener('load', resolve, { once: true });\r\n\t\ttag.src = url;\r\n\t\tdocument.head.appendChild(tag);\r\n\t});\r\n}\r\n\r\n/**\r\n * Download data from a remote url.\r\n */\r\nexport function loadFile(url, success) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tlet xhr = new XMLHttpRequest();\r\n\t\txhr.responseType = \"text\";\r\n\t\txhr.open('GET', url);\r\n\t\txhr.onload = () => resolve(xhr.response);\r\n\t\txhr.onerror = () => reject(\"Error \" + xhr.status + \" while fetching remote file: \" + url);\r\n\t\txhr.send();\r\n\t});\r\n}\r\n\r\n/**\r\n * Generate download data event.\r\n */\r\nexport function saveFile(dataURI, fileName) {\r\n\tlet a = create('a', '', { href: dataURI, target: '_new', download: fileName || \"\", style: \"display:none;\" });\r\n\tlet b = document.body;\r\n\tb.appendChild(a);\r\n\ta.click();\r\n\tb.removeChild(a);\r\n}\r\n\r\n/**\r\n * Wait for element visible before execute function.\r\n */\r\nexport function waitHolder(elem) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tlet ticking = false;\r\n\t\tlet scrollFn = () => {\r\n\t\t\tif (!ticking) {\r\n\t\t\t\tL.Util.requestAnimFrame(() => {\r\n\t\t\t\t\tif (isVisible(elem)) {\r\n\t\t\t\t\t\twindow.removeEventListener('scroll', scrollFn);\r\n\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tticking = false;\r\n\t\t\t\t});\r\n\t\t\t\tticking = true;\r\n\t\t\t}\r\n\t\t};\r\n\t\twindow.addEventListener('scroll', scrollFn);\r\n\t\tif (elem) elem.addEventListener('mouseenter', scrollFn, { once: true });\r\n\t\tscrollFn();\r\n\t});\r\n}\r\n\r\n/**\r\n * A little bit safier than L.DomUtil.addClass\r\n */\r\nexport function addClass(targetNode, className) {\r\n\teach(className.split(\" \"), s => { if (targetNode && className) L.DomUtil.addClass(targetNode, s); });\r\n}\r\n\r\n/**\r\n * A little bit safier than L.DomUtil.removeClass()\r\n */\r\nexport function removeClass(targetNode, className) {\r\n\teach(className.split(\" \"), s => { if (targetNode && className) L.DomUtil.removeClass(targetNode, s); });\r\n}\r\n\r\nexport function style(targetNode, name, value) {\r\n\tif (typeof value === \"undefined\") return L.DomUtil.getStyle(targetNode, name);\r\n\telse return targetNode.style.setProperty(name, value);\r\n}\r\n\r\n/**\r\n * A little bit shorter than L.DomUtil.create()\r\n */\r\nexport function create(tagName, className, attributes, parent) {\r\n\tlet elem = L.DomUtil.create(tagName, className || \"\");\r\n\tif (attributes) setAttributes(elem, attributes);\r\n\tif (parent) append(parent, elem);\r\n\treturn elem;\r\n}\r\n\r\n/**\r\n * Same as node.appendChild()\r\n */\r\nexport function append(parent, child) {\r\n\treturn parent.appendChild(child);\r\n}\r\n\r\n/**\r\n * Same as node.insertAdjacentElement()\r\n */\r\nexport function insert(parent, child, position) {\r\n\treturn parent.insertAdjacentElement(position, child);\r\n}\r\n\r\n/**\r\n * Loop for node.setAttribute()\r\n */\r\nexport function setAttributes(elem, attrs) {\r\n\tfor (let k in attrs) { elem.setAttribute(k, attrs[k]); }\r\n}\r\n\r\n/**\r\n * Same as node.querySelector().\r\n */\r\nexport function select(selector, context) {\r\n\treturn (context || document).querySelector(selector);\r\n}\r\n\r\n/**\r\n * Alias for L.DomEvent.on.\r\n */\r\nexport const on = L.DomEvent.on;\r\n\r\n/**\r\n * Alias for L.DomEvent.off.\r\n */\r\nexport const off = L.DomEvent.off;\r\n\r\n/**\r\n * Alias for L.DomUtil.hasClass.\r\n */\r\nexport const hasClass = L.DomUtil.hasClass;\r\n\r\n\r\nexport function randomId() {\r\n\treturn Math.random().toString(36).substr(2, 9);\r\n}\r\n\r\nexport function each(obj, fn) {\r\n\tfor (let i in obj) fn(obj[i], i);\r\n}\r\n","export const Area = ({\r\n\tdata,\r\n\tname,\r\n\txAttr,\r\n\tyAttr,\r\n\tscaleX,\r\n\tscaleY,\r\n\theight,\r\n\tinterpolation = \"curveLinear\",\r\n}) => {\r\n\treturn path => {\r\n\t\tif (typeof interpolation === 'string') interpolation = d3[interpolation];\r\n\r\n\t\tlet area = d3.area().curve(interpolation)\r\n\t\t\t.x(d => (d.xDiagCoord = scaleX(d[xAttr])))\r\n\t\t\t.y0(height)\r\n\t\t\t.y1(d => scaleY(d[yAttr]));\r\n\r\n\t\tif (data) path.datum(data).attr(\"d\", area);\r\n\t\tif (name) path.attr('data-name', name);\r\n\r\n\t\treturn area;\r\n\t};\r\n};\r\n\r\nexport const AreaPath = (props) => {\r\n\treturn d3.create('svg:path')\r\n\t\t.attr(\"class\", \"area\")\r\n\t\t.call(Area(props));\r\n};\r\n\r\nexport const Axis = ({\r\n\ttype = \"axis\",\r\n\ttickSize = 6,\r\n\ttickPadding = 3,\r\n\tposition,\r\n\theight,\r\n\twidth,\r\n\taxis,\r\n\tscale,\r\n\tticks,\r\n\ttickFormat,\r\n\tlabel,\r\n\tlabelX,\r\n\tlabelY\r\n}) => {\r\n\treturn g => {\r\n\t\tlet [w, h] = [0, 0];\r\n\t\tif (position == \"bottom\") h = height;\r\n\t\tif (position == \"right\") w = width;\r\n\r\n\t\tif (axis == \"x\" && type == \"grid\") {\r\n\t\t\ttickSize = -height;\r\n\t\t} else if (axis == \"y\" && type == \"grid\") {\r\n\t\t\ttickSize = -width;\r\n\t\t}\r\n\r\n\t\tlet axisScale = d3[\"axis\" + position.replace(/\\b\\w/g, l => l.toUpperCase())]()\r\n\t\t\t.scale(scale)\r\n\t\t\t.ticks(ticks)\r\n\t\t\t.tickPadding(tickPadding)\r\n\t\t\t.tickSize(tickSize)\r\n\t\t\t.tickFormat(tickFormat);\r\n\r\n\t\tlet axisGroup = g.append(\"g\")\r\n\t\t\t.attr(\"class\", [axis, type, position].join(\" \"))\r\n\t\t\t.attr(\"transform\", \"translate(\" + w + \",\" + h + \")\")\r\n\t\t\t.call(axisScale);\r\n\r\n\t\tif (label) {\r\n\t\t\taxisGroup.append(\"text\")\r\n\t\t\t\t.attr(\"x\", labelX)\r\n\t\t\t\t.attr(\"y\", labelY)\r\n\t\t\t\t.text(label);\r\n\t\t}\r\n\r\n\t\treturn axisGroup;\r\n\t};\r\n};\r\n\r\nexport const DragRectangle = ({\r\n\tdragStartCoords,\r\n\tdragEndCoords,\r\n\theight,\r\n}) => {\r\n\treturn rect => {\r\n\t\tlet x1 = Math.min(dragStartCoords[0], dragEndCoords[0]);\r\n\t\tlet x2 = Math.max(dragStartCoords[0], dragEndCoords[0]);\r\n\r\n\t\treturn rect\r\n\t\t\t.attr(\"width\", x2 - x1)\r\n\t\t\t.attr(\"height\", height)\r\n\t\t\t.attr(\"x\", x1);\r\n\t};\r\n};\r\n\r\nexport const FocusRect = ({\r\n\twidth,\r\n\theight,\r\n}) => {\r\n\treturn rect => rect\r\n\t\t.attr(\"width\", width)\r\n\t\t.attr(\"height\", height)\r\n\t\t.style(\"fill\", \"none\")\r\n\t\t.style(\"stroke\", \"none\")\r\n\t\t.style(\"pointer-events\", \"all\");\r\n};\r\n\r\nexport const Grid = (props) => {\r\n\tprops.type = \"grid\";\r\n\treturn Axis(props);\r\n};\r\n\r\nexport const HeightFocusLine = ({\r\n\ttheme,\r\n\txCoord = 0,\r\n\tyCoord = 0,\r\n\tlength = 0,\r\n}) => {\r\n\treturn line => line\r\n\t\t.attr(\"class\", theme + \" height-focus line\")\r\n\t\t.attr(\"x1\", xCoord)\r\n\t\t.attr(\"x2\", xCoord)\r\n\t\t.attr(\"y1\", yCoord)\r\n\t\t.attr(\"y2\", length);\r\n};\r\n\r\nexport const HeightFocusLabel = ({\r\n\ttheme,\r\n\txCoord = 0,\r\n\tyCoord = 0,\r\n\tlabel,\r\n}) => {\r\n\treturn text => {\r\n\t\ttext\r\n\t\t\t.attr(\"class\", theme + \" height-focus-label\")\r\n\t\t\t.style(\"pointer-events\", \"none\")\r\n\t\t\t.attr(\"x\", xCoord + 5)\r\n\t\t\t.attr(\"y\", yCoord);\r\n\r\n\t\tlet y = text.select(\".height-focus-y\");\r\n\t\tif (!y.node()) y = text.append(\"svg:tspan\");\r\n\r\n\t\ty\r\n\t\t\t.attr(\"class\", \"height-focus-y\")\r\n\t\t\t.text(label);\r\n\r\n\t\ttext.selectAll('tspan').attr(\"x\", xCoord + 5);\r\n\r\n\t\treturn text;\r\n\t};\r\n};\r\n\r\nexport const HeightFocusPoint = ({\r\n\ttheme,\r\n\txCoord = 0,\r\n\tyCoord = 0,\r\n}) => {\r\n\treturn circle => circle\r\n\t\t.attr(\"class\", theme + \" height-focus circle-lower\")\r\n\t\t.attr(\"transform\", \"translate(\" + xCoord + \",\" + yCoord + \")\")\r\n\t\t.attr(\"r\", 6)\r\n\t\t.attr(\"cx\", 0)\r\n\t\t.attr(\"cy\", 0);\r\n};\r\n\r\n\r\nexport const LegendItem = ({\r\n\tname,\r\n\twidth,\r\n\theight,\r\n\tmargins = {},\r\n}) => {\r\n\treturn g => {\r\n\t\tg\r\n\t\t\t.attr(\"class\", \"legend-item legend-\" + name.toLowerCase())\r\n\t\t\t.attr(\"data-name\", name);\r\n\r\n\t\tg.append(\"rect\")\r\n\t\t\t.attr(\"class\", \"area\")\r\n\t\t\t.attr(\"x\", (width / 2) - 50)\r\n\t\t\t.attr(\"y\", height + margins.bottom / 2)\r\n\t\t\t.attr(\"width\", 50)\r\n\t\t\t.attr(\"height\", 10)\r\n\t\t\t.attr(\"opacity\", 0.75);\r\n\r\n\t\tg.append('text')\r\n\t\t\t.text(L._(name))\r\n\t\t\t.attr(\"x\", (width / 2) + 5)\r\n\t\t\t.attr(\"font-size\", 10)\r\n\t\t\t.style(\"text-decoration-thickness\", \"2px\")\r\n\t\t\t.style(\"font-weight\", \"700\")\r\n\t\t\t.attr('y', height + margins.bottom / 2)\r\n\t\t\t.attr('dy', \"0.75em\");\r\n\r\n\t\treturn g;\r\n\t}\r\n};\r\n\r\nexport const MouseFocusLine = ({\r\n\txCoord = 0,\r\n\theight,\r\n}) => {\r\n\treturn line => line\r\n\t\t.attr('class', 'mouse-focus-line')\r\n\t\t.attr('x2', xCoord)\r\n\t\t.attr('y2', 0)\r\n\t\t.attr('x1', xCoord)\r\n\t\t.attr('y1', height);\r\n};\r\n\r\nexport const MouseFocusLabel = ({\r\n\txCoord,\r\n\tyCoord,\r\n\tlabelX = \"\",\r\n\tlabelY = \"\",\r\n\twidth,\r\n}) => {\r\n\treturn g => {\r\n\r\n\t\tg.attr('class', 'mouse-focus-label');\r\n\r\n\t\tlet rect = g.select(\".mouse-focus-label-rect\");\r\n\t\tlet text = g.select(\".mouse-focus-label-text\");\r\n\t\tlet y = text.select(\".mouse-focus-label-y\");\r\n\t\tlet x = text.select(\".mouse-focus-label-x\");\r\n\r\n\t\tif (!rect.node()) rect = g.append(\"rect\");\r\n\t\tif (!text.node()) text = g.append(\"svg:text\");\r\n\t\tif (!y.node()) y = text.append(\"svg:tspan\");\r\n\t\tif (!x.node()) x = text.append(\"svg:tspan\");\r\n\r\n\t\ty.text(labelY);\r\n\t\tx.text(labelX);\r\n\r\n\t\t// Sets focus-label-text position to the left / right of the mouse-focus-line\r\n\t\tlet xAlign = 0;\r\n\t\tlet yAlign = 0;\r\n\t\tlet bbox = { width: 0, height: 0 };\r\n\t\ttry { bbox = text.node().getBBox(); } catch (e) { return g; }\r\n\r\n\t\tif (xCoord) xAlign = xCoord + (xCoord < width / 2 ? 10 : -bbox.width - 10);\r\n\t\tif (yCoord) yAlign = Math.max(yCoord - bbox.height, L.Browser.webkit ? 0 : -Infinity);\r\n\r\n\t\trect\r\n\t\t\t.attr(\"class\", \"mouse-focus-label-rect\")\r\n\t\t\t.attr(\"x\", xAlign - 5)\r\n\t\t\t.attr(\"y\", yAlign - 5)\r\n\t\t\t.attr(\"width\", bbox.width + 10)\r\n\t\t\t.attr(\"height\", bbox.height + 10)\r\n\t\t\t.attr(\"rx\", 3)\r\n\t\t\t.attr(\"ry\", 3);\r\n\t\ttext\r\n\t\t\t.attr(\"class\", \"mouse-focus-label-text\")\r\n\t\t\t.style(\"font-weight\", \"700\")\r\n\t\t\t.attr(\"y\", yAlign);\r\n\t\ty\r\n\t\t\t.attr(\"class\", \"mouse-focus-label-y\")\r\n\t\t\t.attr(\"dy\", \"1em\");\r\n\t\tx\r\n\t\t\t.attr(\"class\", \"mouse-focus-label-x\")\r\n\t\t\t.attr(\"dy\", \"2em\");\r\n\r\n\t\ttext.selectAll('tspan').attr(\"x\", xAlign);\r\n\r\n\t\treturn g;\r\n\t};\r\n};\r\n\r\nexport const Scale = ({\r\n\tdata,\r\n\tattr,\r\n\tmin,\r\n\tforceBounds,\r\n\trange,\r\n}) => {\r\n\tlet domain = data ? d3.extent(data, d => d[attr]) : [0, 1];\r\n\tif (typeof min !== \"undefined\" && (min < domain[0] || forceBounds)) {\r\n\t\tdomain[0] = min;\r\n\t}\r\n\tif (typeof max !== \"undefined\" && (max > domain[1] || forceBounds)) {\r\n\t\tdomain[1] = max;\r\n\t}\r\n\treturn d3.scaleLinear()\r\n\t\t.range(range)\r\n\t\t.domain(domain);\r\n};\r\n\r\nexport const Bisect = ({\r\n\tdata = [0, 1],\r\n\tscale,\r\n\tx,\r\n\tattr\r\n}) => {\r\n\treturn d3\r\n\t\t.bisector(d => d[attr])\r\n\t\t.left(data, scale.invert(x));\r\n};\r\n","import 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\n\r\nexport var Chart = L.Class.extend({\r\n\r\n\tincludes: L.Evented ? L.Evented.prototype : L.Mixin.Events,\r\n\r\n\tinitialize: function(options) {\r\n\t\tlet opts = this.options = options;\r\n\r\n\t\tthis._data = [];\r\n\t\tthis._draggingEnabled = opts.dragging;\r\n\r\n\t\tif (this.options.imperial) {\r\n\t\t\t// this._distanceFactor = this.__mileFactor;\r\n\t\t\t// this._heightFactor = this.__footFactor;\r\n\t\t\tthis._xLabel = \"mi\";\r\n\t\t\tthis._yLabel = \"ft\";\r\n\t\t} else {\r\n\t\t\t// this._distanceFactor = this.options.distanceFactor;\r\n\t\t\t// this._heightFactor = this.options.heightFactor;\r\n\t\t\tthis._xLabel = this.options.xLabel;\r\n\t\t\tthis._yLabel = this.options.yLabel;\r\n\t\t}\r\n\r\n\t\tthis._xTicks = opts.xTicks;\r\n\t\tthis._yTicks = opts.yTicks;\r\n\r\n\t\tlet scale = this._updateScale();\r\n\r\n\t\tlet svg = this._svg = d3.create(\"svg\")\r\n\t\t\t.attr(\"class\", \"background\")\r\n\t\t\t.attr(\"width\", opts.width)\r\n\t\t\t.attr(\"height\", opts.height);\r\n\r\n\t\tlet g = svg\r\n\t\t\t.append(\"g\")\r\n\t\t\t.attr(\"transform\", \"translate(\" + opts.margins.left + \",\" + opts.margins.top + \")\")\r\n\t\t\t.call(this._appendGrid())\r\n\t\t\t.call(this._appendAxis())\r\n\t\t\t.call(this._appendAreaPath())\r\n\t\t\t.call(this._appendFocusable())\r\n\t\t\t.call(this._appendLegend());\r\n\r\n\t\tthis._grid = svg.select('.grid');\r\n\t\tthis._area = svg.select('.area');\r\n\t\tthis._path = svg.select('.area path');\r\n\t\tthis._axis = svg.select('.axis');\r\n\t\tthis._focus = svg.select('.focus');\r\n\t\tthis._focusRect = this._focus.select('rect');\r\n\t\tthis._legend = svg.select('.legend');\r\n\t\tthis._x = scale.x;\r\n\t\tthis._y = scale.y;\r\n\r\n\t},\r\n\r\n\tupdate: function(props) {\r\n\t\tif (props.data) this._data = props.data;\r\n\t\tif (props.options) this.options = props.options;\r\n\r\n\t\tthis._updateScale();\r\n\t\tthis._updateAxis();\r\n\t\tthis._updateAreaPath();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\trender: function() {\r\n\t\treturn container => container.append(() => this._svg.node());\r\n\t},\r\n\r\n\t_updateScale: function() {\r\n\t\tlet opts = this.options;\r\n\r\n\t\tthis._x = D3.Scale({\r\n\t\t\tdata: this._data,\r\n\t\t\trange: [0, this._width()],\r\n\t\t\tattr: opts.xAttr,\r\n\t\t\tmin: opts.xAxisMin,\r\n\t\t\tmax: opts.xAxisMax,\r\n\t\t\tforceBounds: opts.forceAxisBounds,\r\n\t\t});\r\n\r\n\t\tthis._y = D3.Scale({\r\n\t\t\tdata: this._data,\r\n\t\t\trange: [this._height(), 0],\r\n\t\t\tattr: opts.yAttr,\r\n\t\t\tmin: opts.yAxisMin,\r\n\t\t\tmax: opts.yAxisMax,\r\n\t\t\tforceBounds: opts.forceAxisBounds,\r\n\t\t});\r\n\r\n\t\treturn { x: this._x, y: this._y };\r\n\t},\r\n\r\n\t/**\r\n\t * Update chart axis.\r\n\t */\r\n\t_updateAxis: function() {\r\n\t\tthis._grid.selectAll('g').remove();\r\n\t\tthis._axis.selectAll('g').remove();\r\n\t\tthis._grid\r\n\t\t\t.call(this._appendXGrid())\r\n\t\t\t.call(this._appendYGrid());\r\n\t\tthis._axis\r\n\t\t\t.call(this._appendXaxis())\r\n\t\t\t.call(this._appendYaxis());\r\n\r\n\t\t// this.fire('axis_updated');\r\n\t},\r\n\r\n\t_updateAreaPath: function() {\r\n\t\tlet opts = this.options;\r\n\t\tthis._path\r\n\t\t\t.call(\r\n\t\t\t\tD3.Area({\r\n\t\t\t\t\tinterpolation: opts.interpolation,\r\n\t\t\t\t\tdata: this._data,\r\n\t\t\t\t\tname: 'Altitude',\r\n\t\t\t\t\txAttr: opts.xAttr,\r\n\t\t\t\t\tyAttr: opts.yAttr,\r\n\t\t\t\t\twidth: this._width(),\r\n\t\t\t\t\theight: this._height(),\r\n\t\t\t\t\tscaleX: this._x,\r\n\t\t\t\t\tscaleY: this._y,\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"grid\".\r\n\t */\r\n\t_appendGrid: function() {\r\n\t\treturn g =>\r\n\t\t\tg.append(\"g\")\r\n\t\t\t.attr(\"class\", \"grid\")\r\n\t\t\t.call(this._appendXGrid())\r\n\t\t\t.call(this._appendYGrid());\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"x-grid\".\r\n\t */\r\n\t_appendXGrid: function() {\r\n\t\treturn D3.Grid({\r\n\t\t\taxis: \"x\",\r\n\t\t\tposition: \"bottom\",\r\n\t\t\twidth: this._width(),\r\n\t\t\theight: this._height(),\r\n\t\t\tscale: this._x,\r\n\t\t\tticks: this._xTicks,\r\n\t\t\ttickFormat: \"\",\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"y-grid\".\r\n\t */\r\n\t_appendYGrid: function() {\r\n\t\treturn D3.Grid({\r\n\t\t\taxis: \"y\",\r\n\t\t\tposition: \"left\",\r\n\t\t\twidth: this._width(),\r\n\t\t\theight: this._height(),\r\n\t\t\tscale: this._y,\r\n\t\t\tticks: this.options.yTicks,\r\n\t\t\ttickFormat: \"\",\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"axis\".\r\n\t */\r\n\t_appendAxis: function() {\r\n\t\treturn g =>\r\n\t\t\tg.append(\"g\")\r\n\t\t\t.attr(\"class\", \"axis\")\r\n\t\t\t.call(this._appendXaxis())\r\n\t\t\t.call(this._appendYaxis());\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"x-axis\".\r\n\t */\r\n\t_appendXaxis: function() {\r\n\t\treturn D3.Axis({\r\n\t\t\taxis: \"x\",\r\n\t\t\tposition: \"bottom\",\r\n\t\t\twidth: this._width(),\r\n\t\t\theight: this._height(),\r\n\t\t\tscale: this._x,\r\n\t\t\tticks: this._xTicks,\r\n\t\t\tlabel: this._xLabel,\r\n\t\t\tlabelY: 25,\r\n\t\t\tlabelX: this._width() + 6,\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"y-axis\".\r\n\t */\r\n\t_appendYaxis: function() {\r\n\t\treturn D3.Axis({\r\n\t\t\taxis: \"y\",\r\n\t\t\tposition: \"left\",\r\n\t\t\twidth: this._width(),\r\n\t\t\theight: this._height(),\r\n\t\t\tscale: this._y,\r\n\t\t\tticks: this.options.yTicks,\r\n\t\t\tlabel: this._yLabel,\r\n\t\t\tlabelX: -25,\r\n\t\t\tlabelY: 3,\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"path\".\r\n\t */\r\n\t_appendAreaPath: function() {\r\n\t\treturn g => g.append('g')\r\n\t\t\t.attr(\"class\", \"area\")\r\n\t\t\t.append('path');\r\n\t},\r\n\r\n\t_appendFocusable: function() {\r\n\t\treturn g => {\r\n\t\t\treturn g.append('g')\r\n\t\t\t\t.attr(\"class\", 'focus')\r\n\t\t\t\t.call(this._appendFocusRect())\r\n\t\t\t\t.call(this._appendMouseFocusG());\r\n\t\t};\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"mouse-focus\" and \"drag-rect\".\r\n\t */\r\n\t_appendFocusRect: function() {\r\n\t\treturn g => {\r\n\t\t\tlet focusRect = g.append(\"rect\")\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.FocusRect({\r\n\t\t\t\t\t\twidth: this._width(),\r\n\t\t\t\t\t\theight: this._height()\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\r\n\t\t\tif (L.Browser.mobile) {\r\n\t\t\t\tfocusRect\r\n\t\t\t\t\t.on(\"touchstart.drag\", this._dragStartHandler.bind(this))\r\n\t\t\t\t\t.on(\"touchmove.drag\", this._dragHandler.bind(this))\r\n\t\t\t\t\t.on(\"touchstart.focus\", this._mousemoveHandler.bind(this))\r\n\t\t\t\t\t.on(\"touchmove.focus\", this._mousemoveHandler.bind(this));\r\n\t\t\t\tL.DomEvent.on(this._svg.node(), 'touchend', this._dragEndHandler, this);\r\n\t\t\t}\r\n\r\n\t\t\tfocusRect\r\n\t\t\t\t.on(\"mousedown.drag\", this._dragStartHandler.bind(this))\r\n\t\t\t\t.on(\"mousemove.drag\", this._dragHandler.bind(this))\r\n\t\t\t\t.on(\"mouseenter.focus\", this._mouseenterHandler.bind(this))\r\n\t\t\t\t.on(\"mousemove.focus\", this._mousemoveHandler.bind(this))\r\n\t\t\t\t.on(\"mouseout.focus\", this._mouseoutHandler.bind(this));\r\n\t\t\tL.DomEvent.on(this._svg.node(), 'mouseup', this._dragEndHandler, this);\r\n\r\n\t\t\treturn focusRect;\r\n\t\t};\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"mouse-focus\".\r\n\t */\r\n\t_appendMouseFocusG: function() {\r\n\t\treturn g => {\r\n\t\t\tlet focusG = this._focusG = g.append(\"g\")\r\n\t\t\t\t.attr(\"class\", \"mouse-focus-group hidden\");\r\n\r\n\t\t\tthis._focusline = focusG.append('svg:line')\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.MouseFocusLine({\r\n\t\t\t\t\t\txCoord: 0,\r\n\t\t\t\t\t\theight: this._height()\r\n\t\t\t\t\t})\r\n\t\t\t\t);;\r\n\t\t\tthis._focuslabel = focusG.append(\"g\")\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.MouseFocusLabel({\r\n\t\t\t\t\t\txCoord: 0,\r\n\t\t\t\t\t\tyCoord: 0,\r\n\t\t\t\t\t\theight: this._height(),\r\n\t\t\t\t\t\twidth: this._width(),\r\n\t\t\t\t\t\tlabelX: \"\",\r\n\t\t\t\t\t\tlabelY: \"\",\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\t\t\treturn focusG;\r\n\t\t};\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"legend\".\r\n\t */\r\n\t_appendLegend: function() {\r\n\t\treturn g => {\r\n\t\t\t// if (!this.options.legend) return;\r\n\r\n\t\t\tlet legend = g.append('g')\r\n\t\t\t\t.attr(\"class\", \"legend\");\r\n\r\n\t\t\t// this.fire(\"legend\");\r\n\r\n\t\t\t// let items = legend.selectAll('.legend-item')\r\n\t\t\t// \t.on('click', (d, i) => {\r\n\t\t\t// \t\tlet target = items.nodes()[i];\r\n\t\t\t// \t\tlet name = target.getAttribute('data-name');\r\n\t\t\t// \t\tlet path = this._area.select('path[data-name=\"' + name + '\"]').node();\r\n\t\t\t// \t\t// this._fireEvt(\"elepath_toggle\", { path: path, name: name, legend: target });\r\n\t\t\t// \t});\r\n\r\n\t\t\treturn legend;\r\n\t\t};\r\n\t},\r\n\r\n\t/**\r\n\t * Calculates chart width.\r\n\t */\r\n\t_width: function() {\r\n\t\tlet opts = this.options;\r\n\t\treturn opts.width - opts.margins.left - opts.margins.right;\r\n\t},\r\n\r\n\t/**\r\n\t * Calculates chart height.\r\n\t */\r\n\t_height: function() {\r\n\t\tlet opts = this.options;\r\n\t\treturn opts.height - opts.margins.top - opts.margins.bottom;\r\n\t},\r\n\r\n\t/*\r\n\t * Handle drag operations.\r\n\t */\r\n\t_dragHandler: function() {\r\n\t\t//we don't want map events to occur here\r\n\t\td3.event.preventDefault();\r\n\t\td3.event.stopPropagation();\r\n\r\n\t\tthis._gotDragged = true;\r\n\t\tthis._drawDragRectangle();\r\n\t},\r\n\r\n\t/*\r\n\t * Handles start of drag operations.\r\n\t */\r\n\t_dragStartHandler: function() {\r\n\t\td3.event.preventDefault();\r\n\t\td3.event.stopPropagation();\r\n\r\n\t\tthis._gotDragged = false;\r\n\t\tthis._dragStartCoords = d3.mouse(this._focusRect.node());\r\n\t},\r\n\r\n\t/*\r\n\t * Draws the currently dragged rectangle over the chart.\r\n\t */\r\n\t_drawDragRectangle: function() {\r\n\t\tif (!this._dragStartCoords || !this._draggingEnabled) return;\r\n\t\tif (!this._dragRectangle) {\r\n\t\t\tthis._dragRectangle = this._focus.insert(\"rect\", \".mouse-focus-group\")\r\n\t\t\t\t.attr('class', 'mouse-drag')\r\n\t\t\t\t.style(\"pointer-events\", \"none\");\r\n\t\t}\r\n\t\tthis._dragRectangle.call(\r\n\t\t\tD3.DragRectangle({\r\n\t\t\t\tdragStartCoords: this._dragStartCoords,\r\n\t\t\t\tdragEndCoords: this._dragCurrentCoords = d3.mouse(this._focusRect.node()),\r\n\t\t\t\theight: this._height(),\r\n\t\t\t})\r\n\t\t);\r\n\t},\r\n\r\n\t/*\r\n\t * Handles end of drag operations. Zooms the map to the selected items extent.\r\n\t */\r\n\t_dragEndHandler: function() {\r\n\t\tif (!this._dragStartCoords || !this._dragCurrentCoords || !this._gotDragged) {\r\n\t\t\tthis._dragStartCoords = null;\r\n\t\t\tthis._gotDragged = false;\r\n\t\t\tif (this._draggingEnabled) this._resetDrag();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet start = this._findItemForX(this._dragStartCoords[0]);\r\n\t\tlet end = this._findItemForX(this._dragCurrentCoords[0]);\r\n\r\n\t\tif (start == end) return;\r\n\r\n\t\tthis._dragStartCoords = null;\r\n\t\tthis._gotDragged = false;\r\n\r\n\t\tthis.fire('dragged', { dragstart: this._data[start], dragend: this._data[end] });\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseenter over the chart.\r\n\t */\r\n\t_mouseenterHandler: function() {\r\n\t\tthis.fire(\"mouse_enter\");\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseover the chart and displays distance and altitude level.\r\n\t */\r\n\t_mousemoveHandler: function(d, i, ctx) {\r\n\t\tlet coords = d3.mouse(this._focusRect.node());\r\n\t\tlet xCoord = coords[0];\r\n\t\tlet item = this._data[this._findItemForX(xCoord)];\r\n\r\n\t\tthis.fire(\"mouse_move\", { item: item, xCoord: xCoord });\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseout over the chart.\r\n\t */\r\n\t_mouseoutHandler: function() {\r\n\t\tthis.fire(\"mouse_out\");\r\n\t},\r\n\r\n\t/*\r\n\t * Finds a data entry for a given x-coordinate of the diagram\r\n\t */\r\n\t_findItemForX: function(x) {\r\n\t\treturn d3\r\n\t\t\t.bisector(d => d[this.options.xAttr])\r\n\t\t\t.left(this._data || [0, 1], this._x.invert(x));\r\n\t},\r\n\r\n\t/*\r\n\t * Removes the drag rectangle and zoms back to the total extent of the data.\r\n\t */\r\n\t_resetDrag: function() {\r\n\t\tif (this._dragRectangle) {\r\n\t\t\tthis._dragRectangle.remove();\r\n\t\t\tthis._dragRectangle = null;\r\n\t\t\tthis._hideDiagramIndicator();\r\n\t\t\tthis.fire('reset_drag');\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Display distance and altitude level (\"focus-rect\").\r\n\t */\r\n\t_showDiagramIndicator: function(item, xCoordinate) {\r\n\t\t// if (!this._chartEnabled) return;\r\n\r\n\t\tthis._focusG.classed(\"hidden\", false);\r\n\r\n\t\tlet opts = this.options;\r\n\t\tlet formatter = opts.hoverNumber.formatter;\r\n\t\tlet [fx, fy] = [opts.hoverNumber.decimalsX, opts.hoverNumber.decimalsY];\r\n\t\tlet yCoordinate = this._y(item[opts.yAttr]);\r\n\r\n\t\tthis._focusline.call(\r\n\t\t\tD3.MouseFocusLine({\r\n\t\t\t\txCoord: xCoordinate,\r\n\t\t\t\theight: this._height()\r\n\t\t\t})\r\n\t\t);\r\n\t\tthis._focuslabel.call(\r\n\t\t\tD3.MouseFocusLabel({\r\n\t\t\t\txCoord: xCoordinate,\r\n\t\t\t\tyCoord: yCoordinate,\r\n\t\t\t\theight: this._height(),\r\n\t\t\t\twidth: this._width(),\r\n\t\t\t\tlabelX: formatter(item[opts.xAttr], fx) + \" \" + this._xLabel,\r\n\t\t\t\tlabelY: formatter(item[opts.yAttr], fy) + \" \" + this._yLabel,\r\n\t\t\t})\r\n\t\t);\r\n\t},\r\n\r\n\t_hideDiagramIndicator: function() {\r\n\t\tthis._focusG.classed(\"hidden\", true);\r\n\t},\r\n});\r\n\r\nChart.addInitHook(function() {\r\n\tthis.on('mouse_move', function(e) {\r\n\t\tif (e.item) this._showDiagramIndicator(e.item, e.xCoord);\r\n\t});\r\n\r\n});\r\n","import 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\n\r\nexport var Marker = L.Class.extend({\r\n\r\n\tinitialize: function(options) {\r\n\t\tthis.options = options;\r\n\r\n\t\tif (this.options.imperial) {\r\n\t\t\t// this._distanceFactor = this.__mileFactor;\r\n\t\t\t// this._heightFactor = this.__footFactor;\r\n\t\t\tthis._xLabel = \"mi\";\r\n\t\t\tthis._yLabel = \"ft\";\r\n\t\t} else {\r\n\t\t\t// this._distanceFactor = this.options.distanceFactor;\r\n\t\t\t// this._heightFactor = this.options.heightFactor;\r\n\t\t\tthis._xLabel = this.options.xLabel;\r\n\t\t\tthis._yLabel = this.options.yLabel;\r\n\t\t}\r\n\r\n\t\tif (this.options.marker == 'elevation-line') {\r\n\t\t\tlet g = this._heightG = d3.create(\"g\").attr(\"class\", \"height-focus-group\");\r\n\t\t\tthis._mouseHeightFocus = d3.create('svg:line');\r\n\t\t\tthis._pointG = d3.create(\"svg:circle\");\r\n\t\t\tthis._mouseHeightFocusLabel = d3.create(\"svg:text\");\r\n\t\t} else if (this.options.marker == 'position-marker') {\r\n\t\t\tthis._marker = L.marker([0, 0], { icon: this.options.markerIcon, zIndexOffset: 1000000, interactive: false });\r\n\t\t}\r\n\t},\r\n\r\n\taddTo: function(map) {\r\n\t\tthis._map = map;\r\n\t\tlet pane, renderer;\r\n\t\tif (!map.getPane('elevationPane')) {\r\n\t\t\tpane = this._pane = map.createPane('elevationPane');\r\n\t\t\tpane.style.zIndex = 625; // This pane is above markers but below popups.\r\n\t\t\tpane.style.pointerEvents = 'none';\r\n\t\t}\r\n\t\tif (this.options.marker == 'elevation-line') {\r\n\t\t\trenderer = L.svg({ pane: \"elevationPane\" }).addTo(this._map); // default leaflet svg renderer\r\n\t\t\tlet g = this._heightG = d3.select(renderer.getPane()).select(\"svg > g\").attr(\"class\", \"height-focus-group\");\r\n\t\t\tg.append(() => this._mouseHeightFocus.node());\r\n\t\t\tg.append(() => this._pointG.node());\r\n\t\t\tg.append(() => this._mouseHeightFocusLabel.node());\r\n\t\t} else if (this.options.marker == 'position-marker') {\r\n\t\t\tthis._marker.addTo(map, { pane: 'elevationPane' });\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Update position marker (\"leaflet-marker\").\r\n\t */\r\n\tupdate: function(props) {\r\n\t\tif (props.options) this.options = props.options;\r\n\r\n\t\tlet opts = this.options;\r\n\r\n\t\tif (!this._map) this.addTo(props.map);\r\n\r\n\t\tthis._latlng = props.item.latlng;\r\n\r\n\t\tlet point = L.extend({}, props.item, this._map.latLngToLayerPoint(this._latlng));\r\n\r\n\t\tif (this.options.marker == 'elevation-line') {\r\n\r\n\t\t\tlet formatter = opts.hoverNumber.formatter;\r\n\t\t\tlet fy = opts.hoverNumber.decimalsY;\r\n\r\n\t\t\tlet normalizedAlt = this._height() / props.maxElevation * point.z;\r\n\t\t\tlet normalizedY = point.y - normalizedAlt;\r\n\r\n\t\t\tthis._heightG.classed(\"hidden\", false);\r\n\t\t\tthis._pointG.classed(\"hidden\", false);\r\n\r\n\t\t\tthis._pointG\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.HeightFocusPoint({\r\n\t\t\t\t\t\ttheme: this.options.theme,\r\n\t\t\t\t\t\txCoord: point.x,\r\n\t\t\t\t\t\tyCoord: point.y,\r\n\t\t\t\t\t}));\r\n\r\n\t\t\tthis._mouseHeightFocus\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.HeightFocusLine({\r\n\t\t\t\t\t\ttheme: this.options.theme,\r\n\t\t\t\t\t\txCoord: point.x,\r\n\t\t\t\t\t\tyCoord: point.y,\r\n\t\t\t\t\t\tlength: normalizedY\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\r\n\t\t\tthis._mouseHeightFocusLabel\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.HeightFocusLabel({\r\n\t\t\t\t\t\ttheme: this.options.theme,\r\n\t\t\t\t\t\txCoord: point.x,\r\n\t\t\t\t\t\tyCoord: normalizedY,\r\n\t\t\t\t\t\tlabel: formatter(point[opts.yAttr], fy) + \" \" + this._yLabel\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\t\t} else if (this.options.marker == 'position-marker') {\r\n\t\t\t_.removeClass(this._marker.getElement(), 'hidden');\r\n\t\t\tthis._marker.setLatLng(this._latlng);\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Hides the position/height indicator marker drawn onto the map\r\n\t */\r\n\tremove: function() {\r\n\t\tif (this.options.marker == 'elevation-line') {\r\n\t\t\tif (this._heightG) this._heightG.classed(\"hidden\", true);\r\n\t\t\tif (this._pointG) this._pointG.classed(\"hidden\", true);\r\n\t\t} else if (this.options.marker == 'position-marker') {\r\n\t\t\t_.addClass(this._marker.getElement(), 'hidden');\r\n\t\t}\r\n\t},\r\n\r\n\tgetLatLng: function() {\r\n\t\treturn this._latlng;\r\n\t},\r\n\r\n\t/**\r\n\t * Calculates chart height.\r\n\t */\r\n\t_height: function() {\r\n\t\tlet opts = this.options;\r\n\t\treturn opts.height - opts.margins.top - opts.margins.bottom;\r\n\t},\r\n\r\n});","import 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\n\r\nexport var Summary = L.Class.extend({\r\n\tinitialize: function(options) {\r\n\t\tlet opts = this.options = options;\r\n\r\n\t\tlet summary = this._summary = _.create(\"div\", \"elevation-summary \" + (this.options.summary ? this.options.summary + \"-summary\" : ''), {\r\n\t\t\tstyle: 'max-width:' + this.options.width + 'px'\r\n\t\t});\r\n\t},\r\n\r\n\trender: function() {\r\n\t\treturn container => container.append(() => this._summary);\r\n\t},\r\n\r\n\treset: function(){\r\n\t\tthis._summary.innerHTML = '';\r\n\t}\r\n});\r\n","import * as _ from './utils';\r\n\r\nexport var Options = {\r\n\tautohide: !L.Browser.mobile,\r\n\tautohideMarker: true,\r\n\tcollapsed: false,\r\n\tdetached: true,\r\n\tdistanceFactor: 1,\r\n\tdragging: !L.Browser.mobile,\r\n\tdownloadLink: 'link',\r\n\televationDiv: \"#elevation-div\",\r\n\tfollowMarker: true,\r\n\tforceAxisBounds: false,\r\n\tgpxOptions: {\r\n\t\tasync: true,\r\n\t\tmarker_options: {\r\n\t\t\tstartIconUrl: null,\r\n\t\t\tendIconUrl: null,\r\n\t\t\tshadowUrl: null,\r\n\t\t\twptIcons: {\r\n\t\t\t\t'': L.divIcon({\r\n\t\t\t\t\tclassName: 'elevation-waypoint-marker',\r\n\t\t\t\t\thtml: '<i class=\"elevation-waypoint-icon\"></i>',\r\n\t\t\t\t\ticonSize: [30, 30],\r\n\t\t\t\t\ticonAnchor: [8, 30],\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t},\r\n\t},\r\n\theight: 200,\r\n\theightFactor: 1,\r\n\thoverNumber: {\r\n\t\tdecimalsX: 2,\r\n\t\tdecimalsY: 0,\r\n\t\tformatter: _.formatter,\r\n\t},\r\n\timperial: false,\r\n\tinterpolation: \"curveLinear\",\r\n\tlazyLoadJS: true,\r\n\tlegend: true,\r\n\tloadData: {\r\n\t\tdefer: false,\r\n\t\tlazy: false,\r\n\t},\r\n\tmargins: {\r\n\t\ttop: 10,\r\n\t\tright: 20,\r\n\t\tbottom: 30,\r\n\t\tleft: 50\r\n\t},\r\n\tmarker: 'elevation-line',\r\n\tmarkerIcon: L.divIcon({\r\n\t\tclassName: 'elevation-position-marker',\r\n\t\thtml: '<i class=\"elevation-position-icon\"></i>',\r\n\t\ticonSize: [32, 32],\r\n\t\ticonAnchor: [16, 16],\r\n\t}),\r\n\tplaceholder: false,\r\n\tposition: \"topright\",\r\n\tpolyline: {\r\n\t\tclassName: 'elevation-polyline',\r\n\t\tcolor: '#000',\r\n\t\topacity: 0.75,\r\n\t\tweight: 5,\r\n\t\tlineCap: 'round'\r\n\t},\r\n\treverseCoords: false,\r\n\tskipNullZCoords: false,\r\n\ttheme: \"lightblue-theme\",\r\n\tresponsive: true,\r\n\tsummary: 'inline',\r\n\tslope: false,\r\n\tsDeltaMax: false,\r\n\tsInterpolation: \"curveStepAfter\",\r\n\tsRange: false,\r\n\twidth: 600,\r\n\txAttr: \"dist\",\r\n\txLabel: \"km\",\r\n\txTicks: undefined,\r\n\tyAttr: \"z\",\r\n\tyAxisMax: undefined,\r\n\tyAxisMin: undefined,\r\n\tyLabel: \"m\",\r\n\tyTicks: undefined,\r\n\tzFollow: 13,\r\n};\r\n","import 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\nimport { Chart } from './chart';\r\nimport { Marker } from './marker';\r\nimport { Summary } from './summary';\r\nimport { Options } from './options';\r\n\r\nexport const Elevation = L.Control.Elevation = L.Control.extend({\r\n\r\n\tincludes: L.Evented ? L.Evented.prototype : L.Mixin.Events,\r\n\r\n\toptions: Options,\r\n\t__mileFactor: 0.621371,\r\n\t__footFactor: 3.28084,\r\n\t__D3: 'https://unpkg.com/d3@5.15.0/dist/d3.min.js',\r\n\t__LGPX: 'https://unpkg.com/leaflet-gpx@1.5.0/gpx.js',\r\n\r\n\t/*\r\n\t * Add data to the diagram either from GPX or GeoJSON and update the axis domain and data\r\n\t */\r\n\taddData: function(d, layer) {\r\n\t\tif ((typeof layer === \"undefined\" || layer === null) && d.on) {\r\n\t\t\tlayer = d;\r\n\t\t}\r\n\t\tElevation._d3LazyLoader = _.lazyLoader(\r\n\t\t\tthis.__D3,\r\n\t\t\ttypeof d3 !== 'object' || !this.options.lazyLoadJS,\r\n\t\t\tElevation._d3LazyLoader\r\n\t\t).then(() => {\r\n\t\t\tthis._addData(d);\r\n\t\t\tthis._addLayer(layer);\r\n\t\t\tthis._fireEvt(\"eledata_added\", { data: d, layer: layer, track_info: this.track_info });\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Adds the control to the given map.\r\n\t */\r\n\taddTo: function(map) {\r\n\t\tif (this.options.detached) {\r\n\t\t\tlet eleDiv = this._initElevationDiv();\r\n\t\t\tif (!eleDiv.isConnected) _.insert(map._container, eleDiv, 'afterend');\r\n\t\t\t_.append(eleDiv, this.onAdd(map));\r\n\t\t} else {\r\n\t\t\tL.Control.prototype.addTo.call(this, map);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t * Reset data and display\r\n\t */\r\n\tclear: function() {\r\n\t\tthis._clearPath();\r\n\t\tthis._clearChart();\r\n\t\tthis._clearData();\r\n\r\n\t\tthis._fireEvt(\"eledata_clear\");\r\n\t},\r\n\r\n\t/**\r\n\t * Disable dragging chart on touch events.\r\n\t */\r\n\tdisableDragging: function() {\r\n\t\tthis._chart._draggingEnabled = false;\r\n\t\tthis._resetDrag();\r\n\t},\r\n\r\n\t/**\r\n\t * Enable dragging chart on touch events.\r\n\t */\r\n\tenableDragging: function() {\r\n\t\tthis._chart._draggingEnabled = true;\r\n\t},\r\n\r\n\t/**\r\n\t * Sets a map view that contains the given geographical bounds.\r\n\t */\r\n\tfitBounds: function(bounds) {\r\n\t\tbounds = bounds || this.getBounds();\r\n\t\tif (this._map && bounds.isValid()) this._map.fitBounds(bounds);\r\n\t},\r\n\r\n\tgetBounds: function(data) {\r\n\t\tdata = data || this._data;\r\n\t\treturn L.latLngBounds(data.map((d) => d.latlng));\r\n\t},\r\n\r\n\t/**\r\n\t * Get default zoom level when \"followMarker\" is true.\r\n\t */\r\n\tgetZFollow: function() {\r\n\t\treturn this._zFollow;\r\n\t},\r\n\r\n\t/**\r\n\t * Hide current elevation chart profile.\r\n\t */\r\n\thide: function() {\r\n\t\t_.style(this._container, \"display\", \"none\");\r\n\t},\r\n\r\n\t/**\r\n\t * Initialize chart control \"options\" and \"container\".\r\n\t */\r\n\tinitialize: function(options) {\r\n\t\tthis.options = _.deepMerge({}, this.options, options);\r\n\r\n\t\tif (this.options.imperial) {\r\n\t\t\tthis._distanceFactor = this.__mileFactor;\r\n\t\t\tthis._heightFactor = this.__footFactor;\r\n\t\t\tthis._xLabel = \"mi\";\r\n\t\t\tthis._yLabel = \"ft\";\r\n\t\t} else {\r\n\t\t\tthis._distanceFactor = this.options.distanceFactor;\r\n\t\t\tthis._heightFactor = this.options.heightFactor;\r\n\t\t\tthis._xLabel = this.options.xLabel;\r\n\t\t\tthis._yLabel = this.options.yLabel;\r\n\t\t}\r\n\r\n\t\tthis._chartEnabled = true;\r\n\t\tthis._zFollow = this.options.zFollow;\r\n\r\n\t\tif (this.options.followMarker) this._setMapView = L.Util.throttle(this._setMapView, 300, this);\r\n\t\tif (this.options.placeholder) this.options.loadData.lazy = this.options.loadData.defer = true;\r\n\r\n\t\tif (this.options.legend) this.options.margins.bottom += 30;\r\n\t},\r\n\r\n\t/**\r\n\t * Alias for loadData\r\n\t */\r\n\tload: function(data, opts) {\r\n\t\tthis.loadData(data, opts);\r\n\t},\r\n\r\n\t/**\r\n\t * Alias for addTo\r\n\t */\r\n\tloadChart: function(map) {\r\n\t\tthis.addTo(map);\r\n\t},\r\n\r\n\t/**\r\n\t * Load elevation data (GPX or GeoJSON).\r\n\t */\r\n\tloadData: function(data, opts) {\r\n\t\topts = L.extend({}, this.options.loadData, opts);\r\n\t\tif (opts.defer) {\r\n\t\t\tthis.loadDefer(data, opts);\r\n\t\t} else if (opts.lazy) {\r\n\t\t\tthis.loadLazy(data, opts);\r\n\t\t} else if (_.isXMLDoc(data)) {\r\n\t\t\tthis.loadGPX(data);\r\n\t\t} else if (_.isJSONDoc(data)) {\r\n\t\t\tthis.loadGeoJSON(data);\r\n\t\t} else {\r\n\t\t\tthis.loadFile(data);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Wait for document load before download data.\r\n\t */\r\n\tloadDefer: function(data, opts) {\r\n\t\topts = L.extend({}, this.options.loadData, opts);\r\n\t\topts.defer = false;\r\n\t\t_.deferFunc(L.bind(this.loadData, this, data, opts));\r\n\t},\r\n\r\n\t/**\r\n\t * Load data from a remote url.\r\n\t */\r\n\tloadFile: function(url) {\r\n\t\t_.loadFile(url)\r\n\t\t\t.then((data) => {\r\n\t\t\t\tthis._downloadURL = url; // TODO: handle multiple urls?\r\n\t\t\t\tthis.loadData(data, { lazy: false, defer: false });\r\n\t\t\t})\r\n\t\t\t.catch((err) => console.warn(err));\r\n\t},\r\n\r\n\t/**\r\n\t * Load raw GeoJSON data.\r\n\t */\r\n\tloadGeoJSON: function(data) {\r\n\t\t_.GeoJSONLoader(data, this);\r\n\t},\r\n\r\n\t/**\r\n\t * Load raw GPX data.\r\n\t */\r\n\tloadGPX: function(data) {\r\n\t\tElevation._gpxLazyLoader = _.lazyLoader(\r\n\t\t\tthis.__LGPX,\r\n\t\t\ttypeof L.GPX !== 'function' || !this.options.lazyLoadJS,\r\n\t\t\tElevation._gpxLazyLoader\r\n\t\t).then(() => _.GPXLoader(data, this));\r\n\t},\r\n\r\n\t/**\r\n\t * Wait for chart container visible before download data.\r\n\t */\r\n\tloadLazy: function(data, opts) {\r\n\t\topts = L.extend({}, this.options.loadData, opts);\r\n\t\tlet elem = opts.lazy.parentNode ? opts.lazy : this.placeholder;\r\n\t\t_.waitHolder(opts.lazy)\r\n\t\t\t.then(() => {\r\n\t\t\t\topts.lazy = false;\r\n\t\t\t\tthis.loadData(data, opts)\r\n\t\t\t\tthis.once('eledata_loaded', () => opts.lazy.parentNode.removeChild(elem));\r\n\t\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Create container DOM element and related event listeners.\r\n\t * Called on control.addTo(map).\r\n\t */\r\n\tonAdd: function(map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tlet container = this._container = _.create(\"div\", \"elevation-control elevation \" + this.options.theme);\r\n\r\n\t\tif (!this.options.detached) {\r\n\t\t\t_.addClass(container, 'leaflet-control');\r\n\t\t}\r\n\r\n\t\tif (this.options.placeholder && !this._data) {\r\n\t\t\tthis.placeholder = _.create('img', 'elevation-placeholder', typeof this.options.placeholder === 'string' ? { src: this.options.placeholder, alt: '' } : this.options.placeholder);\r\n\t\t\t_.insert(container, this.placeholder, 'beforebegin');\r\n\t\t}\r\n\r\n\t\tElevation._d3LazyLoader = _.lazyLoader(\r\n\t\t\tthis.__D3,\r\n\t\t\ttypeof d3 !== 'object' || !this.options.lazyLoadJS,\r\n\t\t\tElevation._d3LazyLoader\r\n\t\t).then(() => {\r\n\t\t\tthis._initToggle(container);\r\n\t\t\tthis._initChart(container);\r\n\t\t\tthis._initMarker(container);\r\n\r\n\t\t\tthis._map.on('zoom viewreset zoomanim', this._hidePositionMarker, this);\r\n\t\t\tthis._map.on('resize', this._resetView, this);\r\n\t\t\tthis._map.on('resize', this._resizeChart, this);\r\n\t\t\tthis._map.on('mousedown', this._resetDrag, this);\r\n\r\n\t\t\t_.on(this._map._container, 'mousewheel', this._resetDrag, this);\r\n\t\t\t_.on(this._map._container, 'touchstart', this._resetDrag, this);\r\n\r\n\t\t\tthis.on('eledata_loaded eledata_added', this._updateChart, this);\r\n\t\t\tthis.on('eledata_loaded eledata_added', this._updateSummary, this);\r\n\r\n\t\t\tthis._updateChart();\r\n\t\t\tthis._updateSummary();\r\n\t\t});\r\n\r\n\t\treturn container;\r\n\t},\r\n\r\n\t/**\r\n\t * Clean up control code and related event listeners.\r\n\t * Called on control.remove().\r\n\t */\r\n\tonRemove: function(map) {\r\n\t\tthis._container = null;\r\n\r\n\t\tthis._map.off('zoom viewreset zoomanim', this._hidePositionMarker, this);\r\n\t\tthis._map.off('resize', this._resetView, this);\r\n\t\tthis._map.off('resize', this._resizeChart, this);\r\n\t\tthis._map.off('mousedown', this._resetDrag, this);\r\n\r\n\t\t_.off(this._map._container, 'mousewheel', this._resetDrag, this);\r\n\t\t_.off(this._map._container, 'touchstart', this._resetDrag, this);\r\n\r\n\t\tthis.off('eledata_loaded eledata_added', this._updateChart, this);\r\n\t\tthis.off('eledata_loaded eledata_added', this._updateSummary, this);\r\n\t},\r\n\r\n\t/**\r\n\t * Redraws the chart control. Sometimes useful after screen resize.\r\n\t */\r\n\tredraw: function() {\r\n\t\tthis._resizeChart();\r\n\t},\r\n\r\n\t/**\r\n\t * Set default zoom level when \"followMarker\" is true.\r\n\t */\r\n\tsetZFollow: function(zoom) {\r\n\t\tthis._zFollow = zoom;\r\n\t},\r\n\r\n\t/**\r\n\t * Hide current elevation chart profile.\r\n\t */\r\n\tshow: function() {\r\n\t\t_.style(this._container, \"display\", \"block\");\r\n\t},\r\n\r\n\t/*\r\n\t * Parsing data either from GPX or GeoJSON and update the diagram data\r\n\t */\r\n\t_addData: function(d) {\r\n\t\tlet geom = d && d.geometry;\r\n\t\tlet feat = d && d.type === \"FeatureCollection\";\r\n\t\tlet gpx = d && d._latlngs;\r\n\r\n\t\tif (geom) {\r\n\t\t\tswitch (geom.type) {\r\n\t\t\t\tcase 'LineString':\r\n\t\t\t\t\tthis._addGeoJSONData(geom.coordinates);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'MultiLineString':\r\n\t\t\t\t\t_.each(geom.coordinates, coords => this._addGeoJSONData(coords));\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconsole.warn('Unsopperted GeoJSON feature geometry type:' + geom.type);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (feat) {\r\n\t\t\t_.each(d.features, feature => this._addData(feature));\r\n\t\t}\r\n\r\n\t\tif (gpx) {\r\n\t\t\tthis._addGPXData(d._latlngs);\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Parsing of GeoJSON data lines and their elevation in z-coordinate\r\n\t */\r\n\t_addGeoJSONData: function(coords) {\r\n\t\t_.each(coords, point => this._addPoint(point[1], point[0], point[2]));\r\n\t},\r\n\r\n\t/*\r\n\t * Parsing function for GPX data and their elevation in z-coordinate\r\n\t */\r\n\t_addGPXData: function(coords) {\r\n\t\t_.each(coords, point => this._addPoint(point.lat, point.lng, point.meta.ele));\r\n\t},\r\n\r\n\t/*\r\n\t * Parse and push a single (x, y, z) point to current elevation profile.\r\n\t */\r\n\t_addPoint: function(x, y, z) {\r\n\t\tif (this.options.reverseCoords) {\r\n\t\t\t[x, y] = [y, x];\r\n\t\t}\r\n\r\n\t\tlet data = this._data || [];\r\n\t\tlet eleMax = this._maxElevation || -Infinity;\r\n\t\tlet eleMin = this._minElevation || +Infinity;\r\n\t\tlet dist = this._distance || 0;\r\n\r\n\t\tlet curr = new L.LatLng(x, y);\r\n\t\tlet prev = data.length ? data[data.length - 1].latlng : curr;\r\n\r\n\t\tlet delta = curr.distanceTo(prev) * this._distanceFactor;\r\n\r\n\t\tdist = dist + Math.round(delta / 1000 * 100000) / 100000;\r\n\r\n\t\t// check and fix missing elevation data on last added point\r\n\t\tif (!this.options.skipNullZCoords && data.length > 0) {\r\n\t\t\tlet prevZ = data[data.length - 1].z;\r\n\t\t\tif (isNaN(prevZ)) {\r\n\t\t\t\tlet lastZ = this._lastValidZ;\r\n\t\t\t\tlet currZ = z * this._heightFactor;\r\n\t\t\t\tif (!isNaN(lastZ) && !isNaN(currZ)) {\r\n\t\t\t\t\tprevZ = (lastZ + currZ) / 2;\r\n\t\t\t\t} else if (!isNaN(lastZ)) {\r\n\t\t\t\t\tprevZ = lastZ;\r\n\t\t\t\t} else if (!isNaN(currZ)) {\r\n\t\t\t\t\tprevZ = currZ;\r\n\t\t\t\t}\r\n\t\t\t\tif (!isNaN(prevZ)) data[data.length - 1].z = prevZ;\r\n\t\t\t\telse data.splice(data.length - 1, 1);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tz = z * this._heightFactor;\r\n\r\n\t\t// skip point if it has not elevation\r\n\t\tif (!isNaN(z)) {\r\n\t\t\teleMax = eleMax < z ? z : eleMax;\r\n\t\t\teleMin = eleMin > z ? z : eleMin;\r\n\t\t\tthis._lastValidZ = z;\r\n\t\t}\r\n\r\n\t\tdata.push({\r\n\t\t\tdist: dist,\r\n\t\t\tx: x,\r\n\t\t\ty: y,\r\n\t\t\tz: z,\r\n\t\t\tlatlng: curr\r\n\t\t});\r\n\r\n\t\tthis._data = data;\r\n\t\tthis.track_info = this.track_info || {};\r\n\t\tthis.track_info.distance = this._distance = dist;\r\n\t\tthis.track_info.elevation_max = this._maxElevation = eleMax;\r\n\t\tthis.track_info.elevation_min = this._minElevation = eleMin;\r\n\r\n\t\tthis._fireEvt(\"eledata_updated\", { index: data.length - 1 });\r\n\t},\r\n\r\n\t_addLayer: function(layer) {\r\n\t\tif (layer) {\r\n\t\t\t_.addClass(layer._path, this.options.polyline.className + ' ' + this.options.theme);\r\n\r\n\t\t\tlayer\r\n\t\t\t\t.on(\"mousemove\", this._mousemoveLayerHandler, this)\r\n\t\t\t\t.on(\"mouseout\", this._mouseoutHandler, this);\r\n\r\n\t\t\tthis._layers = this._layers || {};\r\n\t\t\tthis._layers[L.Util.stamp(layer)] = layer;\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Adds the control to the given \"detached\" div.\r\n\t */\r\n\t_initElevationDiv: function() {\r\n\t\tlet eleDiv = _.select(this.options.elevationDiv);\r\n\t\tif (!eleDiv) {\r\n\t\t\tthis.options.elevationDiv = '#elevation-div_' + _.randomId();\r\n\t\t\teleDiv = _.create('div', 'leaflet-control elevation elevation-div', { id: this.options.elevationDiv.substr(1) });\r\n\t\t}\r\n\t\tif (this.options.detached) {\r\n\t\t\t_.addClass(eleDiv, 'elevation-detached');\r\n\t\t\t_.removeClass(eleDiv, 'leaflet-control');\r\n\t\t}\r\n\t\tthis.eleDiv = eleDiv;\r\n\t\treturn this.eleDiv;\r\n\t},\r\n\r\n\t/*\r\n\t * Reset chart.\r\n\t */\r\n\t_clearChart: function() {\r\n\t\tthis._resetDrag();\r\n\t},\r\n\r\n\t/*\r\n\t * Reset data.\r\n\t */\r\n\t_clearData: function() {\r\n\t\tthis._data = null;\r\n\t\tthis._distance = null;\r\n\t\tthis._maxElevation = null;\r\n\t\tthis._minElevation = null;\r\n\t\tthis.track_info = null;\r\n\t\tthis._layers = null;\r\n\t},\r\n\r\n\t/*\r\n\t * Reset path.\r\n\t */\r\n\t_clearPath: function() {\r\n\t\tthis._hidePositionMarker();\r\n\t\t_.each(this._layers, l => _.removeClass(l._path, this.options.polyline.className + ' ' + this.options.theme));\r\n\t},\r\n\r\n\t/*\r\n\t * Collapse current chart control.\r\n\t */\r\n\t_collapse: function() {\r\n\t\t_.removeClass(this._container, 'elevation-expanded');\r\n\t\t_.addClass(this._container, 'elevation-collapsed');\r\n\t},\r\n\r\n\t/*\r\n\t * Expand current chart control.\r\n\t */\r\n\t_expand: function() {\r\n\t\t_.removeClass(this._container, 'elevation-collapsed');\r\n\t\t_.addClass(this._container, 'elevation-expanded');\r\n\t},\r\n\r\n\t/*\r\n\t * Finds an item with the smallest delta in distance to the given latlng coords\r\n\t */\r\n\t_findItemForLatLng: function(latlng) {\r\n\t\tlet result = null;\r\n\t\tlet d = Infinity;\r\n\t\t_.each(this._data,\r\n\t\t\titem => {\r\n\t\t\t\tlet dist = latlng.distanceTo(item.latlng);\r\n\t\t\t\tif (dist < d) {\r\n\t\t\t\t\td = dist;\r\n\t\t\t\t\tresult = item;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\treturn result;\r\n\t},\r\n\r\n\t/*\r\n\t * Finds a data entry for a given x-coordinate of the diagram\r\n\t */\r\n\t_findItemForX: function(x) {\r\n\t\treturn this._chart._findItemForX(x);\r\n\t},\r\n\r\n\t/**\r\n\t * Fires an event of the specified type.\r\n\t */\r\n\t_fireEvt: function(type, data, propagate) {\r\n\t\tif (this.fire) this.fire(type, data, propagate);\r\n\t\tif (this._map) this._map.fire(type, data, propagate);\r\n\t},\r\n\r\n\t/**\r\n\t * Calculates chart height.\r\n\t */\r\n\t_height: function() {\r\n\t\tlet opts = this.options;\r\n\t\treturn opts.height - opts.margins.top - opts.margins.bottom;\r\n\t},\r\n\r\n\t/*\r\n\t * Hides the position/height indicator marker drawn onto the map\r\n\t */\r\n\t_hidePositionMarker: function() {\r\n\t\tif (this.options.autohideMarker) {\r\n\t\t\tthis._marker.remove();\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"svg\" chart DOM element.\r\n\t */\r\n\t_initChart: function() {\r\n\t\tlet opts = this.options;\r\n\t\topts.xTicks = opts.xTicks || Math.round(this._width() / 75);\r\n\t\topts.yTicks = opts.yTicks || Math.round(this._height() / 30);\r\n\r\n\t\tif (opts.responsive) {\r\n\t\t\tif (opts.detached) {\r\n\t\t\t\tlet offWi = this.eleDiv.offsetWidth;\r\n\t\t\t\tlet offHe = this.eleDiv.offsetHeight;\r\n\t\t\t\topts.width = offWi > 0 ? offWi : opts.width;\r\n\t\t\t\topts.height = (offHe - 20) > 0 ? offHe - 20 : opts.height; // 20 = horizontal scrollbar size.\r\n\t\t\t} else {\r\n\t\t\t\topts._maxWidth = opts._maxWidth > opts.width ? opts._maxWidth : opts.width;\r\n\t\t\t\tlet containerWidth = this._map._container.clientWidth;\r\n\t\t\t\topts.width = opts._maxWidth > containerWidth ? containerWidth - 30 : opts.width;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet chart = this._chart = new Chart(opts);\r\n\t\tlet summary = this._summary = new Summary(opts);\r\n\r\n\t\tlet container = d3.select(this._container)\r\n\t\t\t.call(chart.render())\r\n\t\t\t.call(summary.render());\r\n\r\n\t\tthis._svg = chart._svg;\r\n\t\tthis._grid = chart._grid;\r\n\t\tthis._area = chart._area;\r\n\t\tthis._path = chart._path;\r\n\t\tthis._axis = chart._axis;\r\n\t\tthis._focus = chart._focus;\r\n\t\tthis._focusRect = chart._focusRect;\r\n\t\tthis._x = chart._x;\r\n\t\tthis._y = chart._y;\r\n\t\tthis._legend = chart._legend;\r\n\t\tthis._focuslabel = chart._focuslabel;\r\n\t\tthis._focusline = chart._focusline;\r\n\t\tthis.summaryDiv = summary._summary;\r\n\r\n\t\tchart.on('reset_drag', this._hidePositionMarker, this);\r\n\t\tchart.on('mouse_enter', this._fireEvt.bind('elechart_enter'), this);\r\n\t\tchart.on('dragged', this._fireEvt.bind(\"elechart_dragged\"), this);\r\n\t\tchart.on('mouse_move', this._mousemoveHandler, this);\r\n\t\tchart.on('mouse_out', this._mouseoutHandler, this);\r\n\t\t// chart.on('legend', this._fireEvt.bind('elechart_legend'), this);\r\n\r\n\t\tthis._fireEvt(\"elechart_init\");\r\n\t},\r\n\r\n\t_initMarker: function(container) {\r\n\t\tthis._marker = new Marker(this.options);\r\n\t\tthis._mouseHeightFocusLabel = this._marker._mouseHeightFocusLabel;\r\n\t},\r\n\r\n\t/**\r\n\t * Inspired by L.Control.Layers\r\n\t */\r\n\t_initToggle: function(container) {\r\n\t\t//Makes this work on IE10 Touch devices by stopping it from firing a mouseout event when the touch is released\r\n\t\tcontainer.setAttribute('aria-haspopup', true);\r\n\r\n\t\tif (!this.options.detached) {\r\n\t\t\tL.DomEvent\r\n\t\t\t\t.disableClickPropagation(container);\r\n\t\t\t//.disableScrollPropagation(container);\r\n\t\t}\r\n\r\n\t\tif (L.Browser.mobile) {\r\n\t\t\t_.on(container, 'click', L.DomEvent.stopPropagation);\r\n\t\t}\r\n\r\n\t\t_.on(container, 'mousewheel', this._mousewheelHandler, this);\r\n\r\n\t\tif (!this.options.detached) {\r\n\t\t\tlet link = this._button = _.create('a', \"elevation-toggle elevation-toggle-icon\" + (this.options.autohide ? \"\" : \" close-button\"), { href: '#', title: L._('Elevation') }, container);\r\n\r\n\t\t\tif (this.options.collapsed) {\r\n\t\t\t\tthis._collapse();\r\n\t\t\t\tif (this.options.autohide) {\r\n\t\t\t\t\t_.on(container, 'mouseover', this._expand, this);\r\n\t\t\t\t\t_.on(container, 'mouseout', this._collapse, this);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_.on(link, 'click', L.DomEvent.stop);\r\n\t\t\t\t\t_.on(link, 'click', this._toggle, this);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t_.on(link, 'focus', this._toggle, this);\r\n\r\n\t\t\t\tthis._map.on('click', this._collapse, this);\r\n\t\t\t\t// TODO: keyboard accessibility\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// TODO: handle autohide when detached=true\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseover the chart and displays distance and altitude level.\r\n\t */\r\n\t_mousemoveHandler: function(e) {\r\n\t\tif (!this._data || this._data.length === 0 || !this._chartEnabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet xCoord = e.xCoord;\r\n\t\tlet item = this._data[this._findItemForX(xCoord)];\r\n\r\n\t\tthis._showPositionMarker(item);\r\n\t\tthis._setMapView(item);\r\n\r\n\t\tif (this._map) {\r\n\t\t\t_.addClass(this._map._container, 'elechart-hover');\r\n\t\t}\r\n\r\n\t\tthis._fireEvt(\"elechart_change\", { data: item, xCoord: xCoord });\r\n\t\tthis._fireEvt(\"elechart_hover\", { data: item, xCoord: xCoord });\r\n\t},\r\n\r\n\t/*\r\n\t * Handles mouseover events of the data layers on the map.\r\n\t */\r\n\t_mousemoveLayerHandler: function(e) {\r\n\t\tif (!this._data || this._data.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet item = this._findItemForLatLng(e.latlng);\r\n\t\tif (item) {\r\n\t\t\tlet xCoord = item.xDiagCoord;\r\n\r\n\t\t\tif (this._chartEnabled) this._chart._showDiagramIndicator(item, xCoord);\r\n\r\n\t\t\tthis._showPositionMarker(item);\r\n\r\n\t\t\tthis._fireEvt(\"elechart_change\", { data: item, xCoord: xCoord });\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseout over the chart.\r\n\t */\r\n\t_mouseoutHandler: function() {\r\n\t\tif (!this.options.detached) {\r\n\t\t\tthis._hidePositionMarker();\r\n\t\t\tthis._chart._hideDiagramIndicator();\r\n\t\t}\r\n\r\n\t\tif (this._map) {\r\n\t\t\t_.removeClass(this._map._container, 'elechart-hover');\r\n\t\t}\r\n\r\n\t\tthis._fireEvt(\"elechart_leave\");\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the mouesewheel over the chart.\r\n\t */\r\n\t_mousewheelHandler: function(e) {\r\n\t\tif (this._map.gestureHandling && this._map.gestureHandling._enabled) return;\r\n\t\tlet ll = this._marker.getLatLng() || this._map.getCenter();\r\n\t\tlet z = this._map.getZoom() + Math.sign(e.deltaY);\r\n\t\tthis._resetDrag();\r\n\t\tthis._map.flyTo(ll, z);\r\n\t},\r\n\r\n\t/*\r\n\t * Removes the drag rectangle and zoms back to the total extent of the data.\r\n\t */\r\n\t_resetDrag: function() {\r\n\t\tthis._chart._resetDrag();\r\n\t\tthis._hidePositionMarker();\r\n\t},\r\n\r\n\t/**\r\n\t * Resets drag, marker and bounds.\r\n\t */\r\n\t_resetView: function() {\r\n\t\tif (this._map && this._map._isFullscreen) return;\r\n\t\tthis._resetDrag();\r\n\t\tthis._hidePositionMarker();\r\n\t\tthis.fitBounds();\r\n\t},\r\n\r\n\t/**\r\n\t * Hacky way for handling chart resize. Deletes it and redraw chart.\r\n\t */\r\n\t_resizeChart: function() {\r\n\t\t// prevent displaying chart on resize if hidden\r\n\t\tif (_.style(this._container, \"display\") == \"none\") return;\r\n\r\n\t\tif (this.options.responsive) {\r\n\t\t\tif (this.options.detached) {\r\n\t\t\t\tlet newWidth = this.eleDiv.offsetWidth; // - 20;\r\n\t\t\t\tif (newWidth) {\r\n\t\t\t\t\tthis.options.width = newWidth;\r\n\t\t\t\t\tthis.eleDiv.innerHTML = \"\";\r\n\t\t\t\t\t_.append(this.eleDiv, this.onAdd(this._map));\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis._map.removeControl(this._container);\r\n\t\t\t\tthis.addTo(this._map);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Collapse or Expand current chart control.\r\n\t */\r\n\t_toggle: function() {\r\n\t\tif (_.hasClass(this._container, \"elevation-expanded\"))\r\n\t\t\tthis._collapse();\r\n\t\telse\r\n\t\t\tthis._expand();\r\n\t},\r\n\r\n\t/**\r\n\t * Sets the view of the map (center and zoom). Useful when \"followMarker\" is true.\r\n\t */\r\n\t_setMapView: function(item) {\r\n\t\tif (!this.options.followMarker || !this._map) return;\r\n\t\tlet zoom = this._map.getZoom();\r\n\t\tzoom = zoom < this._zFollow ? this._zFollow : zoom;\r\n\t\tthis._map.setView(item.latlng, zoom, { animate: true, duration: 0.25 });\r\n\t},\r\n\r\n\t/*\r\n\t * Shows the position/height indicator marker drawn onto the map\r\n\t */\r\n\t_showPositionMarker: function(item) {\r\n\t\tif (this.options.marker) {\r\n\t\t\tthis._marker.update({ item: item, map: this._map, maxElevation: this._maxElevation, options: this.options });\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Calculates [x, y] domain and then update chart.\r\n\t */\r\n\t_updateChart: function() {\r\n\t\tif (!this._data || !this._container) return;\r\n\r\n\t\tthis._chart = this._chart.update({ data: this._data });\r\n\r\n\t\tthis._x = this._chart._x;\r\n\t\tthis._y = this._chart._y;\r\n\r\n\t\tthis._fireEvt(\"elechart_axis\");\r\n\t\tif (this.options.legend) this._fireEvt(\"elechart_legend\");\r\n\r\n\t\tthis._fireEvt('elechart_updated');\r\n\t},\r\n\r\n\t/**\r\n\t * Update chart summary.\r\n\t */\r\n\t_updateSummary: function() {\r\n\t\tthis.track_info = this.track_info || {};\r\n\t\tthis.track_info.distance = this._distance || 0;\r\n\t\tthis.track_info.elevation_max = this._maxElevation || 0;\r\n\t\tthis.track_info.elevation_min = this._minElevation || 0;\r\n\r\n\t\tthis._summary.reset();\r\n\r\n\t\tif (this.options.summary) {\r\n\t\t\tthis._fireEvt(\"elechart_summary\");\r\n\t\t}\r\n\t\tif (this.options.downloadLink && this._downloadURL) { // TODO: generate dynamically file content instead of using static file urls.\r\n\t\t\tthis.summaryDiv.innerHTML += '<span class=\"download\"><a href=\"#\">' + L._('Download') + '</a></span>'\r\n\t\t\t_.select('.download a', this.summaryDiv).onclick = (e) => {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tthis._fireEvt('eletrack_download', { downloadLink: this.options.downloadLink, confirm: _.saveFile.bind(this, this._downloadURL) });\r\n\t\t\t};\r\n\t\t};\r\n\t},\r\n\r\n\r\n\t/**\r\n\t * Calculates chart width.\r\n\t */\r\n\t_width: function() {\r\n\t\tlet opts = this.options;\r\n\t\treturn opts.width - opts.margins.left - opts.margins.right;\r\n\t},\r\n\r\n});\r\n\r\n/**\r\n * Attach here some useful elevation hooks.\r\n */\r\nElevation.addInitHook(function() {\r\n\r\n\tthis.on('waypoint_added', function(e) {\r\n\t\tlet p = e.point,\r\n\t\t\tpop = p._popup;\r\n\t\tif (pop) {\r\n\t\t\tpop.options.className = 'elevation-popup';\r\n\t\t}\r\n\t\tif (pop._content) {\r\n\t\t\tpop._content = decodeURI(pop._content);\r\n\t\t\tp.bindTooltip(pop._content, { direction: 'top', sticky: true, opacity: 1, className: 'elevation-tooltip' }).openTooltip();\r\n\t\t}\r\n\t});\r\n\r\n\tthis.on('elepath_toggle', function(e) {\r\n\t\tlet path = e.path;\r\n\r\n\t\tlet enabled = _.hasClass(path, 'hidden');\r\n\t\tlet text = _.select('text', e.legend);\r\n\r\n\t\tif (enabled) {\r\n\t\t\t_.removeClass(path, 'hidden');\r\n\t\t\t_.style(text, \"text-decoration-line\", \"\")\r\n\t\t} else {\r\n\t\t\t_.addClass(path, 'hidden');\r\n\t\t\t_.style(text, \"text-decoration-line\", \"line-through\")\r\n\t\t}\r\n\r\n\t\tthis._chartEnabled = this._area.selectAll('path:not(.hidden)').nodes().length != 0;\r\n\r\n\t\t// autotoggle chart data on single click\r\n\t\tif (!this._chartEnabled) {;\r\n\t\t\tthis._resetDrag();\r\n\t\t\tthis._clearPath();\r\n\t\t} else {\r\n\t\t\t// this._resizeChart();\r\n\t\t\t_.each(this._layers, l => _.addClass(l._path, this.options.polyline.className + ' ' + this.options.theme));\r\n\t\t}\r\n\t});\r\n\r\n\tthis.on(\"elechart_dragged\", function(e) {\r\n\t\tthis._hidePositionMarker();\r\n\t\tthis.fitBounds(L.latLngBounds([e.dragstart.latlng, e.dragend.latlng]));\r\n\t});\r\n\r\n\tthis.on(\"elechart_updated\", function() {\r\n\t\t// TODO: maybe should i listen for this inside chart.js?\r\n\t\tthis._legend.selectAll('.legend-item')\r\n\t\t\t.on('click', (d, i, n) => {\r\n\t\t\t\tlet target = n[i];\r\n\t\t\t\tlet name = target.getAttribute('data-name');\r\n\t\t\t\tlet path = this._area.select('path[data-name=\"' + name + '\"]').node();\r\n\t\t\t\tthis._fireEvt(\"elepath_toggle\", { path: path, name: name, legend: target });\r\n\t\t\t});\r\n\t});\r\n\r\n\tthis.on(\"eletrack_download\", function(e) {\r\n\t\tif (e.downloadLink == 'modal' && typeof CustomEvent === \"function\") {\r\n\t\t\tdocument.dispatchEvent(new CustomEvent(\"eletrack_download\", { detail: e }));\r\n\t\t} else if (e.downloadLink == 'link' || e.downloadLink === true) {\r\n\t\t\te.confirm();\r\n\t\t}\r\n\t});\r\n\r\n\tthis.on('eledata_loaded', function(e) {\r\n\t\tlet layer = e.layer;\r\n\t\tif (this._map) {\r\n\t\t\tthis._map.once('layeradd', function(e) {\r\n\t\t\t\tthis.fitBounds(layer.getBounds());\r\n\t\t\t}, this);\r\n\t\t\tlayer.addTo(this._map);\r\n\t\t} else {\r\n\t\t\tconsole.warn(\"Undefined elevation map object\");\r\n\t\t}\r\n\t});\r\n\r\n\tthis.on('eledata_clear', function() {\r\n\t\tthis._area.selectAll('path')\r\n\t\t\t.attr(\"d\", \"M0 0\");\r\n\t\tif (this._path) {\r\n\t\t\t// this._x.domain([0, 1]);\r\n\t\t\t// this._y.domain([0, 1]);\r\n\t\t\t// this._updateAxis();\r\n\t\t}\r\n\t});\r\n});\r\n","import 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\nimport { Elevation } from './control';\r\n\r\nElevation.addInitHook(function() {\r\n\r\n\tthis.on(\"elechart_legend\", function() {\r\n\t\tthis._altitudeLegend = this._legend.append('g')\r\n\t\t\t.call(\r\n\t\t\t\tD3.LegendItem({\r\n\t\t\t\t\tname: 'Altitude',\r\n\t\t\t\t\twidth: this._width(),\r\n\t\t\t\t\theight: this._height(),\r\n\t\t\t\t\tmargins: this.options.margins,\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t});\r\n\r\n\tthis.on(\"elechart_summary\", function() {\r\n\t\tthis.summaryDiv.innerHTML +=\r\n\t\t\t'<span class=\"totlen\"><span class=\"summarylabel\">' + L._(\"Total Length: \") + '</span><span class=\"summaryvalue\">' + this.track_info.distance.toFixed(2) + '&nbsp;' + this._xLabel + '</span></span>' +\r\n\t\t\t'<span class=\"maxele\"><span class=\"summarylabel\">' + L._(\"Max Elevation: \") + '</span><span class=\"summaryvalue\">' + this.track_info.elevation_max.toFixed(2) + '&nbsp;' + this._yLabel + '</span></span>' +\r\n\t\t\t'<span class=\"minele\"><span class=\"summarylabel\">' + L._(\"Min Elevation: \") + '</span><span class=\"summaryvalue\">' + this.track_info.elevation_min.toFixed(2) + '&nbsp;' + this._yLabel + '</span></span>';\r\n\t});\r\n\r\n});\r\n","import 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\nimport { Elevation } from './control';\r\n\r\nElevation.addInitHook(function() {\r\n\r\n\tif (!this.options.slope) return;\r\n\r\n\tlet opts = this.options;\r\n\tlet slope = {};\r\n\topts.margins.right = 50;\r\n\r\n\tif (this.options.slope != \"summary\") {\r\n\r\n\t\tthis.on(\"elechart_init\", function() {\r\n\t\t\tslope.path = this._area.append('path')\r\n\t\t\t\t.style(\"pointer-events\", \"none\")\r\n\t\t\t\t// TODO: add a class here.\r\n\t\t\t\t.attr(\"fill\", \"#F00\")\r\n\t\t\t\t.attr(\"stroke\", \"#000\")\r\n\t\t\t\t.attr(\"stroke-opacity\", \"0.5\")\r\n\t\t\t\t.attr(\"fill-opacity\", \"0.25\");\r\n\t\t});\r\n\r\n\t\tthis.on(\"elechart_axis\", function() {\r\n\t\t\tslope.x = this._x;\r\n\r\n\t\t\t// slope.x = D3.Scale({\r\n\t\t\t// \tdata: this._data,\r\n\t\t\t// \trange: [0, this._width()],\r\n\t\t\t// \tattr: opts.xAttr,\r\n\t\t\t// \tmin: opts.xAxisMin,\r\n\t\t\t// \tmax: opts.xAxisMax,\r\n\t\t\t// \tforceBounds: opts.forceAxisBounds,\r\n\t\t\t// });\r\n\r\n\t\t\tslope.y = D3.Scale({\r\n\t\t\t\tdata: this._data,\r\n\t\t\t\trange: [this._height(), 0],\r\n\t\t\t\tattr: \"slope\",\r\n\t\t\t\tmin: -1,\r\n\t\t\t\tmax: +1,\r\n\t\t\t\tforceBounds: opts.forceAxisBounds,\r\n\t\t\t});\r\n\r\n\t\t\tslope.axis = D3.Axis({\r\n\t\t\t\taxis: \"y\",\r\n\t\t\t\tposition: \"right\",\r\n\t\t\t\twidth: this._width(),\r\n\t\t\t\theight: this._height(),\r\n\t\t\t\tscale: slope.y,\r\n\t\t\t\tticks: this.options.yTicks,\r\n\t\t\t\ttickPadding: 16,\r\n\t\t\t\tlabel: \"%\",\r\n\t\t\t\tlabelX: 25,\r\n\t\t\t\tlabelY: 3,\r\n\t\t\t});\r\n\r\n\t\t\tthis._axis.call(slope.axis);\r\n\t\t});\r\n\r\n\t\tthis.on(\"elechart_updated\", function() {\r\n\t\t\tslope.area = D3.Area({\r\n\t\t\t\tinterpolation: opts.sInterpolation,\r\n\t\t\t\tdata: this._data,\r\n\t\t\t\tname: 'Slope',\r\n\t\t\t\txAttr: opts.xAttr,\r\n\t\t\t\tyAttr: \"slope\",\r\n\t\t\t\twidth: this._width(),\r\n\t\t\t\theight: this._height(),\r\n\t\t\t\tscaleX: slope.x,\r\n\t\t\t\tscaleY: slope.y,\r\n\t\t\t});\r\n\r\n\t\t\tslope.path.call(slope.area);\r\n\t\t});\r\n\r\n\t\tthis.on(\"elechart_legend\", function() {\r\n\t\t\tslope.legend = this._legend.append(\"g\")\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.LegendItem({\r\n\t\t\t\t\t\tname: 'Slope',\r\n\t\t\t\t\t\twidth: this._width(),\r\n\t\t\t\t\t\theight: this._height(),\r\n\t\t\t\t\t\tmargins: this.options.margins,\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\r\n\t\t\tthis._altitudeLegend\r\n\t\t\t\t.attr(\"transform\", \"translate(-50, 0)\");\r\n\r\n\t\t\tslope.legend\r\n\t\t\t\t.attr(\"transform\", \"translate(50, 0)\");\r\n\r\n\t\t\tslope.legend.select(\"rect\")\r\n\t\t\t\t.classed(\"area\", false)\r\n\t\t\t\t// TODO: add a class here.\r\n\t\t\t\t.attr(\"fill\", \"#F00\")\r\n\t\t\t\t.attr(\"stroke\", \"#000\")\r\n\t\t\t\t.attr(\"stroke-opacity\", \"0.5\")\r\n\t\t\t\t.attr(\"fill-opacity\", \"0.25\");\r\n\r\n\t\t});\r\n\t}\r\n\r\n\tthis.on(\"eledata_updated\", function(e) {\r\n\t\tlet data = this._data;\r\n\t\tlet i = e.index;\r\n\t\tlet z = data[i].z;\r\n\r\n\t\tlet curr = data[i].latlng;\r\n\t\tlet prev = i > 0 ? data[i - 1].latlng : curr;\r\n\r\n\t\tlet delta = curr.distanceTo(prev) * this._distanceFactor;\r\n\r\n\t\t// Slope / Gain\r\n\t\tlet tAsc = this._tAsc || 0; // Total Ascent\r\n\t\tlet tDes = this._tDes || 0; // Total Descent\r\n\t\tlet sMax = this._sMax || 0; // Slope Max\r\n\t\tlet sMin = this._sMin || 0; // Slope Min\r\n\t\tlet slope = 0;\r\n\r\n\t\tif (!isNaN(z)) {\r\n\t\t\tlet deltaZ = i > 0 ? z - data[i - 1].z : 0;\r\n\t\t\tif (deltaZ > 0) tAsc += deltaZ;\r\n\t\t\telse if (deltaZ < 0) tDes -= deltaZ;\r\n\t\t\t// slope in % = ( height / length ) * 100\r\n\t\t\tslope = delta !== 0 ? (deltaZ / delta) * 100 : 0;\r\n\t\t}\r\n\r\n\t\tif (this.options.sDeltaMax) {\r\n\t\t\tlet deltaS = i > 0 ? slope - data[i - 1].slope : 0;\r\n\t\t\tlet maxDeltaS = this.options.sDeltaMax;\r\n\t\t\tif (Math.abs(deltaS) > maxDeltaS) {\r\n\t\t\t\tslope = data[i - 1].slope + maxDeltaS * Math.sign(deltaS);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.options.sRange) {\r\n\t\t\tlet range = this.options.sRange;\r\n\t\t\tif (slope < range[0]) slope = range[0];\r\n\t\t\telse if (slope > range[1]) slope = range[1];\r\n\t\t}\r\n\r\n\t\tslope = L.Util.formatNum(slope, 2);\r\n\r\n\t\tsMax = slope > sMax ? slope : sMax;\r\n\t\tsMin = slope < sMin ? slope : sMin;\r\n\r\n\t\tdata[i].slope = slope;\r\n\r\n\t\tthis.track_info = this.track_info || {};\r\n\t\tthis.track_info.ascent = this._tAsc = tAsc;\r\n\t\tthis.track_info.descent = this._tDes = tDes;\r\n\t\tthis.track_info.slope_max = this._sMax = sMax;\r\n\t\tthis.track_info.slope_min = this._sMin = sMin;\r\n\t});\r\n\r\n\tthis.on(\"elechart_change\", function(e) {\r\n\t\tlet item = e.data;\r\n\t\tlet xCoordinate = e.xCoord;\r\n\r\n\t\tif (this._focuslabel) {\r\n\t\t\tif (!this._focuslabelSlope || !this._focuslabelSlope.property('isConnected')) {\r\n\t\t\t\tthis._focuslabelSlope = this._focuslabel.select('text').insert(\"svg:tspan\", \".mouse-focus-label-x\")\r\n\t\t\t\t\t.attr(\"class\", \"mouse-focus-label-slope\")\r\n\t\t\t\t\t.attr(\"dy\", \"1.5em\");\r\n\t\t\t}\r\n\r\n\t\t\tthis._focuslabelSlope.text(item.slope + \"%\");\r\n\r\n\t\t\tthis._focuslabel.select('.mouse-focus-label-x')\r\n\t\t\t\t.attr(\"dy\", \"1.5em\");\r\n\t\t}\r\n\r\n\t\tif (this._mouseHeightFocusLabel) {\r\n\t\t\tif (!this._mouseSlopeFocusLabel) {\r\n\t\t\t\tthis._mouseSlopeFocusLabel = this._mouseHeightFocusLabel.append(\"svg:tspan\")\r\n\t\t\t\t\t.attr(\"class\", \"height-focus-slope \");\r\n\t\t\t}\r\n\r\n\t\t\tthis._mouseSlopeFocusLabel\r\n\t\t\t\t.attr(\"dy\", \"1.5em\")\r\n\t\t\t\t.text(Math.round(item.slope) + \"%\");\r\n\r\n\t\t\tthis._mouseHeightFocusLabel.select('.height-focus-y')\r\n\t\t\t\t.attr(\"dy\", \"-1.5em\");\r\n\t\t}\r\n\t});\r\n\r\n\tthis.on(\"elechart_summary\", function() {\r\n\t\tthis.track_info.ascent = this._tAsc || 0;\r\n\t\tthis.track_info.descent = this._tDes || 0;\r\n\t\tthis.track_info.slope_max = this._sMax || 0;\r\n\t\tthis.track_info.slope_min = this._sMin || 0;\r\n\r\n\t\tthis.summaryDiv.querySelector('.minele').insertAdjacentHTML('afterend', '<span class=\"ascent\"><span class=\"summarylabel\">' + L._(\"Total Ascent: \") + '</span><span class=\"summaryvalue\">' + Math.round(this.track_info.ascent) + '&nbsp;' +\r\n\t\t\tthis._yLabel +\r\n\t\t\t'</span></span>' + '<span class=\"descent\"><span class=\"summarylabel\">' + L._(\"Total Descent: \") + '</span><span class=\"summaryvalue\">' + Math.round(this.track_info.descent) + '&nbsp;' + this._yLabel +\r\n\t\t\t'</span></span>' + '<span class=\"minslope\"><span class=\"summarylabel\">' + L._(\"Min Slope: \") + '</span><span class=\"summaryvalue\">' + this.track_info.slope_min + '&nbsp;' + '%' +\r\n\t\t\t'</span></span>' + '<span class=\"maxslope\"><span class=\"summarylabel\">' + L._(\"Max Slope: \") + '</span><span class=\"summaryvalue\">' + this.track_info.slope_max + '&nbsp;' + '%' +\r\n\t\t\t'</span></span>');\r\n\t});\r\n\r\n\tthis.on(\"eledata_clear\", function() {\r\n\t\tthis._sMax = null;\r\n\t\tthis._sMin = null;\r\n\t\tthis._tAsc = null;\r\n\t\tthis._tDes = null;\r\n\t});\r\n\r\n});\r\n","/*\r\n * Copyright (c) 2019, GPL-3.0+ Project, Raruto\r\n *\r\n *  This file is free software: you may copy, redistribute and/or modify it\r\n *  under the terms of the GNU General Public License as published by the\r\n *  Free Software Foundation, either version 2 of the License, or (at your\r\n *  option) any later version.\r\n *\r\n *  This file is distributed in the hope that it will be useful, but\r\n *  WITHOUT ANY WARRANTY; without even the implied warranty of\r\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n *  General Public License for more details.\r\n *\r\n *  You should have received a copy of the GNU General Public License\r\n *  along with this program.  If not, see .\r\n *\r\n * This file incorporates work covered by the following copyright and\r\n * permission notice:\r\n *\r\n *     Copyright (c) 2013-2016, MIT License, Felix MrMufflon Bache\r\n *\r\n *     Permission to use, copy, modify, and/or distribute this software\r\n *     for any purpose with or without fee is hereby granted, provided\r\n *     that the above copyright notice and this permission notice appear\r\n *     in all copies.\r\n *\r\n *     THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL\r\n *     WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED\r\n *     WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE\r\n *     AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR\r\n *     CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS\r\n *     OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT,\r\n *     NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN\r\n *     CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.\r\n */\r\n\r\nimport 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\nimport { Chart } from './chart';\r\nimport { Elevation } from './control';\r\nimport './altitude';\r\nimport './slope';\r\n\r\nElevation.Utils = _;\r\nElevation.Components = D3;\r\nElevation.Chart = Chart;\r\n\r\nL.control.elevation = (options) => new Elevation(options);\r\n"],"names":["factory","window","define","amd","exports","module","require","L","locales","locale","registerLocale","code","Util","extend","setLocale","i18n","_","translate","string","data","template","err","deepMerge","target","sources","length","source","shift","isObject","key","Object","assign","deferFunc","f","document","readyState","addEventListener","once","formatter","num","dec","sep","res","formatNum","toString","numbers","split","d","join","GeoJSONLoader","control","JSON","parse","layer","geoJson","style","feature","options","polyline","theme","className","pointToLayer","latlng","marker","icon","gpxOptions","marker_options","wptIcons","desc","properties","name","bindPopup","openPopup","fire","point","point_type","element","onEachFeature","geometry","type","addData","track_info","Control","Elevation","_d3LazyLoader","then","_fireEvt","GPXLoader","polyline_options","GPX","on","e","line","get_name","isDomVisible","elem","offsetWidth","offsetHeight","getClientRects","item","Array","isArray","isVisible","styles","getComputedStyle","isVisibleByStyles","visibility","display","isAboveOtherElements","boundingRect","getBoundingClientRect","left","right","top","bottom","above","pointerEvents","elementFromPoint","isJSONDoc","doc","lazy","trim","indexOf","console","warn","isXMLDoc","documentElement","ownerDocument","nodeName","lazyLoader","url","skip","loader","Promise","resolve","reject","tag","createElement","src","head","appendChild","loadFile","success","xhr","XMLHttpRequest","responseType","open","onload","response","onerror","status","send","saveFile","dataURI","fileName","a","create","href","download","b","body","click","removeChild","waitHolder","ticking","scrollFn","requestAnimFrame","removeEventListener","addClass","targetNode","each","s","DomUtil","removeClass","value","getStyle","setProperty","tagName","attributes","parent","setAttributes","append","child","insert","position","insertAdjacentElement","attrs","k","setAttribute","select","selector","context","querySelector","DomEvent","off","hasClass","randomId","Math","random","substr","obj","fn","i","Area","xAttr","yAttr","scaleX","scaleY","height","interpolation","path","d3","area","curve","x","xDiagCoord","y0","y1","datum","attr","AreaPath","props","call","Axis","tickSize","tickPadding","width","axis","scale","ticks","tickFormat","label","labelX","labelY","g","w","h","axisScale","replace","l","toUpperCase","axisGroup","text","DragRectangle","dragStartCoords","dragEndCoords","rect","x1","min","x2","max","FocusRect","Grid","HeightFocusLine","xCoord","yCoord","HeightFocusLabel","y","node","selectAll","HeightFocusPoint","circle","LegendItem","margins","toLowerCase","MouseFocusLine","MouseFocusLabel","xAlign","yAlign","bbox","getBBox","Browser","webkit","Infinity","Scale","forceBounds","range","domain","extent","scaleLinear","Bisect","bisector","invert","Chart","Class","includes","Evented","prototype","Mixin","Events","initialize","opts","_data","_draggingEnabled","dragging","imperial","_xLabel","_yLabel","xLabel","yLabel","_xTicks","xTicks","_yTicks","yTicks","_updateScale","svg","_svg","_appendGrid","_appendAxis","_appendAreaPath","_appendFocusable","_appendLegend","_grid","_area","_path","_axis","_focus","_focusRect","_legend","_x","_y","update","_updateAxis","_updateAreaPath","render","container","D3","_width","xAxisMin","xAxisMax","forceAxisBounds","_height","yAxisMin","yAxisMax","remove","_appendXGrid","_appendYGrid","_appendXaxis","_appendYaxis","_appendFocusRect","_appendMouseFocusG","focusRect","mobile","_dragStartHandler","bind","_dragHandler","_mousemoveHandler","_dragEndHandler","_mouseenterHandler","_mouseoutHandler","focusG","_focusG","_focusline","_focuslabel","legend","event","preventDefault","stopPropagation","_gotDragged","_drawDragRectangle","_dragStartCoords","mouse","_dragRectangle","_dragCurrentCoords","_resetDrag","start","_findItemForX","end","dragstart","dragend","ctx","coords","_hideDiagramIndicator","_showDiagramIndicator","xCoordinate","classed","hoverNumber","decimalsX","decimalsY","fx","fy","yCoordinate","addInitHook","Marker","_heightG","_mouseHeightFocus","_pointG","_mouseHeightFocusLabel","_marker","markerIcon","zIndexOffset","interactive","addTo","map","_map","pane","renderer","getPane","_pane","createPane","zIndex","_latlng","latLngToLayerPoint","normalizedAlt","maxElevation","z","normalizedY","getElement","setLatLng","getLatLng","Summary","summary","_summary","reset","innerHTML","Options","autohide","autohideMarker","collapsed","detached","distanceFactor","downloadLink","elevationDiv","followMarker","async","startIconUrl","endIconUrl","shadowUrl","divIcon","html","iconSize","iconAnchor","heightFactor","lazyLoadJS","loadData","defer","placeholder","color","opacity","weight","lineCap","reverseCoords","skipNullZCoords","responsive","slope","sDeltaMax","sInterpolation","sRange","undefined","zFollow","__mileFactor","__footFactor","__D3","__LGPX","_addData","_addLayer","eleDiv","_initElevationDiv","isConnected","_container","onAdd","clear","_clearPath","_clearChart","_clearData","disableDragging","_chart","enableDragging","fitBounds","bounds","getBounds","isValid","latLngBounds","getZFollow","_zFollow","hide","_distanceFactor","_heightFactor","_chartEnabled","_setMapView","throttle","load","loadChart","loadDefer","loadLazy","loadGPX","loadGeoJSON","_downloadURL","catch","_gpxLazyLoader","parentNode","alt","_initToggle","_initChart","_initMarker","_hidePositionMarker","_resetView","_resizeChart","_updateChart","_updateSummary","onRemove","redraw","setZFollow","zoom","show","geom","feat","gpx","_latlngs","_addGeoJSONData","coordinates","features","_addGPXData","_addPoint","lat","lng","meta","ele","eleMax","_maxElevation","eleMin","_minElevation","dist","_distance","curr","LatLng","prev","delta","distanceTo","round","prevZ","isNaN","lastZ","_lastValidZ","currZ","splice","push","distance","elevation_max","elevation_min","index","_mousemoveLayerHandler","_layers","stamp","id","_collapse","_expand","_findItemForLatLng","result","propagate","offWi","offHe","_maxWidth","containerWidth","clientWidth","chart","summaryDiv","disableClickPropagation","_mousewheelHandler","link","_button","title","stop","_toggle","_showPositionMarker","gestureHandling","_enabled","ll","getCenter","getZoom","sign","deltaY","flyTo","_isFullscreen","newWidth","removeControl","setView","animate","duration","onclick","confirm","p","pop","_popup","_content","decodeURI","bindTooltip","direction","sticky","openTooltip","enabled","nodes","n","getAttribute","CustomEvent","dispatchEvent","detail","_altitudeLegend","toFixed","tAsc","_tAsc","tDes","_tDes","sMax","_sMax","sMin","_sMin","deltaZ","deltaS","maxDeltaS","abs","ascent","descent","slope_max","slope_min","_focuslabelSlope","property","_mouseSlopeFocusLabel","insertAdjacentHTML","Utils","Components","elevation"],"mappings":"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"}